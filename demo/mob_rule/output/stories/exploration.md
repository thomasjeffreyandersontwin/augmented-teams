{'increment': {'output': '# Technical Proof of Concept and Drill-Down Stories - Increment Exploration\n\n**Navigation:** [ðŸ“‹ Story Map](../map/mob-rule-story-map.md) | [ðŸ“Š Increments](mob-rule-story-map-increments.md)\n\n**File Name**: `technical-proof-of-concept-and-drill-down-stories-exploration.md`\n**Location**: `mob_rule/docs/stories/increments/technical-proof-of-concept-and-drill-down-stories-exploration.md`\n\n**Priority:** NOW\n**Relative Size:** Small\n\n## Increment Purpose\n\nValidate Foundry VTT integration, Mob domain object, basic Combat Tracker/Actor/Actions integration. Complete all drill-down stories that showcase architectural complexity. Establishes strategy pattern foundation.\n\n---\n\n## Domain AC (Increment Level)\n\n### Core Domain Concepts\n\n#### Mob\nA collection of minion tokens that act together as a single unit. Has a leader token and member tokens. The leader token represents the mob in Combat Tracker and is clicked to execute mob actions.\n\n#### Leader Token\nThe token that represents the mob in Combat Tracker. Assigned randomly when mob is created (first increment). Clicked by GM to execute mob actions. All mob members execute the same action as the leader.\n\n#### Attack Common Target Strategy\nA strategy that determines all mob members attack the same target. The target is selected by GM when clicking the leader token action. This strategy applies when mob\'s turn begins in Combat Tracker.\n\n---\n\n### Domain Behaviors\n\n#### Mob Behavior\nCreated when GM selects multiple minion tokens on canvas. Mob domain object creates mob with selected tokens and assigns random leader. Mob must have at least one member token.\n\n#### Leader Token Behavior\nAssigned randomly when mob is created (first increment). Represents mob in Combat Tracker. When GM clicks leader token action during mob\'s turn, Mob domain object forwards that action to all mob member tokens.\n\n#### Attack Common Target Strategy Behavior\nApplied when mob\'s turn begins in Combat Tracker. Mob domain object queries Combat Tracker for common target (target that GM selects when clicking leader action). All mob members attack this same target.\n\n---\n\n### Domain Rules\n\n#### Mob must have at least one member token\n**Business rule:** A mob cannot be created with zero tokens. Validation occurs when Mob domain object creates mob.\n\n#### Leader is randomly assigned in first increment\n**Business rule:** When mob is created, leader token is randomly selected from member tokens. No explicit leader selection UI in first increment.\n\n#### Mob actions execute only during mob leader turn in Combat Tracker\n**Business rule:** Combat Tracker moves to mob leader\'s turn. GM can only execute mob actions when it\'s the leader\'s turn. Other mob member turns are skipped.\n\n#### All members execute same attack action as leader\n**Business rule:** When GM attacks with mob leader (choosing attack and target), Mob domain object forwards the exact same attack action to all mob member tokens. All members attack the same target with the same attack.\n\n#### Attack Common Target strategy applies on turn start\n**Business rule:** When mob\'s turn begins, Mob domain object applies Attack Common Target strategy by querying Combat Tracker for the common target (target that GM will select). Strategy determines target before GM clicks leader action.\n\n---\n\n## Stories (6 total)\n\n### Story 1: Create Mob from Selected Tokens\n*GM selects multiple minion tokens on canvas and Mob domain object creates mob with selected tokens and assigns random leader*\n\n**Acceptance Criteria:**\n- When GM selects multiple tokens on canvas, then Canvas System receives token selection event\n- When Canvas System receives token selection event, then Canvas System identifies selected tokens and passes token references to Mob domain object\n- When Mob domain object receives token references, then Mob domain object validates that at least one token is selected\n- When Mob domain object validates tokens, then Mob domain object queries Token System to identify which tokens are minion tokens\n- When Mob domain object identifies minion tokens, then Mob domain object creates new Mob instance with selected minion tokens\n- When Mob domain object creates Mob instance, then Mob domain object randomly selects one token from member tokens to be leader token\n- When Mob domain object assigns leader token, then Mob domain object stores Mob instance with leader token and member tokens\n- When Mob domain object stores Mob instance, then Mob domain object notifies Combat Tracker of mob creation with mob ID and leader token reference\n\n---\n\n### Story 2: Display Mob Grouping in Combat Tracker\n*Combat Tracker receives mob creation notification from Mob domain object and updates display to show mob membership*\n\n**Acceptance Criteria:**\n- When Mob domain object notifies Combat Tracker of mob creation, then Combat Tracker receives mob creation notification with mob ID, leader token reference, and member token references\n- When Combat Tracker receives mob creation notification, then Combat Tracker queries Mob domain object for mob membership details (all member tokens)\n- When Combat Tracker receives mob membership details, then Combat Tracker updates Combat Tracker display to show mob grouping\n- When Combat Tracker updates display, then Combat Tracker displays leader token entry in combat order\n- When Combat Tracker displays leader token entry, then Combat Tracker visually groups member tokens under leader token entry (indentation or visual grouping)\n- When Combat Tracker groups member tokens, then Combat Tracker marks member token entries as part of mob (visual indicator)\n\n---\n\n### Story 3: Execute Mob Attack with Strategy\n*Combat Tracker moves to mob leader\'s turn, Mob domain object determines target from Select Target strategy, GM attacks with mob leader choosing attack and target, and Mob domain object forwards action to all members*\n\n**Acceptance Criteria:**\n- When Combat Tracker advances to next turn, then Combat Tracker checks if current turn token is a mob leader token\n- When Combat Tracker identifies mob leader turn, then Combat Tracker moves to mob leader\'s turn and notifies Mob domain object that mob\'s turn has begun\n- When Mob domain object receives mob turn notification, then Mob domain object retrieves mob\'s configured strategy (Attack Common Target strategy)\n- When Mob domain object retrieves strategy, then Mob domain object applies strategy to determine target (queries Combat Tracker for common target that GM will select)\n- When Mob domain object determines target, then Mob domain object stores target for mob attack execution\n- When GM clicks leader token action during mob\'s turn, then Token System receives action click event from leader token\n- When Token System receives action click, then Token System displays attack selection UI for leader token\n- When GM selects attack and target from attack selection UI, then Token System receives attack selection with attack ID and target token reference\n- When Token System receives attack selection, then Token System forwards attack action to Mob domain object with attack ID, target token reference, and leader token reference\n- When Mob domain object receives attack action from leader token, then Mob domain object retrieves stored target from strategy (or uses target from attack action if strategy target not available)\n- When Mob domain object retrieves target, then Mob domain object retrieves all mob member tokens from stored Mob instance\n- When Mob domain object retrieves member tokens, then Mob domain object forwards attack action to each member token with same attack ID and target token reference\n- When Mob domain object forwards attack to member tokens, then Token System receives attack action for each member token\n- When Token System receives attack action for member token, then Token System forwards attack action to Combat System with token reference, attack ID, and target token reference\n- When Combat System receives attack action, then Combat System executes attack for that token against target token\n- When Combat System executes attack, then Combat System generates attack result event with token reference, attack ID, target reference, and result (hit/miss, damage, etc.)\n- When Combat System generates attack result event, then Combat System sends attack result event to Chat System\n\n---\n\n### Story 4: Display Attack Results in Chat\n*Chat system receives attack result events from Combat system and displays formatted results for all mob members*\n\n**Acceptance Criteria:**\n- When Combat System sends attack result event to Chat System, then Chat System receives attack result event with token reference, attack ID, target reference, and result data\n- When Chat System receives attack result event, then Chat System formats attack result message using token name, attack name, target name, and result details\n- When Chat System formats attack result message, then Chat System displays formatted message in chat log\n- When Chat System displays message for leader token attack, then Chat System displays leader token attack result in chat\n- When Chat System displays message for member token attack, then Chat System displays member token attack result in chat\n- When Chat System displays all attack results, then Chat System groups or sequences attack results to show all mob member attacks against target\n\n---\n\n### Story 5: Apply Attack Common Target Strategy\n*GM selects Attack Common Target strategy for mob, and Mob domain object applies strategy when mob\'s turn begins by querying Combat Tracker for common target*\n\n**Acceptance Criteria:**\n- When GM selects Attack Common Target strategy for mob (through future UI or configuration), then Mob domain object receives strategy selection with strategy type \'Attack Common Target\'\n- When Mob domain object receives strategy selection, then Mob domain object stores strategy configuration for mob with strategy type\n- When Combat Tracker moves to mob leader\'s turn, then Combat Tracker notifies Mob domain object that mob\'s turn has begun\n- When Mob domain object receives mob turn notification, then Mob domain object retrieves stored strategy configuration for mob\n- When Mob domain object retrieves strategy configuration, then Mob domain object identifies strategy type as \'Attack Common Target\'\n- When Mob domain object identifies Attack Common Target strategy, then Mob domain object creates Attack Common Target strategy object instance\n- When Mob domain object creates strategy object instance, then Mob domain object applies strategy by calling strategy object\'s determineTarget method\n- When strategy object\'s determineTarget method is called, then Attack Common Target strategy object queries Combat Tracker for common target (target that GM will select when clicking leader action)\n- When strategy object queries Combat Tracker, then Combat Tracker returns common target token reference (or null if no common target yet)\n- When strategy object receives target from Combat Tracker, then Attack Common Target strategy object returns target token reference to Mob domain object\n- When Mob domain object receives target from strategy object, then Mob domain object stores target for mob attack execution\n- When Mob domain object stores target, then Mob domain object notifies Combat Tracker of selected target with mob ID and target token reference\n\n---\n\n### Story 6: Display Selected Common Target\n*Combat Tracker receives target selection notification from Mob domain object and updates display to show mob\'s selected common target*\n\n**Acceptance Criteria:**\n- When Mob domain object notifies Combat Tracker of selected target, then Combat Tracker receives target selection notification with mob ID and target token reference\n- When Combat Tracker receives target selection notification, then Combat Tracker queries Mob domain object for mob details (leader token reference) to identify which mob entry to update\n- When Combat Tracker identifies mob entry, then Combat Tracker queries Token System for target token name/display information\n- When Combat Tracker receives target token information, then Combat Tracker updates Combat Tracker display for mob leader entry\n- When Combat Tracker updates display, then Combat Tracker displays visual indicator showing mob\'s selected target (target token name, highlight, or icon)\n- When Combat Tracker displays target indicator, then Combat Tracker shows target information near or on mob leader entry in combat order\n\n---\n\n## Consolidation Decisions\n\nNo consolidation decisions made at this time. Acceptance criteria follow Inner System granularity with detailed component interactions. Similar logic patterns (e.g., "Display Selected Target" for different strategies) may be consolidated in future increments when those strategies are explored.\n\n---\n\n## Domain Rules Referenced\n\nAll domain rules are defined in the Domain Rules section above. Stories reference these rules implicitly through their acceptance criteria:\n- Story 1 (Create Mob) references: "Mob must have at least one member token" and "Leader is randomly assigned in first increment"\n- Story 3 (Execute Mob Attack) references: "Mob actions execute only during mob leader turn" and "All members execute same attack action as leader"\n- Story 5 (Apply Attack Common Target Strategy) references: "Attack Common Target strategy applies on turn start"\n\n---\n\n## Source Material\n\n- **Story map from Shape stage:** Overarching epics, features, and stories for Manage Mobs in Foundry VTT\n- **Discovery refinements from Discovery stage:** Enumerated all 6 stories for Increment 1 with component-level interactions\n- **Planning decisions from Exploration stage:**\n  - Acceptance criteria granularity: Inner System - Focus on technical interaction points, system-to-system communication, and internal system behavior. CRITICAL: Be MORE granular wherever there is an explicit business rule being activated that changes state or is an important decision.\n  - Acceptance criteria count: Stop when criteria capture a full back-and-forth (user-system-user). Be detailed about business rules, state changes, and important decisions even if it increases AC count.\n  - Acceptance criteria consolidation: Same logic, different data â†’ Consolidate (even if data differs significantly). Focus on reusability.\n- **Technical specifications:** Foundry VTT system integration requirements. Mutants & Masterminds system integration (https://github.com/Ethaks/foundry-mm3)\n- **Component interactions:** Canvas System, Mob Domain Object, Combat Tracker, Token System, Combat System, Chat System\n'}}