{
  "solution": {
    "name": "Manage Mobs in Foundry VTT",
    "purpose": "Enable Game Masters to group minions into mobs that act together, reducing churn and time in epic minion battles. Mobs execute coordinated actions based on selected strategies, allowing multiple mobs to act autonomously without constant intervention."
  },
  "epics": [
    {
      "name": "Group Minions into Mobs",
      "purpose": "Enable GM to create and manage mobs from canvas tokens",
      "features": [
        {
          "name": "Create Mobs from Canvas Tokens",
          "purpose": "Create mobs by selecting tokens on canvas",
          "story_count": "3",
          "stories": [
            {
              "name": "Create, Select, or Remove Mob from Dialog",
              "description": "GM opens Mob dialog box and creates, selects, or removes a mob, then updates mob membership"
            },
            {
              "name": "Select and Unselect Mob Tokens",
              "description": "GM selects and unselects tokens on canvas and Mob domain object updates mob membership with selected tokens"
            },
            {
              "name": "Display Mob Grouping in Combat Tracker",
              "description": "Combat Tracker receives mob creation notification from Mob domain object and updates display to show mob membership"
            }
          ]
        },
        {
          "name": "View Mob Groupings in Combat Tracker",
          "purpose": "View mob information in combat tracker",
          "story_count": "~3"
        },
        {
          "name": "Modify Mob Membership",
          "purpose": "Modify which tokens are in a mob",
          "story_count": "~4"
        },
        {
          "name": "Spawn Mobs from Actors",
          "purpose": "Create mobs from actor templates",
          "story_count": "~4"
        }
      ]
    },
    {
      "name": "Execute Mob Actions",
      "purpose": "Execute coordinated actions for all mob members",
      "features": [
        {
          "name": "Select Mob Target",
          "purpose": "Select targets for mob actions",
          "story_count": "~4"
        },
        {
          "name": "Execute Mob Attack",
          "purpose": "Execute attacks for all mob members",
          "story_count": "2",
          "stories": [
            {
              "name": "Execute Mob Attack with Strategy",
              "description": "Combat Tracker moves to mob leader's turn, Mob domain object determines target from Select Target strategy, GM attacks with mob leader choosing attack and target, and Mob domain object forwards action to all members"
            },
            {
              "name": "Display Attack Results in Chat",
              "description": "Chat system receives attack result events from Combat system and displays formatted results for all mob members"
            }
          ]
        },
        {
          "name": "Determine Available Attacks",
          "purpose": "Determine which attacks are available for mob",
          "story_count": "~5"
        }
      ]
    },
    {
      "name": "Handle Mob Strategies",
      "purpose": "Configure and execute strategies for mob behavior",
      "features": [
        {
          "name": "Select Mob Strategy",
          "purpose": "Select and configure mob strategies",
          "story_count": "3",
          "stories": [
            {
              "name": "Open Mob Configuration Panel",
              "description": "GM clicks on mob leader token or mob entry in Combat Tracker, and Mob Panel UI opens displaying mob configuration options"
            },
            {
              "name": "Display Mob Configuration in Panel",
              "description": "Mob Panel UI receives mob configuration from Mob domain object and displays mob members, current strategy, and available strategy options"
            },
            {
              "name": "Select Mob Strategy from Panel",
              "description": "GM selects a strategy from Mob Panel UI dropdown, and Mob Panel UI sends strategy selection to Mob domain object which saves strategy configuration"
            }
          ]
        },
        {
          "name": "Choose Target by Strategy",
          "purpose": "Select targets based on configured strategies",
          "story_count": "5",
          "stories": [
            {
              "name": "Apply Attack Common Target Strategy",
              "description": "GM selects Attack Common Target strategy for mob, and Mob domain object applies strategy when mob's turn begins by querying Combat Tracker for common target"
            },
            {
              "name": "Display Selected Common Target",
              "description": "Combat Tracker receives target selection notification from Mob domain object and updates display to show mob's selected common target"
            },
            {
              "name": "Apply Attack Most Powerful Strategy",
              "description": "When mob's turn begins, Mob domain object applies Attack Most Powerful strategy by querying Combat Tracker for all available targets, calculating power levels, and selecting most powerful target"
            },
            {
              "name": "Display Selected Most Powerful Target",
              "description": "Combat Tracker receives target selection notification from Mob domain object and updates display to show mob's selected most powerful target"
            },
            {
              "name": "Apply Attack Weakest Strategy",
              "description": "When mob's turn begins, Mob domain object applies Attack Weakest strategy by querying Combat Tracker for all available targets, calculating power levels, and selecting weakest target"
            }
          ]
        },
        {
          "name": "Select Attack Effect by Strategy",
          "purpose": "Select attacks based on configured strategies",
          "story_count": "~4"
        },
        {
          "name": "AI-Assisted Behavior and Strategies",
          "purpose": "AI-assisted strategy selection and execution",
          "story_count": "~3"
        }
      ]
    },
    {
      "name": "Auto-Flee Behavior",
      "purpose": "Automated flee behavior for mobs",
      "features": [
        {
          "name": "Auto Resist and Apply Effect",
          "purpose": "Automatically resist attacks and apply effects",
          "story_count": "~3"
        }
      ]
    }
  ],
  "increments": [
    {
      "name": "Technical Proof of Concept and Drill-Down Stories",
      "priority": "NOW",
      "relative_size": "Small",
      "approach": "Validating Impact - Feasibility + Delivering End-to-End Journey",
      "focus": "Foundry integration risk reduction and complete drill-down stories",
          "domain_ac": {
            "concepts": [
              {
            "name": "Mob",
            "description": "A collection of tokens that act together as a single unit. Has a leader token and member tokens. The leader token represents the mob in Combat Tracker and is clicked to execute mob actions. Any token type can be a mob member."
          },
          {
            "name": "Leader Token",
            "description": "The token that represents the mob in Combat Tracker. Assigned when a member token is added to the combat tracker (by dragging to combat tracker or right-clicking and choosing \"add to tracker\"). The member added becomes the leader immediately. Clicked by GM to execute mob actions. All mob members execute the same action as the leader."
          },
          {
            "name": "Attack Common Target Strategy",
            "description": "A strategy that determines all mob members attack the same target with the same attack. The target and attack are associated with the mob when GM executes an attack from the mob leader onto another token. Once associated, the strategy executes automatically when it's the mob's turn in Combat Tracker."
          },
          {
            "name": "Mob Manager Dialog",
            "description": "A dialog box that displays mob configuration and status information. Shows mob members, current strategy, target, and attack information. Updated when Mob Manager determines target and attack for a strategy."
              }
            ],
            "behaviors": [
              {
            "concept": "Mob",
            "behavior": "Created when GM initiates minion selection mode (via hotkey) and selects multiple tokens on canvas. Mob Manager creates mob with selected tokens. When a mob member is added to combat tracker (by dragging or right-clicking \"add to tracker\"), that member becomes the mob leader. Mob must have at least one member token. Any token type can be a mob member."
          },
          {
            "concept": "Leader Token",
            "behavior": "Assigned when a mob member is added to combat tracker (by dragging to combat tracker or right-clicking and choosing \"add to tracker\"). The member added becomes the mob leader immediately. Represents mob in Combat Tracker. When GM executes an attack from the mob leader, Mob Manager associates that attack and target with the mob for strategy execution."
          },
          {
            "concept": "Attack Common Target Strategy",
            "behavior": "Strategy waits for GM to execute an attack from the mob leader onto another token. When GM executes the attack, Mob Manager associates that target and attack with the mob. When it's the mob's turn in Combat Tracker and a target and attack have been associated, the strategy executes automatically, forwarding the same attack to all mob members against the same target."
          }
        ],
        "rules": [
          {
            "name": "Mob must have at least one member token",
            "description": "A mob cannot be created with zero tokens. Validation occurs when Mob domain object creates mob."
          },
          {
            "name": "Leader is assigned when member is added to combat tracker",
            "description": "When a mob member is added to combat tracker (by dragging to combat tracker or right-clicking and choosing \"add to tracker\"), that member becomes the mob leader immediately. If the mob leader is removed from the mob and the leader was in combat tracker, the leader is removed from combat tracker. No new leader is automatically assigned until another member is added to combat tracker."
          },
          {
            "name": "Mob actions execute only during mob leader turn in Combat Tracker",
            "description": "Combat Tracker moves to mob leader's turn. GM can only execute mob actions when it's the leader's turn. Other mob member turns are skipped."
          },
          {
            "name": "All members execute same attack action as leader",
            "description": "When GM executes an attack from the mob leader (choosing attack and target), Mob Manager associates that attack and target with the mob. When the strategy executes, Mob Manager forwards the exact same attack action to all mob member tokens. All members attack the same target with the same attack."
          },
          {
            "name": "Attack Common Target strategy waits for GM attack then executes",
            "description": "Attack Common Target strategy waits for GM to execute an attack from the mob leader onto another token. When GM executes the attack, Mob Manager associates that target and attack with the mob. When it's the mob's turn in Combat Tracker and both target and attack have been associated, the strategy executes automatically for all mob members."
              }
            ]
          },
          "stories": [
            {
          "name": "Create, Select, or Remove Mob from Dialog",
          "description": "GM opens Mob dialog box and creates, selects, or removes a mob, then updates mob membership",
              "behavioral_ac": [
            "When GM initiates minion selection mode through hotkey then a dialog box appears with a plus button to create a new mob and a list of existing mobs (if any)",
            "When GM clicks the plus button, then a new mob is created with a default mob name field (which can be edited) and empty list of members",
            "When GM edits the mob name in the dialog box and saves changes, then the updated mob name is stored by the Mob Manager",
            "When GM clicks on an existing mob in the dialog list, then the dialog displays the member tokens of the selected mob and the selected mob becomes the active mob for editing",
            "When GM clicks delete button for the selected mob, then Mob Manager removes the mob and all member tokens are removed from the mob",
            "When mob is removed, then the mob is removed from the dialog list and if the mob leader was in combat tracker, it is removed from combat tracker",
            "When GM closes the dialog box, then no mob is active for editing"
              ],
              "scenarios": [
                {
              "name": "Background",
              "steps": [
                "Given GM has access to Foundry VTT canvas",
                "And canvas has tokens available"
              ]
            },
            {
              "name": "GM opens dialog and creates new mob",
              "steps": [
                "When GM presses hotkey to initiate minion selection mode",
                "Then a dialog box appears with a plus button to create a new mob",
                "And if mobs already exist, they appear in a list showing only their names",
                "When GM clicks the plus button",
                "Then a new mob is created with a default mob name field (which can be edited) and empty list of members",
                "When GM edits the mob name in the dialog box and saves changes",
                "Then the updated mob name is stored by the Mob Manager",
                "And the new mob becomes the active mob for editing"
              ]
            },
            {
              "name": "GM selects existing mob from dialog",
                  "steps": [
                "Given one or more mobs have been created",
                "When GM presses hotkey to initiate minion selection mode",
                "Then a dialog box appears with a plus button to create a new mob",
                "And each existing mob appears in the list showing only its name",
                "When GM clicks on an existing mob in the dialog box",
                "Then the dialog displays the member tokens of the selected mob",
                "And the selected mob becomes the active mob for editing, selecting, and unselecting members",
                "And Mob Manager selects all member tokens of the selected mob on the canvas",
                "And Canvas System displays all member tokens as selected",
                "When GM closes the dialog box",
                "Then no mob is active for editing"
              ]
            },
            {
              "name": "GM deletes an existing mob",
              "steps": [
                "Given one or more mobs have been created",
                "When GM presses hotkey to initiate minion selection mode",
                "And GM selects an existing mob from the dialog list",
                "Then the dialog displays the member tokens of the selected mob",
                "When GM clicks delete button for the selected mob",
                "Then Mob Manager removes the mob",
                "And all member tokens are removed from the mob",
                "And the mob is removed from the dialog list",
                "And if the mob leader was in combat tracker, it is removed from combat tracker"
              ]
            },
            {
              "name": "Dialog shows no mobs when none exist",
              "steps": [
                "When GM presses hotkey to initiate minion selection mode",
                "And no mobs have been created",
                "Then a dialog box appears with a plus button to create a new mob",
                "And no mobs appear in the list"
              ]
            }
          ]
        },
        {
          "name": "Select and Unselect Mob Tokens",
          "description": "GM selects and unselects tokens on canvas and Mob domain object updates mob membership with selected tokens",
              "behavioral_ac": [
            "When GM selects multiple tokens on canvas, then Canvas System forwards token selection event to Mob Manager",
            "When Mob Manager receives token selection event, then the Mob Manager aligns the mob membership with all selected tokens",
            "When Mob aligns its membership then it queries Token System to identify all selected tokens and add or remove from membership",
            "When Mob domain object updates Mob membership, then Mob domain object stores Mob instance and member tokens with the Mob Manager",
            "When a member of the mob is added to the combat tracker (by dragging or right-clicking \"add to tracker\"), then that member becomes the Mob leader"
              ],
              "scenarios": [
                {
              "name": "Background",
                  "steps": [
                "Given GM has opened Mob dialog box",
                "And a mob is active for editing (either newly created or selected from list)",
                "And canvas has tokens available"
              ]
            },
            {
              "name": "GM selects tokens to add to mob",
              "steps": [
                "Given an active mob exists with <current_count> member tokens",
                "When GM selects <selected_count> tokens on canvas",
                "Then Canvas System forwards token selection event to Mob Manager",
                "And Mob Manager aligns mob membership with all selected tokens",
                "And Mob queries Token System to identify all selected tokens",
                "And Mob domain object adds selected tokens to mob membership",
                "And mob now has <new_count> member tokens",
                "And Mob domain object stores updated Mob instance with member tokens with Mob Manager"
              ],
              "examples": [
                {"current_count": 0, "selected_count": 3, "new_count": 3},
                {"current_count": 2, "selected_count": 2, "new_count": 4},
                {"current_count": 5, "selected_count": 3, "new_count": 8}
              ]
            },
            {
              "name": "GM unselects tokens to remove from mob",
                  "steps": [
                "Given an active mob exists with <current_count> member tokens",
                "And mob has specific tokens as members",
                "When GM unselects <unselected_count> tokens that are currently mob members",
                "Then Canvas System forwards token selection event to Mob Manager",
                "And Mob Manager aligns mob membership with all selected tokens",
                "And Mob queries Token System to identify all selected tokens",
                "And Mob domain object removes unselected tokens from mob membership",
                "And mob now has <new_count> member tokens",
                "And if the leader token was unselected and leader was in combat tracker, Mob Manager removes leader from combat tracker",
                "And Mob domain object stores updated Mob instance with member tokens with Mob Manager"
              ],
              "examples": [
                {"current_count": 5, "unselected_count": 2, "new_count": 3},
                {"current_count": 3, "unselected_count": 1, "new_count": 2},
                {"current_count": 10, "unselected_count": 5, "new_count": 5}
              ]
            },
            {
              "name": "GM selects and unselects tokens simultaneously",
              "steps": [
                "Given an active mob exists with <current_count> member tokens",
                "When GM selects <selected_count> new tokens and unselects <unselected_count> existing member tokens",
                "Then Canvas System forwards token selection event to Mob Manager",
                "And Mob Manager aligns mob membership with all selected tokens",
                "And Mob queries Token System to identify all selected tokens",
                "And Mob domain object adds new tokens and removes unselected tokens from mob membership",
                "And mob now has <new_count> member tokens",
                "And if the leader token was unselected and leader was in combat tracker, Mob Manager removes leader from combat tracker",
                "And Mob domain object stores updated Mob instance with member tokens with Mob Manager"
              ],
              "examples": [
                {"current_count": 3, "selected_count": 2, "unselected_count": 1, "new_count": 4},
                {"current_count": 5, "selected_count": 3, "unselected_count": 2, "new_count": 6}
              ]
            },
            {
              "name": "Leader assigned when member added to combat tracker",
                  "steps": [
                "Given a mob exists with multiple member tokens",
                "And mob has no leader assigned",
                "When GM adds a member token to the combat tracker (by dragging to combat tracker or right-clicking and choosing \"add to tracker\")",
                "Then that member token becomes the Mob leader",
                "And Mob Manager stores the leader token with the Mob instance"
              ]
            },
            {
              "name": "No tokens selected",
              "steps": [
                "Given an active mob exists",
                "When GM does not select any tokens",
                "Then dialog box remains open with current member list",
                "And Mob Manager does not update mob membership",
                "And mob remains in current state"
              ]
            },
            {
              "name": "All tokens unselected",
              "steps": [
                "Given an active mob exists with member tokens",
                "When GM unselects all tokens",
                "Then Mob Manager removes all tokens from mob membership",
                "And mob has zero member tokens"
              ]
            }
          ]
        },
        {
          "name": "Display Mob Grouping in Combat Tracker",
          "description": "Combat Tracker receives mob creation notification from Mob domain object and updates display to show mob membership",
              "behavioral_ac": [
            "When a mob member is added to combat tracker (by dragging or right-clicking \"add to tracker\"), then that member becomes the Mob leader",
            "When Mob leader is added to combat tracker, then combat tracker displays token indicating mob leader status, and indicating the number of members in the mob",
            "When any other mob member is added to the combat tracker a dialog box appears indicating that mob leader already added and the mob member is not added to the combat tracker",
            "When the membership is updated, then the mob leader indicator will change to reflect the updated number of people in the mob",
            "When the mob leader is removed from the mob and the leader was in combat tracker, then the mob leader is removed from the combat tracker"
              ],
              "scenarios": [
                {
              "name": "Background",
                  "steps": [
                "Given a mob exists with multiple member tokens",
                "And mob has a leader token assigned",
                "And combat tracker is available"
              ]
            },
            {
              "name": "Mob leader added to combat tracker displays indicator",
              "steps": [
                "Given a mob exists with <member_count> member tokens",
                "And mob has no leader assigned",
                "When a mob member is added to combat tracker (by dragging to combat tracker or right-clicking and choosing \"add to tracker\")",
                "Then that member becomes the Mob leader",
                "And combat tracker displays token indicating mob leader status",
                "And combat tracker displays the number of members in the mob (<member_count>)"
              ],
              "examples": [
                {"member_count": 1},
                {"member_count": 3},
                {"member_count": 5},
                {"member_count": 10}
              ]
            },
            {
              "name": "Other mob members prevented from being added to combat tracker",
              "steps": [
                "Given mob leader is already added to combat tracker",
                "And mob has other member tokens",
                "When GM attempts to add another mob member to combat tracker (by dragging to combat tracker or right-clicking and choosing \"add to tracker\")",
                "Then Mob Manager intercepts the add to combat tracker action",
                "And a dialog box appears indicating that mob leader already added",
                "And the mob member is not added to the combat tracker",
                "And only the mob leader appears in combat tracker"
              ]
            },
            {
              "name": "Mob membership update reflects in combat tracker indicator",
              "steps": [
                "Given mob leader is displayed in combat tracker with member count indicator",
                "When mob membership is updated (tokens added or removed)",
                "Then mob leader indicator changes to reflect the updated number of members in the mob",
                "And combat tracker display updates automatically"
              ]
            },
            {
              "name": "Mob leader removal removes leader from combat tracker",
                  "steps": [
                "Given mob leader is in combat tracker",
                "And mob has other member tokens",
                "When mob leader is removed from the mob",
                "Then the mob leader is removed from the combat tracker",
                "And no new leader is assigned",
                "And mob has no leader until another member is added to combat tracker"
              ]
            },
            {
              "name": "All mob members removed",
              "steps": [
                "Given mob leader is in combat tracker",
                "When all mob members are removed from the mob",
                "Then mob leader is removed from combat tracker",
                "And mob no longer part of the Combat tracker"
              ]
            }
          ]
        },
        {
          "name": "Execute Mob Attack with Strategy",
          "description": "Combat Tracker moves to mob leader's turn, Mob domain object determines target from Select Target strategy, GM attacks with mob leader choosing attack and target, and Mob domain object forwards action to all members",
          "behavioral_ac": [
            "When Combat Tracker advances to next turn, then Combat Tracker notifies the Mob Manager about the turn advancement",
            "When the Mob Manager is notified about turn advancement, the Mob Manager checks to see if the current turn's token is a mob leader",
            "When the Mob Manager identifies that it is a mob leader's turn, then the Mob Manager asks the Mob domain object to evaluate and execute the strategy associated with it",
            "When the Mob Manager evaluates the strategy associated with it and determines that the strategy has all the appropriate parameters determined it then executes the strategy",
            "When the Mob domain object executes the strategy it executes the attack as determined by the strategy on the target as determined by the strategy",
            "When the Mob domain object executes the attack on the target as determined by the strategy then it forwards that attack to the Mutants and Masterminds combat system for every member in the mob"
          ],
          "scenarios": [
            {
              "name": "Background",
              "steps": [
                "Given a mob exists with multiple member tokens",
                "And mob leader is in combat tracker",
                "And Attack Common Target strategy is configured for the mob",
                "And attack and target have been associated with the mob",
                "And it is the mob's turn in combat tracker"
              ]
            },
            {
              "name": "Mob attack executes when strategy parameters are complete",
              "steps": [
                "Given Combat Tracker advances to next turn",
                "When Combat Tracker notifies Mob Manager about turn advancement",
                "And Mob Manager checks if current turn's token is a mob leader",
                "And Mob Manager identifies it is a mob leader's turn",
                "And Mob Manager retrieves strategy configuration",
                "And strategy has all appropriate parameters determined (attack and target associated)",
                "Then Mob Manager asks Mob domain object to evaluate and execute the strategy",
                "And Mob domain object executes the attack as determined by the strategy on the target as determined by the strategy",
                "And Mob domain object forwards that attack to the Mutants and Masterminds combat system for every member in the mob"
              ]
            },
            {
              "name": "Strategy does not execute when parameters incomplete",
              "steps": [
                "Given Combat Tracker advances to next turn",
                "And it is mob leader's turn",
                "When Mob Manager retrieves strategy configuration",
                "And strategy does not have all parameters determined (attack or target not associated)",
                "Then Mob Manager does not execute the strategy",
                "And no attacks are forwarded to Mutants and Masterminds combat system",
                "And Mob Manager waits for GM to execute attack to associate attack and target"
              ]
            },
            {
              "name": "Different attack types executed for all mob members",
              "steps": [
                "Given mob has <member_count> member tokens",
                "And attack <attack_type> and target <target_name> are associated with mob",
                "And it is mob leader's turn",
                "When strategy executes",
                "Then Mob domain object forwards <attack_type> attack to Mutants and Masterminds combat system for all <member_count> members",
                "And all members attack <target_name> with <attack_type>"
              ],
              "examples": [
                {"member_count": 3, "attack_type": "Blast", "target_name": "Hero A"},
                {"member_count": 5, "attack_type": "Strike", "target_name": "Villain B"},
                {"member_count": 10, "attack_type": "Grab", "target_name": "Minion C"}
              ]
            },
            {
              "name": "Not mob leader's turn",
              "steps": [
                "Given Combat Tracker advances to next turn",
                "When Combat Tracker notifies Mob Manager about turn advancement",
                "And Mob Manager checks if current turn's token is a mob leader",
                "And current turn's token is not a mob leader",
                "Then Mob Manager does not evaluate or execute strategy",
                "And no attacks are executed"
              ]
            },
            {
              "name": "No strategy configured",
              "steps": [
                "Given mob exists",
                "And it is mob leader's turn",
                "When Mob Manager retrieves strategy configuration",
                "And no strategy is configured for the mob",
                "Then Mob Manager does not execute any strategy",
                "And no attacks are forwarded"
              ]
            }
          ]
        },
        {
          "name": "Display Attack Results in Chat",
          "description": "Chat system receives attack result events from Combat system and displays formatted results for all mob members",
          "behavioral_ac": [
            "When Mob Manager forwards attacks to the Mutants and Masterminds combat system for all mob members, then the combat system executes attacks normally and sends attack result events to Chat System",
            "When Chat System receives attack result events, then Mob Manager intercepts the attack result events and reformats the attack chat dialogue to summarize all mob attacks results in one view",
            "When Mob Manager creates the summary chat dialogue, then Mob Manager provides a single resistance button for all mob attacks instead of individual resistance buttons for each attack",
            "When the user or GM clicks on the resistance button, then Mob Manager intercepts the resistance button click and runs the resistance roll for every attack that actually hit"
          ],
          "scenarios": [
            {
              "name": "Background",
              "steps": [
                "Given mob has executed attacks through Mutants and Masterminds combat system",
                "And combat system has generated attack result events",
                "And Chat System has received attack result events"
              ]
            },
            {
              "name": "Mob Manager intercepts and summarizes attack results",
              "steps": [
                "Given Mutants and Masterminds combat system has executed attacks for <member_count> mob members",
                "And combat system sends attack result events to Chat System",
                "When Chat System receives attack result events",
                "Then Mob Manager intercepts the attack result events",
                "And Mob Manager reformats the attack chat dialogue to summarize all mob attacks results in one view",
                "And Mob Manager provides a single resistance button for all mob attacks instead of individual resistance buttons for each attack"
              ],
              "examples": [
                {"member_count": 3},
                {"member_count": 5},
                {"member_count": 10}
              ]
            },
            {
              "name": "Resistance button executes rolls for all hits",
              "steps": [
                "Given Mob Manager has created summary chat dialogue with single resistance button",
                "And <hit_count> attacks actually hit the target",
                "When user or GM clicks on the resistance button",
                "Then Mob Manager intercepts the resistance button click",
                "And Mob Manager runs the resistance roll for every attack that actually hit (<hit_count> rolls)"
              ],
              "examples": [
                {"hit_count": 1},
                {"hit_count": 3},
                {"hit_count": 5},
                {"hit_count": 0}
              ]
            },
            {
              "name": "All attacks miss",
              "steps": [
                "Given mob has executed attacks",
                "And all attacks miss the target",
                "When Chat System receives attack result events",
                "Then Mob Manager intercepts and creates summary dialogue",
                "And summary dialogue shows all attacks missed",
                "And resistance button is not provided (no hits to resist)"
              ]
            },
            {
              "name": "Mixed attack results",
              "steps": [
                "Given mob has executed attacks",
                "And some attacks hit and some miss",
                "When Chat System receives attack result events",
                "Then Mob Manager intercepts and creates summary dialogue",
                "And summary dialogue shows which attacks hit and which missed",
                "And single resistance button is provided",
                "And resistance button executes rolls only for attacks that hit"
              ]
            },
            {
              "name": "Chat System behavior unchanged",
              "steps": [
                "Given Chat System receives attack result events",
                "When Mob Manager intercepts the events",
                "Then Chat System continues to function normally",
                "And Chat System is not modified by Mob Manager",
                "And Mob Manager only wraps/intercepts the display formatting"
              ]
            }
          ]
        },
        {
          "name": "Apply Attack Common Target Strategy",
          "description": "GM selects Attack Common Target strategy for mob, and Mob domain object applies strategy when mob's turn begins by querying Combat Tracker for common target",
          "behavioral_ac": [
            "When GM selects Attack Common Target strategy for mob (currently automatically selected whenever we initiate creating a new mob), then Mob Manager associates the mob being edited with the Attack Common Target strategy",
            "When Combat Tracker advances to next turn, then Combat Tracker notifies Mob Manager about the turn advancement",
            "When Mob Manager is notified about turn advancement, then Mob Manager checks to see if the current turn's token is a mob leader",
            "When Mob Manager identifies that it is a mob leader's turn, then Mob Manager retrieves the Attack Common Target strategy configuration for the mob",
            "When Mob Manager retrieves the strategy configuration, then Mob Manager determines if a common attack and or target has been selected for the mob",
            "When a common attack and target has not been selected for the mob then the Mob Manager waits for an attack to be executed by the mob leader on another token",
            "When the GM executes an attack from the mob leader onto another target with a specific attack then that target and that attack is associated with the mob",
            "When it is the mob's turn in the Combat tracker and an attack and a target has been associated with the mob strategy then the mob strategy executes"
          ],
          "scenarios": [
            {
              "name": "Background",
              "steps": [
                "Given a mob exists",
                "And mob leader is in combat tracker",
                "And Attack Common Target strategy is configured for the mob"
              ]
            },
            {
              "name": "Strategy automatically selected on mob creation",
              "steps": [
                "Given GM initiates creating a new mob",
                "When mob is created",
                "Then Attack Common Target strategy is automatically selected",
                "And Mob Manager associates the mob with Attack Common Target strategy"
              ]
            },
            {
              "name": "Strategy waits for GM attack when parameters not set",
              "steps": [
                "Given Attack Common Target strategy is configured for mob",
                "And it is mob leader's turn",
                "When Mob Manager retrieves strategy configuration",
                "And Mob Manager determines attack and target have not been selected",
                "Then Mob Manager waits for an attack to be executed by the mob leader",
                "And strategy does not execute"
              ]
            },
            {
              "name": "GM attack associates target and attack with mob",
              "steps": [
                "Given Attack Common Target strategy is configured for mob",
                "And it is mob leader's turn",
                "And attack and target have not been selected",
                "When GM executes an attack from the mob leader onto target <target_name> with attack <attack_type>",
                "Then that target (<target_name>) is associated with the mob",
                "And that attack (<attack_type>) is associated with the mob",
                "And Mob Manager stores the target and attack association"
              ],
              "examples": [
                {"target_name": "Hero A", "attack_type": "Blast"},
                {"target_name": "Villain B", "attack_type": "Strike"},
                {"target_name": "Minion C", "attack_type": "Grab"}
              ]
            },
            {
              "name": "Strategy executes automatically after GM attack sets parameters",
              "steps": [
                "Given Attack Common Target strategy is configured for mob",
                "And it is mob leader's turn",
                "And attack and target have not been selected",
                "When GM executes an attack from the mob leader onto target <target_name> with attack <attack_type>",
                "Then that target (<target_name>) is associated with the mob",
                "And that attack (<attack_type>) is associated with the mob",
                "And Mob Manager stores the target and attack association",
                "And Mob Manager automatically executes the strategy for all mob members except the leader",
                "And the same attack (<attack_type>) is forwarded to all mob members except the leader against the same target (<target_name>)",
                "But the leader's attack has already been executed, so it is not repeated"
              ],
              "examples": [
                {"target_name": "Hero A", "attack_type": "Blast"},
                {"target_name": "Villain B", "attack_type": "Strike"},
                {"target_name": "Minion C", "attack_type": "Grab"}
              ]
            },
            {
              "name": "Strategy executes when attack and target associated",
              "steps": [
                "Given Attack Common Target strategy is configured for mob",
                "And attack <attack_type> and target <target_name> have been associated with mob",
                "And it is mob's turn in Combat tracker",
                "When Mob Manager retrieves strategy configuration",
                "And Mob Manager determines attack and target have been selected",
                "Then mob strategy executes (see Story 3: Execute Mob Attack with Strategy for execution details)"
              ],
              "examples": [
                {"attack_type": "Blast", "target_name": "Hero A"},
                {"attack_type": "Strike", "target_name": "Villain B"},
                {"attack_type": "Grab", "target_name": "Minion C"}
              ]
            },
            {
              "name": "Strategy not executed when not mob's turn",
              "steps": [
                "Given Attack Common Target strategy is configured for mob",
                "And attack and target have been associated",
                "When it is not the mob's turn in Combat tracker",
                "Then Mob Manager does not execute the strategy",
                "And strategy waits for mob's turn"
              ]
            },
            {
              "name": "Turn advancement triggers strategy check",
              "steps": [
                "Given Attack Common Target strategy is configured for mob",
                "When Combat Tracker advances to next turn",
                "Then Combat Tracker notifies Mob Manager about turn advancement",
                "And Mob Manager checks if current turn's token is a mob leader",
                "And if it is mob leader's turn, Mob Manager retrieves strategy configuration"
              ]
            },
            {
              "name": "Strategy waits after attack and target cleared",
              "steps": [
                "Given Attack Common Target strategy is configured for mob",
                "And attack and target were previously associated with mob",
                "And GM has cleared the attack and target using clear button",
                "When it is mob leader's turn",
                "And Mob Manager retrieves strategy configuration",
                "And Mob Manager determines attack and target have been cleared (not selected)",
                "Then Mob Manager waits for an attack to be executed by the mob leader",
                "And strategy does not execute",
                "And GM must execute a new attack to set new parameters"
              ]
            }
          ]
        },
        {
          "name": "Display Selected Common Target",
          "description": "Combat Tracker receives target selection notification from Mob domain object and updates display to show mob's selected common target",
          "behavioral_ac": [
            "When Mob Manager has determined the target and attack for a strategy, then Mob Manager stores the target and notifies the Mob Manager dialog of the changes in attack and target",
            "When the Mob Manager dialog receives target / attack change notification, the Mob Manager dialog is updated to indicate who the target is and what the attack is"
          ],
          "scenarios": [
            {
              "name": "Background",
              "steps": [
                "Given Attack Common Target strategy is configured for mob",
                "And Mob Manager dialog is open or available"
              ]
            },
            {
              "name": "Mob Manager dialog displays target and attack",
              "steps": [
                "Given Mob Manager has determined target <target_name> and attack <attack_type> for strategy",
                "When Mob Manager stores the target and attack",
                "And Mob Manager notifies Mob Manager dialog of the changes",
                "Then Mob Manager dialog receives target / attack change notification",
                "And Mob Manager dialog is updated to indicate target is <target_name>",
                "And Mob Manager dialog is updated to indicate attack is <attack_type>"
              ],
              "examples": [
                {"target_name": "Hero A", "attack_type": "Blast"},
                {"target_name": "Villain B", "attack_type": "Strike"},
                {"target_name": "Minion C", "attack_type": "Grab"}
              ]
            },
            {
              "name": "Dialog updates when target changes",
              "steps": [
                "Given Mob Manager dialog is displaying target <old_target> and attack <attack_type>",
                "When GM executes a new attack from mob leader onto target <new_target>",
                "And Mob Manager associates new target <new_target> with mob",
                "And Mob Manager notifies dialog of changes",
                "Then Mob Manager dialog updates to show target <new_target>",
                "And attack remains <attack_type> (if same attack) or updates to new attack"
              ],
              "examples": [
                {"old_target": "Hero A", "new_target": "Villain B", "attack_type": "Blast"},
                {"old_target": "Villain B", "new_target": "Minion C", "attack_type": "Strike"}
              ]
            },
            {
              "name": "Dialog updates when attack changes",
              "steps": [
                "Given Mob Manager dialog is displaying target <target_name> and attack <old_attack>",
                "When GM executes a new attack <new_attack> from mob leader onto same target <target_name>",
                "And Mob Manager associates new attack <new_attack> with mob",
                "And Mob Manager notifies dialog of changes",
                "Then Mob Manager dialog updates to show attack <new_attack>",
                "And target remains <target_name>"
              ],
              "examples": [
                {"target_name": "Hero A", "old_attack": "Blast", "new_attack": "Strike"},
                {"target_name": "Villain B", "old_attack": "Strike", "new_attack": "Grab"}
              ]
            },
            {
              "name": "Dialog not open when target/attack determined",
              "steps": [
                "Given Mob Manager has determined target and attack for strategy",
                "When Mob Manager dialog is not open",
                "Then Mob Manager stores the target and attack",
                "And Mob Manager stores notification for when dialog is opened",
                "And when dialog is opened, it displays the stored target and attack"
              ]
            },
            {
              "name": "Multiple target/attack changes",
              "steps": [
                "Given Mob Manager dialog is displaying current target and attack",
                "When GM executes multiple attacks from mob leader",
                "And Mob Manager associates new target and attack each time",
                "Then Mob Manager dialog updates each time with the latest target and attack",
                "And dialog always shows the most recent association"
              ]
            },
            {
              "name": "GM clears attack and target selection",
              "steps": [
                "Given Mob Manager dialog is displaying target <target_name> and attack <attack_type>",
                "When GM clicks clear button in Mob Manager dialog",
                "Then Mob Manager clears the target and attack association for the mob",
                "And Mob Manager dialog updates to show no target and no attack selected",
                "And on the next round when it is the mob leader's turn, the strategy will wait for a new attack to be executed",
                "And the strategy will not execute until a new attack and target are selected"
              ],
              "examples": [
                {"target_name": "Hero A", "attack_type": "Blast"},
                {"target_name": "Villain B", "attack_type": "Strike"},
                {"target_name": "Minion C", "attack_type": "Grab"}
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Mob Panel and Basic Target Strategies",
      "priority": "NEXT",
      "relative_size": "Medium",
      "approach": "Quick Win + Increasing Reuse/Dependency",
      "focus": "Mob panel UI and simplest target-focused strategies",
      "stories": [
        "Open Mob Configuration Panel",
        "Display Mob Configuration in Panel",
        "Select Mob Strategy from Panel",
        "Apply Attack Most Powerful Strategy",
        "Display Selected Most Powerful Target",
        "Apply Attack Weakest Strategy",
        "Display Selected Weakest Target"
      ]
    },
    {
      "name": "Advanced Target Strategies and Leader Configuration",
      "priority": "NEXT",
      "relative_size": "Medium",
      "approach": "Maximizing Earned Value",
      "focus": "Advanced target strategies, leader configuration, and mob membership management",
      "stories": [
        "Apply Defend Leader Strategy",
        "Apply Retaliation Strategy",
        "Set Mob Leader (inside or outside mob)",
        "Modify Mob Membership (drag tokens from canvas onto panel mob member area)"
      ]
    },
    {
      "name": "Attack Selection Strategies",
      "priority": "LATER",
      "relative_size": "Medium",
      "approach": "Quick Win + Increasing Reuse/Dependency",
      "focus": "Attack effectiveness strategies and sequential attack patterns",
      "stories": [
        "Apply Most Powerful Attack Strategy",
        "Apply Most Effective Attack Against Target Strategy",
        "Apply Sequential Attack Strategy (apply attacks in order, when one succeeds move to next)",
        "Apply Manual Attack Selection Strategy",
        "Apply Per-Member Attack Strategy"
      ]
    },
    {
      "name": "Movement and Range Strategies",
      "priority": "LATER",
      "relative_size": "Medium",
      "approach": "Quick Win + Increasing Reuse/Dependency",
      "focus": "Movement strategies for positioning and range management",
      "stories": [
        "Move When Out of Range Strategy",
        "Determine Available Attacks (range, melee, pathfinding, area attack)",
        "Apply Pathfinding to Target Strategy"
      ]
    },
    {
      "name": "AI-Assisted Behavior - Targeting",
      "priority": "LATER",
      "relative_size": "Large",
      "approach": "Validating Impact - Feasibility",
      "focus": "AI-assisted target selection",
      "stories": [
        "AI-Assisted Target Selection (foundation)",
        "AI-Assisted Target Analysis",
        "AI-Assisted Threat Assessment"
      ]
    },
    {
      "name": "AI-Assisted Behavior - Attacks",
      "priority": "LATER",
      "relative_size": "Large",
      "approach": "Validating Impact - Feasibility",
      "focus": "AI-assisted attack selection",
      "stories": [
        "AI-Assisted Attack Selection",
        "AI-Assisted Attack Effectiveness Analysis",
        "AI-Assisted Attack Sequencing"
      ]
    },
    {
      "name": "AI-Assisted Behavior - Movement and Other",
      "priority": "LATER",
      "relative_size": "Large",
      "approach": "Validating Impact - Feasibility",
      "focus": "AI-assisted movement and other behaviors",
      "stories": [
        "AI-Assisted Movement Decisions",
        "AI-Assisted Positioning",
        "AI-Assisted Other Behaviors"
      ]
    },
    {
      "name": "Aggression System",
      "priority": "LATER",
      "relative_size": "Large",
      "approach": "Validating Impact - Feasibility",
      "focus": "MOB aggression component with MMO-style rules",
      "stories": [
        "Create Aggro System Component",
        "Calculate Aggro Values",
        "Apply Aggro-Based Target Selection Strategy",
        "Apply Automated Aggro Management"
      ]
    },
    {
      "name": "Player Mob Management",
      "priority": "LATER",
      "relative_size": "Medium",
      "approach": "Maximizing Earned Value",
      "focus": "Enable players to manage mobs with GM permission",
      "stories": [
        "Player Requests Mob Creation",
        "GM Approves Player Mob",
        "Player Configures Mob Strategy",
        "Player Executes Mob Actions"
      ]
    }
  ]
}
