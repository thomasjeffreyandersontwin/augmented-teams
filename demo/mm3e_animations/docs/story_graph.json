{
  "solution": {
    "name": "MM3e Animations Module",
    "purpose": "Provides descriptor-based animation system for Mutants and Masterminds 3rd Edition powers in Foundry VTT, enabling automatic and manual animation playback based on power descriptors, range types, area shapes, and effects. Focuses on flexible domain model supporting reusable animation components that can be easily extended."
  },
  "epics": [
    {
      "name": "Build Animation from Components",
      "purpose": "Animation Builder assembles animations from parameterized/templatized components (Self, Projected Area, Targeted, Movement types) based on power characteristics, reducing boilerplate and enabling easy extension.",
      "features": [
        {
          "name": "Assemble Animation from Base Templates",
          "purpose": "Animation Builder receives power characteristics from Power Item Analyzer, requests base templates from Descriptor Association, instantiates templates with power-specific parameters, combines templates into complete sequence.",
          "stories": [
            {
              "name": "Receive Power Characteristics",
              "description": "Power Item Analyzer extracts descriptor, range, area, effect from power item and passes to Animation Builder",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Request Base Templates",
              "description": "Animation Builder constructs lookup key from descriptor+range+area+effect and requests templates from Descriptor Association",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "Instantiate Cast Template",
              "description": "Animation Builder instantiates cast template with caster token location",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "Instantiate Project Template",
              "description": "Animation Builder instantiates project template from caster to target for ranged powers",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            },
            {
              "name": "Instantiate Affect Template",
              "description": "Animation Builder instantiates affect template at target/area location",
              "optional": false,
              "sequential_order": 5,
              "vertical_order": null
            },
            {
              "name": "Combine Templates into Sequence",
              "description": "Animation Builder combines all instantiated templates into single animation sequence with proper timing",
              "optional": false,
              "sequential_order": 6,
              "vertical_order": null
            }
          ]
        },
        {
          "name": "Parameterize Animation Components",
          "purpose": "Animation Builder receives animation component templates from Descriptor Association, applies power-specific parameters (animation file, duration, sound, motion effects) to create configured component instances.",
          "stories": [
            {
              "name": "Receive Component Template",
              "description": "Animation Builder receives animation component template from Descriptor Association",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Apply Animation File Path",
              "description": "Animation Builder applies animation file path parameter to component template",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "Apply Duration Parameter",
              "description": "Animation Builder applies duration parameter to component template",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "Apply Sound File",
              "description": "Animation Builder applies sound file parameter if specified in template",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            },
            {
              "name": "Apply Motion Effects",
              "description": "Animation Builder applies motion effects parameter if specified in template",
              "optional": false,
              "sequential_order": 5,
              "vertical_order": null
            },
            {
              "name": "Create Configured Component",
              "description": "Animation Builder creates configured component instance from parameterized template",
              "optional": false,
              "sequential_order": 6,
              "vertical_order": null
            }
          ]
        }
      ],
      "sub_epics": []
    },
    {
      "name": "Launch Animation on Attack",
      "purpose": "System automatically triggers animation when attacks are made, handling different attack conditions (hit, miss, defend, crit) and integrating with MM3e attack system, targeting system, and chat attack system.",
      "features": [
        {
          "name": "Trigger Animation on Attack Hit",
          "purpose": "MM3e Attack System fires attackRolled hook with hit result, Animation Trigger receives event, extracts power and target data, requests hit animation from Animation Builder, Sequencer Integration executes animation.",
          "stories": [
            {
              "name": "Receive Attack Rolled Hook",
              "description": "Animation Trigger listens to attackRolled hook and receives hook event with hit condition",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Extract Power Item",
              "description": "Animation Trigger extracts power item reference from attack data",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "Extract Target Token",
              "description": "Animation Trigger extracts target token reference from attack data",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "Request Hit Animation",
              "description": "Animation Trigger requests hit animation from Animation Builder with power characteristics and hit condition",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            },
            {
              "name": "Assemble Hit Animation",
              "description": "Animation Builder assembles animation with hit condition and passes sequence to Sequencer Integration",
              "optional": false,
              "sequential_order": 5,
              "vertical_order": null
            },
            {
              "name": "Execute Animation",
              "description": "Sequencer Integration executes animation at target location showing hit effect",
              "optional": false,
              "sequential_order": 6,
              "vertical_order": null
            }
          ]
        },
        {
          "name": "Trigger Animation on Attack Miss",
          "purpose": "MM3e Attack System fires attackRolled hook with miss result, Animation Trigger receives event, requests miss animation from Animation Builder, Animation Builder modifies projection to show miss, Sequencer Integration executes miss animation.",
          "stories": [
            {
              "name": "Receive Miss Hook Event",
              "description": "Animation Trigger receives attackRolled hook with miss condition",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Request Miss Animation",
              "description": "Animation Trigger requests miss animation from Animation Builder",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "Assemble Miss Animation",
              "description": "Animation Builder assembles animation with miss condition",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "Modify Projection for Miss",
              "description": "Animation Builder modifies projection component to stop short of target or fizzle",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            },
            {
              "name": "Add Fizzle Effect",
              "description": "Animation Builder adds fizzle effect at projection end point",
              "optional": false,
              "sequential_order": 5,
              "vertical_order": null
            },
            {
              "name": "Execute Miss Animation",
              "description": "Sequencer Integration executes miss animation showing projection that doesn't reach target",
              "optional": false,
              "sequential_order": 6,
              "vertical_order": null
            }
          ]
        },
        {
          "name": "Launch Animation from Chat Button",
          "purpose": "Chat Attack System renders attack message with Run Animation button, Player clicks button, Chat Attack System extracts attack data, requests animation from Animation Trigger, Animation Trigger processes request same as automatic trigger.",
          "stories": [
            {
              "name": "Add Run Animation Button",
              "description": "Chat Attack System renders attack message and adds Run Animation button to message",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Handle Button Click",
              "description": "Player clicks Run Animation button and Chat Attack System receives click event",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "Extract Power Item ID",
              "description": "Chat Attack System extracts power item ID from message data",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "Extract Target Token ID",
              "description": "Chat Attack System extracts target token ID from message data",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            },
            {
              "name": "Extract Attack Condition",
              "description": "Chat Attack System extracts attack condition from message",
              "optional": false,
              "sequential_order": 5,
              "vertical_order": null
            },
            {
              "name": "Request Animation from Trigger",
              "description": "Chat Attack System requests animation from Animation Trigger with extracted data",
              "optional": false,
              "sequential_order": 6,
              "vertical_order": null
            },
            {
              "name": "Process Manual Trigger",
              "description": "Animation Trigger processes request same as automatic trigger and launches animation",
              "optional": false,
              "sequential_order": 7,
              "vertical_order": null
            }
          ]
        }
      ],
      "sub_epics": []
    },
    {
      "name": "Associate Descriptors with Animations",
      "purpose": "System maps power descriptors to animation component configurations, enabling automatic animation selection and providing extensible mechanism for adding new descriptors and components.",
      "features": [
        {
          "name": "Lookup Animation Components by Descriptor",
          "purpose": "Animation Builder receives power characteristics, constructs lookup key, requests component configuration from Descriptor Registry, receives configuration, uses configuration to assemble animation.",
          "stories": [
            {
              "name": "Construct Lookup Key",
              "description": "Animation Builder constructs lookup key from descriptor+range+area+effect",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Request Configuration",
              "description": "Animation Builder requests component configuration from Descriptor Registry using lookup key",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "Lookup Descriptor Mapping",
              "description": "Descriptor Registry looks up descriptor mapping using provided key",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "Return Component Configuration",
              "description": "Descriptor Registry returns component configuration (cast, project, affect templates)",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            },
            {
              "name": "Use Configuration for Assembly",
              "description": "Animation Builder uses returned configuration to assemble animation",
              "optional": false,
              "sequential_order": 5,
              "vertical_order": null
            }
          ]
        },
        {
          "name": "Register New Descriptor Configuration",
          "purpose": "Content Creator provides new descriptor name and component configuration, Descriptor Registry validates configuration, stores mapping, makes new descriptor available for lookup.",
          "stories": [
            {
              "name": "Receive Registration Request",
              "description": "Descriptor Registry receives registration request with descriptor name and component configuration",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Validate Configuration Structure",
              "description": "Descriptor Registry validates configuration structure is correct format",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "Verify Component References",
              "description": "Descriptor Registry verifies component references exist in Component Library",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "Store Descriptor Mapping",
              "description": "Descriptor Registry stores descriptor-to-component mapping",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            },
            {
              "name": "Make Descriptor Available",
              "description": "New descriptor becomes available for animation lookup",
              "optional": false,
              "sequential_order": 5,
              "vertical_order": null
            }
          ]
        }
      ],
      "sub_epics": []
    },
    {
      "name": "Analyze Power Items",
      "purpose": "System extracts power characteristics (descriptor, range, area, effect) from MM3e power items, providing clean interface between MM3e system and animation system.",
      "features": [
        {
          "name": "Extract Power Characteristics from Item",
          "purpose": "Power Item Analyzer receives MM3e power item, extracts descriptor, range type, area shape, effect type, returns Power Characteristics object.",
          "stories": [
            {
              "name": "Receive Power Item",
              "description": "Power Item Analyzer receives MM3e power item",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Extract Descriptor",
              "description": "Power Item Analyzer reads descriptor from item.system.descriptors",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "Determine Range Type",
              "description": "Power Item Analyzer determines range type (Melee/Range/Personal) from item.system.range or attack.defenseType",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "Determine Area Shape",
              "description": "Power Item Analyzer determines area shape if present (Burst/Cone/Line) from item.system.extras",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            },
            {
              "name": "Determine Effect Type",
              "description": "Power Item Analyzer determines effect type (Damage/Affliction/etc) from item.system.effects",
              "optional": false,
              "sequential_order": 5,
              "vertical_order": null
            },
            {
              "name": "Return Power Characteristics",
              "description": "Power Item Analyzer returns Power Characteristics object with extracted data",
              "optional": false,
              "sequential_order": 6,
              "vertical_order": null
            }
          ]
        }
      ],
      "sub_epics": []
    }
  ],
  "increments": [
    {
      "name": "Core Animation System",
      "priority": "NOW",
      "relative_size": "Large",
      "approach": "Build core domain model with Animation Builder, Descriptor Association, and basic component types. Implement integration with MM3e attack system for hit/miss conditions. Focus on getting domain model right for extensibility.",
      "focus": "Establish flexible domain model supporting component-based animation assembly. Implement basic integration points with MM3e system, targeting, and sequencer. Support hit and miss conditions.",
      "stories": [
        "Receive Power Characteristics",
        "Request Base Templates",
        "Instantiate Cast Template",
        "Instantiate Project Template",
        "Instantiate Affect Template",
        "Combine Templates into Sequence",
        "Receive Attack Rolled Hook",
        "Extract Power Item",
        "Extract Target Token",
        "Request Hit Animation",
        "Assemble Hit Animation",
        "Execute Animation",
        "Construct Lookup Key",
        "Request Configuration",
        "Return Component Configuration",
        "Receive Power Item",
        "Extract Descriptor",
        "Determine Range Type",
        "Return Power Characteristics"
      ]
    }
  ]
}
