{
  "epics": [
    {
      "name": "Start Story Development Session",
      "purpose": "User initiates story development by adding documents to chat and requesting story shaping",
      "features": [
        {
          "name": "Initialize Story Agent Workflow",
          "purpose": "User adds documents/models/text/diagrams to chat and requests story shaping, triggering Story Agent workflow initialization",
          "story_count": "3",
          "stories": [
            {
              "name": "User Adds Context to Chat",
              "description": "User adds documents, models, text descriptions, diagrams to Cursor/VS Code chat window and requests to start shaping/planning/building a new project",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "AI Chat Invokes Story Agent MCP",
              "description": "AI Chat detects story shaping request and calls Story Agent MCP Server via agent_get_state or agent_get_instructions tool",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "MCP Server Initializes Agent",
              "description": "Story Agent MCP Server (agent_mcp_server.py) calls AgentStateManager.get_agent() which creates Agent instance with agent_name=\"stories\", loads agent.json from agents/stories/agent.json, creates Project with activity_area=\"stories\", initializes Workflow with behaviors dictionary from agent.json",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            }
          ]
        },
        {
          "name": "Load Configuration from JSON",
          "purpose": "Base Agent loads configuration files (agent.json) to initialize behaviors, guardrails, rules, and content configs",
          "story_count": "4",
          "stories": [
            {
              "name": "Load Base Agent Config",
              "description": "Agent._load_base_agent_config() loads agents/base/agent.json and retrieves prompt_templates and trigger_words into Agent._prompt_templates and Agent._base_trigger_words",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Load Story Agent Config",
              "description": "Agent._load_agent_config() loads agents/stories/agent.json, creates Rules from rules config, initializes behaviors dictionary by creating Behavior objects for each behavior (shape, prioritization, discovery, exploration, specification) with order, guardrails, rules, actions, content configs",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "Initialize Workflow from Behaviors",
              "description": "Agent._initialize_components() creates Workflow instance, sets workflow._behaviors to behaviors dictionary, calls workflow._derive_stages_from_behaviors() which sorts behaviors by order property and returns stage names list, sets workflow.stages to derived stages",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "Start Workflow at Shape Behavior",
              "description": "Agent._start_workflow_if_needed() calls workflow.start_next_stage() to get first behavior (shape: order=1), then workflow.start(shape) which calls behavior.initialize_for_workflow() to reset actions and return first action (clarification), sets workflow._current_stage=\"shape\" and workflow._current_action to clarification action",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            }
          ]
        },
        {
          "name": "Clarify Context Requirements",
          "purpose": "System loads clarification questions from JSON, AI attempts to answer them, user provides feedback, MCP saves answers",
          "story_count": "6",
          "stories": [
            {
              "name": "Load Clarification Questions from JSON",
              "description": "When AI Chat calls agent_get_instructions(), MCP Server calls agent.instructions property which delegates to workflow.current_action.instructions. Clarification action generates instructions by calling behavior.guardrails.requirements_clarification_instructions which loads key_questions and evidence lists from agents/stories/agent.json behaviors.shape.guardrails.required_context",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "AI Attempts to Answer Questions",
              "description": "AI Chat receives instructions with key_questions array and evidence array, AI analyzes provided context (documents, models, text) and attempts to answer each question based on available information",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "Present Questions and Answers to User",
              "description": "AI Chat presents questions asked, answers provided, gap analysis, and requests corrections in chat window for user review",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "User Provides Feedback",
              "description": "User reviews presented questions/answers, provides corrections or additional detail for incomplete answers, confirms answers are complete",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            },
            {
              "name": "MCP Saves Clarification Answers",
              "description": "AI Chat calls agent_store_clarification(key_questions_answered, evidence_provided, additional_questions_answered). MCP Server calls agent.store() which delegates to current action (clarification).store() which calls Project.store_clarification() to update Project.clarification dict and save to project_area/docs/clarification.json",
              "optional": false,
              "sequential_order": 5,
              "vertical_order": null
            },
            {
              "name": "Track Clarification Activity",
              "description": "Project.store_clarification() calls Project.track_activity(\"store_clarification\", behavior_name, data) which creates activity entry and appends to activity_log, saves activity_log to project_area/docs/activity/activity.json",
              "optional": false,
              "sequential_order": 6,
              "vertical_order": null
            }
          ]
        },
        {
          "name": "Plan Story Development Approach",
          "purpose": "System presents assumptions and decision criteria from JSON, user selects options, MCP saves planning decisions",
          "story_count": "5",
          "stories": [
            {
              "name": "Load Planning Assumptions from JSON",
              "description": "When moving to planning action, behavior.guardrails.get_planning_instructions() loads typical_assumptions and decision_making_criteria from agents/stories/agent.json behaviors.shape.guardrails.planning, formats instructions with BaseInstructions.planning_intro",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Present Assumptions and Decision Criteria",
              "description": "AI Chat receives planning instructions with assumptions list and decision_criteria array (each with question, outcome, options), presents to user in chat window",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "User Selects Decision Options",
              "description": "User reviews assumptions, selects preferred options from decision criteria (e.g., story_drill_down: \"Dig deep on system interactions\", flow_scope: \"Journey level with component detail\"), confirms approach",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "MCP Saves Planning Decisions",
              "description": "AI Chat calls agent_store_planning(decisions_made, assumptions_made). MCP Server calls agent.store() which delegates to planning action.store() which calls Project.store_planning() to update Project.planning dict with shape section containing decisions_made and assumptions_made, saves to project_area/docs/planning.json",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            },
            {
              "name": "Track Planning Activity",
              "description": "Project.store_planning() calls Project.track_activity(\"store_planning\", behavior_name, data) which creates activity entry and appends to activity_log, saves to project_area/docs/activity/activity.json",
              "optional": false,
              "sequential_order": 5,
              "vertical_order": null
            }
          ]
        },
        {
          "name": "Build Structured Story Map Content",
          "purpose": "AI generates structured JSON story map following story_graph.json schema, MCP saves structured content",
          "story_count": "4",
          "stories": [
            {
              "name": "Load Story Graph Schema",
              "description": "When moving to build_structure action, Content.build_instructions includes instructions to load story_graph.json schema from agents/stories/story_graph.json to understand required structure (solution, epics, features, stories, increments)",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Generate Structured JSON Content",
              "description": "AI Chat follows build_instructions which include agent-level rules, behavior-level rules, and structured_content instructions from agents/stories/agent.json. AI generates structured JSON following story_graph.json schema with solution, epics array, features array, stories array, increments array",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "MCP Saves Structured Content",
              "description": "AI Chat calls agent_store_structured(structured). MCP Server calls agent.store(structured=structured) which sets current_behavior.content.structured, triggering Content.structured setter which calls Content.store(). Content.store() calls Project.store_output(structured=structured) which saves JSON to project_area/docs/stories/structured.json via Project._save_structured()",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "Create Traceability Link",
              "description": "Project.store_output() calls Project.create_traceability_link(structured, rendered) which links last activity entry in activity_log to output data (structured.json path), updates activity_log and saves to project_area/docs/activity/activity.json",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            }
          ]
        },
        {
          "name": "Render Story Map to Markdown",
          "purpose": "System transforms structured JSON to markdown using template, MCP saves rendered document",
          "story_count": "5",
          "stories": [
            {
              "name": "Load Story Map Template",
              "description": "When moving to render_output action, Content.transform_instructions includes output instructions specifying template: \"templates/story-map-decomposition-template.md\" from agents/stories/templates/, transformer: \"story_agent_transform_story_map_to_markdown\"",
              "optional": false,
              "sequential_order": 1,
              "vertical_order": null
            },
            {
              "name": "Transform Structured JSON to Markdown",
              "description": "AI Chat follows transform_instructions, loads structured JSON from project_area/docs/stories/structured.json, loads template from agents/stories/templates/story-map-decomposition-template.md, applies structured content data to template variables (solution, epic_hierarchy, source_material), generates markdown document",
              "optional": false,
              "sequential_order": 2,
              "vertical_order": null
            },
            {
              "name": "MCP Saves Rendered Markdown",
              "description": "AI Chat calls agent_store_rendered(rendered). MCP Server calls agent.store(rendered=rendered) which sets current_behavior.content.rendered[\"story_map\"], triggering Content.rendered setter which calls Content.store(). Content.store() calls Project.store_output(rendered={\"story_map\": {\"output\": rendered, \"template\": \"templates/story-map-decomposition-template.md\"}}) which saves markdown to project_area/docs/stories/map/{product_name}-story-map.md via Project._save_rendered()",
              "optional": false,
              "sequential_order": 3,
              "vertical_order": null
            },
            {
              "name": "Track Rendering Activity",
              "description": "Project.store_output() calls Project.track_activity(\"store_rendered\", behavior_name, {\"output\": \"story_map\"}) which creates activity entry and appends to activity_log, saves to project_area/docs/activity/activity.json",
              "optional": false,
              "sequential_order": 4,
              "vertical_order": null
            },
            {
              "name": "Create Output Traceability Link",
              "description": "Project.create_traceability_link() links last activity entry to rendered output data (story_map markdown file path), updates activity_log and saves to project_area/docs/activity/activity.json",
              "optional": false,
              "sequential_order": 5,
              "vertical_order": null
            }
          ]
        }
      ]
    },
    {
      "name": "Validate Story Map Content",
      "purpose": "System scans structured content for rule violations using code diagnostics, AI evaluates and generates validation report",
      "story_count": "4",
      "stories": [
        {
          "name": "Execute Code Diagnostics",
          "description": "When moving to validate action, Content.execute_diagnostic() is called with diagnostic_ref from rule config (e.g., \"story_agent_validate_verb_noun_consistency\"). Content loads diagnostic from agents/stories/src/story_agent.py (VerbNounConsistencyDiagnostic, StoryShapeDiagnostic, MarketIncrementsDiagnostic), calls diagnostic.validate(structured) which scans structured JSON for violations",
          "optional": false,
          "sequential_order": 1,
          "vertical_order": null
        },
        {
          "name": "Assemble Validation Prompt",
          "description": "Content generates validation_instructions by assembling prompt from agents/base/agent.json prompt_templates.validate.validation_instructions template, includes Content Data, examples from rules, violations found by code diagnostics, rules from agent-level and behavior-level configs",
          "optional": false,
          "sequential_order": 2,
          "vertical_order": null
        },
        {
          "name": "AI Evaluates and Generates Report",
          "description": "AI Chat receives validation prompt, evaluates structured content against all rules, generates validation report with violations list, specific examples, recommendations for fixing violations",
          "optional": false,
          "sequential_order": 3,
          "vertical_order": null
        },
        {
          "name": "Track Validation Activity",
          "description": "Content.execute_diagnostic() calls Project.track_activity(\"execute_diagnostic\", None, {\"diagnostic\": diagnostic_ref, \"violations\": len(violations)}) which creates activity entry and appends to activity_log, saves to project_area/docs/activity/activity.json",
          "optional": false,
          "sequential_order": 4,
          "vertical_order": null
        }
      ]
    },
    {
      "name": "Build Folder Structure from Story Graph",
      "purpose": "Story Agent builder creates epic/feature folders from structured JSON, archives obsolete folders",
      "story_count": "3",
      "stories": [
        {
          "name": "Load Structured Story Graph",
          "description": "StoryFolderStructureBuilder.build() loads structured JSON from project_area/docs/stories/structured.json via _load_story_graph(), parses epics array and features array",
          "optional": false,
          "sequential_order": 1,
          "vertical_order": null
        },
        {
          "name": "Create Epic and Feature Folders",
          "description": "StoryFolderStructureBuilder iterates epics, creates folder \"üéØ {epic_name}\" in project_area/docs/stories/map/, iterates features, creates folder \"‚öôÔ∏è {feature_name}\" in epic folder, handles sub_epics recursively",
          "optional": false,
          "sequential_order": 2,
          "vertical_order": null
        },
        {
          "name": "Archive Obsolete Folders",
          "description": "StoryFolderStructureBuilder compares existing epic folders with epics in structured JSON, moves obsolete folders to project_area/docs/stories/map/z_archive/{timestamp}/, never deletes folders",
          "optional": false,
          "sequential_order": 3,
          "vertical_order": null
        }
      ]
    }
  ],
  "solution": {
    "purpose": "Enable product owners, business analysts, and developers to use AI in a structured way for story shaping, discovery, exploration, and specification following Agile by Design practices. Accelerate story development from weeks/months to hours by providing structured AI assistance integrated into Cursor/VS Code environment.",
    "name": "Story Agent"
  },
  "increments": [
    {
      "name": "Core Animation System",
      "priority": "NOW",
      "relative_size": "Large",
      "approach": "Build core domain model with Animation Builder, Descriptor Association, and basic component types. Implement integration with MM3e attack system for hit/miss conditions. Focus on getting domain model right for extensibility.",
      "focus": "Establish flexible domain model supporting component-based animation assembly. Implement basic integration points with MM3e system, targeting, and sequencer. Support hit and miss conditions.",
      "stories": [
        "Receive Power Characteristics",
        "Request Base Templates",
        "Instantiate Cast Template",
        "Instantiate Project Template",
        "Instantiate Affect Template",
        "Combine Templates into Sequence",
        "Receive Attack Rolled Hook",
        "Extract Power Item",
        "Extract Target Token",
        "Request Hit Animation",
        "Assemble Hit Animation",
        "Execute Animation",
        "Construct Lookup Key",
        "Request Configuration",
        "Return Component Configuration",
        "Receive Power Item",
        "Extract Descriptor",
        "Determine Range Type",
        "Return Power Characteristics"
      ]
    }
  ]
}