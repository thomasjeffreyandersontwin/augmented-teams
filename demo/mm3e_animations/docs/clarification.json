{
  "key_questions_answered": {
    "user_types": "Product owners, business analysts, and developers who use the Story Agent to do solution analysis and story development",
    "user_goals": "GMs: Configure animations for power descriptors, customize per power/item, preview/test animations. Players: See visual feedback when using powers, experience immersive combat, trigger animations automatically/manually, create custom animations for their characters. Content Creators: Build reusable animation components, create descriptor-specific libraries, create animations for paid modules/adventure packs, share templates.",
    "primary_stakeholders": "Foundry VTT users playing Mutants and Masterminds 3rd Edition, users of new foundry-mm3 system, legacy system users migrating to new system",
    "first_user_action": "1) Activate a power during combat and see if animation plays automatically, 2) Click Run Animation button on attack chat card, 3) Edit a power item and see what animation is configured/available",
    "problems_to_eliminate": "Boilerplate code repetition (legacy has 21,000+ lines with repeated patterns), manual macro creation for every power combination, limited reusability of animation components, poor domain modeling (lacks proper OO structure), integration complexity (tightly coupled to old MM3e system)",
    "user_struggles": "Creating animations for new descriptor/effect combinations requires copying large blocks of code, understanding which animation components apply to which power types, configuring animations requires deep Sequencer API knowledge. Note: Legacy French variable names are developer-only pain point (not visible to end users)",
    "system_integrations": "Foundry VTT Core (tokens, actors/items, hooks, settings), Sequencer Module (animation playback, effect sequences, BaseSection API), New foundry-mm3 System (power/item structure, attack system, descriptor/effect data model), Animation Content Modules (JB2A, Jacks Cartoon Spell Effects, Jinkers Animation), Chat System (message rendering, button injection, roll parsing), Template System (area effect templates: Burst, Cone, Line)",
    "integration_behaviors": "Hook Integration: NEW hooks to be added to foundry-mm3 system (rollPower, attackRolled, damageSaved, renderItemSheet, renderChatMessage) - developer has control over foundry-mm3 system. Power Item Analysis: Extracts descriptor/range/area/effect from power items using new system structure. Animation Lookup Chain: 1) attached macro (via flag), 2) matching macro name, 3) descriptor-based sequence dynamically. Sequencer Integration: Builds scripts from component templates, executes with proper timing, handles token animations/projections/area effects",
    "architectural_improvements": "Better Domain Model: Proper OO structure with clear domain boundaries, Domain-Driven Design principles, Constructor injection for dependencies. Advanced Animation Builder: Parameterized/templatized synchronous components (Self, Projected Area, Targeted, Movement types) to reduce boilerplate, template system, component library for common patterns. Integration: Works with foundry-mm3 (not legacy), leverages new attack system, modern ES6+ module structure, new hooks will be added to foundry-mm3 system as needed",
    "test": "test",
    "key_goals": "Use AI in a structured way to do best practices around story shaping, discovery, exploration, and specification using Agile by Design coaching practices. Take the technical aspect of coaching and integrate it into the Cursor/VS Code environment. Accelerate story development, increase clarity through structure, make it easier for developers to generate code because specifications are so specific. Take what takes weeks and months and get it done in hours.",
    "primary_users": "Product owners, business analysts, and developers who are users of the Story Agent (not agent developers)",
    "first_action": "User adds documents, models, text descriptions, diagrams to the chat window and asks to start shaping/planning/building a new project. This starts the shaping behavior at the clarification action.",
    "problems_to_solve": "Poor hygiene in stories, inordinate amount of effort gathering information into a structure that makes sense, increasing clarity of requirements to make them testable, supporting test-driven development and behavior-driven development. Accelerating these practices by a factor of 10.",
    "struggles": "Poor story hygiene, gathering unstructured information into coherent structure, lack of clarity in requirements making them hard to test, time-consuming story development process",
    "external_systems": "Currently only interacts with Cursor/VS Code chat (AI Chat). No other external systems.",
    "integration_points": "User → AI Chat → Story Agent MCP Server → Base Agent (when needed for common infrastructure) → Content/Instructions → AI Chat → User. The Story Agent uses Base Agent for workflow orchestration, guidance application, and content generation, but the story map documents the Story Agent user experience. Base Agent is referenced when it provides specific capabilities."
  },
  "evidence_provided": {
    "technical_specifications": "agents/stories/agent.json - Story Agent configuration with behaviors (shape, prioritization, discovery, exploration, specification), guardrails, rules, and content configs. agents/stories/src/story_agent.py - Story Agent specific builders (StoryFolderStructureBuilder, DrawIOStoryBuilder, DrawIOStoryShapeBuilder) and diagnostic implementations. agents/stories/src/story_agent_test.py - Tests showing how Story Agent builders work. agents/base/src/agent.py - Base Agent implementation (Agent, Workflow, Behavior, Content, Project classes) showing common infrastructure. agents/base/src/agent_test.py - Comprehensive tests showing the flow of code and how Base Agent works (extremely important for understanding implementation). agents/base/src/agent_mcp_server.py - MCP server implementation that exposes agent capabilities to AI Chat. agents/stories/templates/ - Templates for story maps, increments, epics, features, stories. agents/stories/story_graph.json - Schema for structured story content.",
    "similar_systems": "Agile by Design coaching practices for story shaping, discovery, exploration, and specification. Existing story development workflows that take weeks/months that we want to accelerate to hours.",
    "user_journey_maps": "Power activation → Animation lookup → Sequence execution. Manual animation trigger via chat card button. Animation editor workflow: Edit power → Configure animation → Preview → Save",
    "business_model": "Open-source Foundry VTT module enhancing gameplay experience for MM3e players. Reduces manual animation configuration work. Will be used to create animations for paid modules and adventure packs",
    "test": "test",
    "user_research": "Product owners, business analysts, and developers who need structured AI assistance for story development following best practices.",
    "existing_story_maps": "agents/base/docs/agent-story-map.md - Current story map that documents Base Agent architecture. This is not completely wrong, just out of date. We should extend and update it to follow current logic, not create from scratch."
  },
  "additional_questions_answered": {
    "system_actors": "User (product owner/business analyst/developer) → AI Chat (Cursor/VS Code) → Story Agent MCP Server → Base Agent (when needed for common infrastructure like workflow orchestration, guidance, content generation) → Content/Instructions → AI Chat → User. Story map documents Story Agent user experience, with specific references to Base Agent when it provides capabilities.",
    "project_scope": "Story map documents the Story Agent, not the Base Agent. Base Agent is referenced when it provides specific capabilities. Project area is agents/stories for all documentation going forward. Key implementation files: agent.json (configuration), agent.py (main code), agent_test.py (shows flow - extremely important), story_agent.py (Story Agent builders), story_agent_test.py (Story Agent tests).",
    "reference_existing_maps": "Should reference and extend agents/base/docs/agent-story-map.md rather than creating from scratch. It documents Base Agent architecture which Story Agent uses. Need to update it to reflect current logic and extend it for Story Agent user experience."
  }
}