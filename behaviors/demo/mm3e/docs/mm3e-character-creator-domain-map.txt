MM3E CHARACTER CREATOR - DOMAIN STRUCTURE MAP

FUNCTIONAL PURPOSE:
Enable players to create M&M 3E superheroes by configuring identity, power level, abilities, and defenses following game rules and formulas.

═══════════════════════════════════════════════════════════════════════════
DOMAIN CONCEPTS (ordered by user mental model)
═══════════════════════════════════════════════════════════════════════════

1. CHARACTER IDENTITY
	Purpose: Establish fundamental identification for superhero
	
	Character Name
		- Unique identifier within user's character collection
		- Required for character existence
		- Validates uniqueness (case-insensitive)
		- Formula: COUNT(characters WHERE LOWER(name) = LOWER(input)) = 0
		- Behaviors:
			• Captures text value from user input
			• Validates uniqueness against saved characters
			• Displays "Character with this name already exists" if duplicate
			• Enables character creation when valid
	
	Hero Identity
		- Public superhero name/alias (optional)
		- Independent of character name (flexible usage)
		- Max length: 100 characters
		- Behaviors:
			• Captures text value (optional field)
			• Validates length limit
			• Displays character count warning when exceeding limit
	
	Description
		- Free-text narrative about character (optional)
		- Supports multi-line text with formatting preservation
		- Max length: 2000 characters
		- Behaviors:
			• Captures multi-line text
			• Preserves line breaks and formatting
			• Validates length limit
			• Displays character count warning when exceeding limit

2. POWER LEVEL (PL)
	Purpose: Sets character's overall power scale and establishes all building constraints
	
	Power Level Value
		- Numerical rating from 1-20+ representing power scale
		- Common values: PL 8 (street), PL 10 (standard), PL 12 (big leagues), PL 14+ (cosmic)
		- Immutable after creation (represents character tier)
		- Behaviors:
			• Selects from dropdown (PL 8, 10, 12, 14, 16, 18, 20)
			• Calculates starting power points
			• Calculates all 6 PL caps
			• Stores as character foundation
			• Marks character foundation as established
	
	Starting Power Points Budget
		- Currency for purchasing all traits (single pool)
		- Formula: PL × 15 = Starting Points
		- Examples: PL 8 = 120, PL 10 = 150, PL 12 = 180, PL 14 = 210
		- Shared across: abilities, skills, advantages, powers, defenses
		- Behaviors:
			• Calculates from PL selection
			• Displays "spent / total" format with progress bar
			• Updates remaining budget: Total - Spent (all categories)
			• Flags overspend (warn, don't prevent)
			• Shows color coding (normal, fully used, overspent)
	
	Power Level Caps (6 types)
		- Paired trait constraints enforcing balance while allowing trade-offs
		- Skill Modifier Cap: (Ability + Skill + Advantages) ≤ PL + 10
		- Attack & Effect Cap: (Attack bonus + Effect rank) ≤ PL × 2
		- Dodge & Toughness Cap: (Dodge + Toughness) ≤ PL × 2
		- Parry & Toughness Cap: (Parry + Toughness) ≤ PL × 2
		- Fortitude & Will Cap: (Fortitude + Will) ≤ PL × 2
		- Non-attack Effect Cap: Effect rank ≤ PL
		- Behaviors:
			• Calculates all 6 caps from selected PL
			• Displays calculated values with formulas
			• Updates when PL changes
			• Highlights relevant cap when trait approaches limit

3. ABILITIES (The 8 Core Abilities)
	Purpose: Foundation of character - every other trait builds upon these
	
	The 8 Abilities
		STR - Strength: Physical power, lifting, damage (affects Athletics)
		STA - Stamina: Endurance, health (affects Fortitude, Toughness - DUAL IMPACT)
		AGL - Agility: Balance, grace (affects Dodge, Acrobatics, Stealth)
		DEX - Dexterity: Coordination, accuracy (affects ranged attacks, Sleight of Hand)
		FGT - Fighting: Close combat skill (affects Parry, Close Combat)
		INT - Intellect: Reasoning, knowledge (affects Investigation, Technology)
		AWE - Awareness: Perception, willpower (affects Will, Perception, Insight)
		PRE - Presence: Personality, charisma (affects Persuasion, Intimidation, Deception)
	
	Ability Rank
		- Scale: -5 (far below average) to 20 (cosmic-level), with 0 = average
		- Rank meanings:
			• -5 to 0: Below average to average
			• 1-2: Above average
			• 3-4: Exceptional
			• 5-7: Peak human
			• 8-12: Superhuman
			• 13-20: Cosmic-level
		- Cost: 2 power points per rank
		- Formula: Cost = Rank × 2
		- Default: All abilities start at 0 (average)
		- Negative ranks allowed: -5 to -1 (below average, refunds points)
		- Behaviors:
			• Sets rank for any of 8 abilities (same logic for all)
			• Calculates cost: rank × 2
			• Deducts/adds points to budget immediately
			• Stores new rank value with character
			• Triggers cascade updates to dependent defenses
	
	Total Ability Points Spent
		- Sum of all ability costs
		- Formula: Σ(ability_rank × 2) for all 8 abilities
		- Behaviors:
			• Recalculates when any ability changes
			• Displays total in abilities section
			• Updates in real-time (<100ms)
			• Shows breakdown by ability (e.g., "STR: 10pp, STA: 6pp")
	
	Cascading Dependencies (Ability → Defense)
		- Agility → Dodge base value
		- Fighting → Parry base value
		- Stamina → Fortitude base + Toughness base (DUAL: two defenses!)
		- Awareness → Will base value
		- Other 4 abilities (STR, DEX, INT, PRE) → No defense impact
		- Behaviors:
			• When Agility changes → recalculates Dodge (10 + Agility)
			• When Fighting changes → recalculates Parry (10 + Fighting)
			• When Stamina changes → recalculates BOTH Fortitude and Toughness (Stamina)
			• When Awareness changes → recalculates Will (Awareness)
			• Updates occur synchronously (same cycle as ability update)
			• User sees ability and defense change simultaneously

4. DEFENSES (The 5 Defense Types)
	Purpose: Protect character from attacks and effects - DERIVED from abilities
	
	Active Defenses (opponent rolls against these)
		- Target numbers for opponent's attack rolls (static values)
		- Formula: 10 + Ability Rank (the +10 = base defensive readiness)
		
		Dodge
			- Avoid attacks through agility and movement
			- Formula: 10 + Agility rank
			- Source: Agility ability
			- Can purchase additional ranks (+1 pp per rank)
			- Behaviors:
				• Calculates when Agility set or changes
				• Displays: "Dodge: 15 (10 + Agility 5)"
				• Stores Dodge base value
		
		Parry
			- Deflect/block attacks with combat skill
			- Formula: 10 + Fighting rank
			- Source: Fighting ability
			- Can purchase additional ranks (+1 pp per rank)
			- Behaviors:
				• Calculates when Fighting set or changes
				• Displays: "Parry: 18 (10 + Fighting 8)"
				• Stores Parry base value
	
	Resistance Defenses (you roll these + d20)
		- You roll d20 + defense vs effect DC
		- Formula: Ability Rank (no +10, because you roll d20 + ability)
		
		Fortitude
			- Resist physical effects (poison, disease, fatigue)
			- Formula: Stamina rank (no +10)
			- Source: Stamina ability
			- Can purchase additional ranks (+1 pp per rank)
			- Behaviors:
				• Calculates when Stamina set or changes
				• Displays: "Fortitude: 3 (Stamina 3)"
				• Stores Fortitude base value
		
		Will
			- Resist mental effects (mind control, fear, illusions)
			- Formula: Awareness rank (no +10)
			- Source: Awareness ability
			- Can purchase additional ranks (+1 pp per rank)
			- Behaviors:
				• Calculates when Awareness set or changes
				• Displays: "Will: 2 (Awareness 2)"
				• Stores Will base value
		
		Toughness (SPECIAL RULE)
			- Resist damage
			- Formula: Stamina rank (no +10)
			- Source: Stamina ability
			- CANNOT purchase ranks (EXCEPTION: only via advantages/powers)
			- Game balance rationale: Toughness too powerful if directly purchasable
			- Behaviors:
				• Calculates when Stamina set or changes
				• Displays: "Toughness: 3 (Stamina 3)"
				• Stores Toughness base value
				• Displays tooltip: "Cannot purchase Toughness ranks (use advantages/powers instead)"
	
	Base Defense Value
		- Defense value derived purely from ability (before purchased ranks)
		- Automatically calculated when ability changes
		- Displayed as "base" in defense display
		- Behaviors:
			• Calculates immediately when linked ability set
			• Updates immediately when linked ability changes
			• For Stamina changes: BOTH Fortitude and Toughness update
			• Highlights changed value briefly (visual feedback)
			• Shows purchase availability (4 yes, Toughness no)

5. PURCHASED DEFENSE RANKS
	Purpose: Increase defense values beyond ability-derived bases (more defensive without increasing abilities)
	
	Purchased Ranks
		- Additional ranks bought with power points
		- Added to ability-derived base
		- Cost: 1 power point per rank
		- Purchasable: Dodge, Parry, Fortitude, Will (4 of 5)
		- Non-Purchasable: Toughness (special rule)
		- Behaviors:
			• Selects defense to improve (not Toughness)
			• Specifies number of ranks to add
			• Calculates cost: 1 pp per rank
			• Adds ranks to base value
			• Deducts cost from budget
			• Prevents Toughness purchase with explanation
			• Refunds points when ranks decreased
			• Updates defense display immediately
	
	Defense Total Value
		- Combined ability base + purchased ranks
		- Formula: Total Defense = Base (from ability) + Purchased Ranks
		- Examples:
			• Dodge Total = (10 + Agility) + purchased
			• Parry Total = (10 + Fighting) + purchased
			• Fortitude Total = Stamina + purchased
			• Will Total = Awareness + purchased
			• Toughness Total = Stamina (no purchased ranks allowed)
		- Behaviors:
			• Calculates total when ranks purchased
			• Displays breakdown: "Dodge: 17 (10 + Agility 5 + 2 purchased)"
			• Updates character sheet
			• Validates against PL caps (warn, don't prevent)

═══════════════════════════════════════════════════════════════════════════
DOMAIN RULES & FORMULAS (extracted from M&M 3E Handbook)
═══════════════════════════════════════════════════════════════════════════

CHARACTER IDENTITY RULES:
	• Uniqueness Formula: COUNT(characters WHERE LOWER(name) = LOWER(input)) = 0
	• Required Fields: Character name required, hero identity and description optional
	• Length Validation: Name/Identity ≤ 100 chars, Description ≤ 2000 chars

POWER LEVEL RULES:
	• Point Budget Formula: Starting Points = PL × 15 (Handbook page 26)
	• PL Range: Typically 1-20 (common: 8, 10, 12, 14)
	• Cap Formulas:
		- Skill Modifier ≤ PL + 10
		- Attack + Effect ≤ PL × 2
		- Dodge + Toughness ≤ PL × 2
		- Parry + Toughness ≤ PL × 2
		- Fortitude + Will ≤ PL × 2
	• Immutability: PL represents character tier, rarely changes post-creation

ABILITY RULES:
	• Cost Formula: Ability Cost = Rank × 2 (Handbook page 26)
	• Total Formula: Total Ability Points = Σ(rank × 2) for all 8 abilities
	• Rank Range: -5 to 20 (default 0 = average)
	• Negative Ranks: Below average abilities refund points
	• Cascading Formulas:
		- Agility → Dodge = 10 + Agility
		- Fighting → Parry = 10 + Fighting
		- Stamina → Fortitude = Stamina AND Toughness = Stamina
		- Awareness → Will = Awareness
	• Cascade Timing: Immediate (synchronous, same update cycle)

DEFENSE RULES:
	• Active Defense Formula: Defense = 10 + Ability Rank (Dodge, Parry only)
	• Resistance Defense Formula: Defense = Ability Rank (Fortitude, Will, Toughness - no +10)
	• Toughness Special Rule: Cannot purchase ranks (only via advantages/powers) - Handbook page 26
	• Stamina Dual Impact: Stamina sets BOTH Fortitude and Toughness (same value)
	• Active vs Resistance Distinction:
		- Active (+10 base): Opponent rolls against static value
		- Resistance (no +10): You roll d20 + defense vs DC

PURCHASED DEFENSE RULES:
	• Defense Rank Cost: 1 power point per rank (Handbook page 26)
	• Total Defense Formula: Total = Base (from ability) + Purchased Ranks
	• Purchasable: Dodge, Parry, Fortitude, Will (4 of 5)
	• Non-Purchasable: Toughness (Handbook page 52: "only improved using advantages and powers")
	• No Maximum: Unlimited ranks (subject to PL caps and budget)

VALIDATION PHILOSOPHY:
	• "Warn, Don't Prevent": Validation warnings don't block operations
	• Overspending Allowed: Budget can go negative with warning
	• PL Caps: Warnings, not blocks (allow exceeding caps with alert)

BUDGET TRACKING:
	• Remaining Budget Formula: Total Points - Spent Points (ALL categories)
	• Real-time Updates: Budget recalculates immediately (<100ms)
	• Color Coding: Normal (remaining > 0), Fully Used (= 0), Overspent (< 0)

═══════════════════════════════════════════════════════════════════════════
USER MENTAL MODEL FLOW
═══════════════════════════════════════════════════════════════════════════

1. IDENTITY: Who is this character? (Name, hero identity, description)
	↓
2. POWER LEVEL: What tier of hero? (Sets budget and caps)
	↓
3. ABILITIES: What are their raw capabilities? (8 core abilities, foundation for everything)
	↓
4. DEFENSES: How well do they defend? (5 defenses, derived from abilities)
	↓
5. ENHANCE DEFENSES: Need better defenses? (Purchase additional ranks for 4 of 5 defenses)

═══════════════════════════════════════════════════════════════════════════
KEY INSIGHTS FROM HANDBOOK
═══════════════════════════════════════════════════════════════════════════

• Single Point Pool: All trait categories draw from same budget (not separate pools)
• Abilities First: Abilities are foundation - everything else builds on them
• Cascading Dependencies: Ability changes automatically update linked defenses
• Stamina is Unique: Only ability that affects TWO defenses (Fortitude + Toughness)
• Active vs Resistance: Active defenses (+10) are target numbers; Resistance defenses (no +10) are rolled with d20
• Toughness Exception: Cannot buy Toughness ranks directly (game balance)
• PL Caps: Paired traits allow flexibility (high attack/low damage OR high damage/low attack)
• Immutability: PL rarely changes (represents character tier, not progression stat)
• Validation Philosophy: Warn users about issues, but allow them to proceed ("warn, don't prevent")

═══════════════════════════════════════════════════════════════════════════
SOURCE MATERIAL
═══════════════════════════════════════════════════════════════════════════

• M&M 3E Handbook, Chapter 2 (Pages 24-27): Power Points and Power Level
• M&M 3E Handbook, Chapter 3 (Pages 107-112): Abilities and Defenses
• M&M 3E Handbook, Page 26: Basic Trait Costs table
• M&M 3E Handbook, Pages 51-54: Character creation examples (The Rook, Princess)
• M&M 3E Handbook, Pages 108-109: Ability descriptions and rank scale
• M&M 3E Handbook, Pages 110-111: Defense calculations and formulas
• Feature Overview Documents: Domain AC sections for each feature

