{
  "behaviorName": "exploration",
  "instructions": [
    "**CRITICAL: Update Existing story-graph.json File - Do NOT Create Separate File**",
    "",
    "**MANDATORY: Use the EXISTING story-graph.json file**",
    "- Location: {project_area}/docs/stories/story-graph.json",
    "- This is the SAME file used by Shape, Discovery, and all other behaviors",
    "- Do NOT create story-graph-explored.json or any other separate file",
    "- Update the existing story-graph.json file by adding acceptance_criteria to stories",
    "- The build_knowledge action outputs to story-graph.json (the main file)",
    "",
    "**CRITICAL: Story Graph Structure - Main Epics Section is Single Source of Truth**",
    "",
    "**Two-Section Architecture:**",
    "",
    "1. **Main 'epics' Section (Single Source of Truth)**",
    "   - Location: story-graph.json → 'epics' array (top-level)",
    "   - Contains ALL story details: name, users, sequential_order, story_type, connector, Steps, acceptance_criteria, optional, priority, etc.",
    "   - This is the PRIMARY location - all story details must be here",
    "   - Used as the source for all views (outline, increments, discovery, exploration)",
    "   - Structure: epics → sub_epics → story_groups → stories (with full details including Steps and acceptance_criteria)",
    "",
    "2. **'increments' Section (Minimal Reference View)**",
    "   - Location: story-graph.json → 'increments' array → increment → epics → sub_epics → stories",
    "   - This is a MINIMAL REFERENCE VIEW - just enough to know which stories belong to which increment",
    "   - Stories in increments should ONLY contain: name, users (optional), sequential_order",
    "   - NO story details (no story_type, no connector, no Steps, no acceptance_criteria, no optional, no priority, etc.)",
    "   - Increments are a COPY of the outline view at the story level - just for mapping stories to increments",
    "   - All story details come from the main epics section",
    "",
    "**When Adding/Updating Acceptance Criteria:**",
    "",
    "1. **Update the EXISTING story-graph.json file**",
    "   - Read the existing story-graph.json file from {project_area}/docs/stories/story-graph.json",
    "   - Add/update Steps and acceptance_criteria in main epics → sub_epics → story_groups → stories",
    "   - Include all fields: name, users, sequential_order, story_type, connector, Steps, acceptance_criteria, optional, priority, etc.",
    "   - Save back to the SAME story-graph.json file (overwrite, don't create new file)",
    "",
    "2. **Do NOT Create Separate Files**",
    "   - Do NOT create story-graph-explored.json",
    "   - Do NOT create any other separate story graph files",
    "   - Use the same story-graph.json file that was created in Shape and updated in Discovery",
    "",
    "3. **Do NOT Update Increments Section**",
    "   - Increments section remains minimal (name, users, sequential_order only)",
    "   - Do NOT add Steps, acceptance_criteria, or other details to increments",
    "   - Reference back to main epics section for all details",
    "",
    "**Example:**",
    "   Main epics section:",
    "   ```json",
    "   {",
    "     \"name\": \"Group Minions Into Mob\",",
    "     \"sequential_order\": 2,",
    "     \"connector\": \"and\",",
    "     \"users\": [\"Game Master\"],",
    "     \"story_type\": \"user\",",
    "     \"optional\": false,",
    "     \"priority\": 1,",
    "     \"Steps\": [\"Step 1\", \"Step 2\"],",
    "     \"acceptance_criteria\": [\"When X, then Y\"]",
    "   }",
    "   ```",
    "",
    "   Increments section (minimal reference - unchanged):",
    "   ```json",
    "   {",
    "     \"name\": \"Group Minions Into Mob\",",
    "     \"sequential_order\": 2,",
    "     \"users\": [\"Game Master\"]",
    "   }",
    "   ```",
    "",
    "**CRITICAL RULES:**",
    "- Stories in increments MUST exist in main epics section",
    "- Increments section is just a VIEW - it does not contain story details",
    "- When reading story details (including Steps and acceptance_criteria), always go to main epics section first",
    "- Increments section is only used to know which stories belong to which increment",
    "- Do NOT duplicate Steps or acceptance_criteria in increments section",
    "",
    "**The main epics section is the single source of truth - all story details (including Steps and acceptance_criteria) live there, and increments just reference which stories belong where.**",
    "",
    "**CRITICAL: Acceptance Criteria Format - Each WHEN/THEN is a Single Acceptance Criteria**",
    "",
    "**Format Rules:**",
    "",
    "1. **Each acceptance criteria is a SINGLE string** containing one WHEN/THEN pair",
    "   - Format: \"WHEN [condition]\\nTHEN [outcome]\" (use \\n for newline between WHEN and THEN)",
    "   - Example: \"WHEN Game Master selects tokens\\nTHEN system highlights selected tokens\"",
    "   - WHEN and THEN must be on separate lines within the string",
    "",
    "2. **AND can be part of the same acceptance criteria**",
    "   - Format: \"WHEN [condition]\\nTHEN [outcome] AND [additional outcome]\"",
    "   - Example: \"WHEN Game Master selects tokens\\nTHEN system highlights selected tokens AND selected tokens are stored in temporary selection state\"",
    "   - THEN and its AND must be together on the same line (after the newline)",
    "",
    "3. **Multiple separate ANDs become separate acceptance criteria**",
    "   - If you have multiple AND statements that are separate outcomes, each becomes its own acceptance criteria",
    "   - Example:",
    "     - \"WHEN temporary mob group is confirmed THEN Mob Manager creates new Mob domain object\"",
    "     - \"WHEN temporary mob group is confirmed THEN Mob object contains collection of Minion objects\"",
    "     - (These are separate outcomes, so separate acceptance criteria)",
    "",
    "4. **Each WHEN starts a new acceptance criteria**",
    "   - Different WHEN conditions = different acceptance criteria",
    "   - Example:",
    "     - \"WHEN Game Master selects tokens THEN system highlights selected tokens\"",
    "     - \"WHEN Game Master selects zero tokens THEN system shows error message\"",
    "",
    "**WRONG Format (current):**",
    "```json",
    "\"acceptance_criteria\": [",
    "  \"WHEN Game Master selects tokens\",",
    "  \"THEN system highlights selected tokens\",",
    "  \"AND selected tokens are stored in temporary selection state\"",
    "]",
    "```",
    "",
    "**CORRECT Format:**",
    "```json",
    "\"acceptance_criteria\": [",
    "  \"WHEN Game Master selects tokens\\nTHEN system highlights selected tokens AND selected tokens are stored in temporary selection state\",",
    "  \"WHEN Game Master selects zero tokens\\nTHEN system shows error message indicating at least one token must be selected\"",
    "]",
    "```",
    "",
    "**Key Points:**",
    "- Each acceptance criteria = one complete WHEN/THEN statement (as a single string)",
    "- WHEN and THEN must be on separate lines (use \\n for newline)",
    "- THEN and its AND belong together on the same line (after the newline)",
    "- Multiple ANDs that are separate outcomes = separate acceptance criteria",
    "- Each WHEN condition = new acceptance criteria"
  ]
}

