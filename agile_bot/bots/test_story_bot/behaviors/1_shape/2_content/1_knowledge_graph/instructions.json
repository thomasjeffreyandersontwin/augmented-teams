{
  "behaviorName": "shape",
  "instructions": [
    "Hey, going to be going away for a little while to create the knowledge graph. Go get a cup of coffee ðŸ˜Š",
    "",
    "**BUILD KNOWLEDGE GRAPH - STORY GRAPH AND DOMAIN MODEL CREATION:**",
    "",
    "Build the initial story graph structure AND domain model from gathered context and planning decisions. Capture domain concepts alongside story structure.",
    "",
    "**Configuration:**",
    "- Reference: build_story_graph_outline.json",
    "- Template: story-graph-outline.json",
    "",
    "**CRITICAL - TEMPLATE STRUCTURE COMPLIANCE:**",
    "1. The build_knowledge action has injected 'knowledge_graph_template' into your instructions",
    "2. This template shows the EXACT JSON structure your output MUST match",
    "3. **DO NOT invent your own schema** - examine the template and replicate its structure",
    "4. The template includes:",
    "   - Root level keys (e.g., 'epics' array only, NOT 'capability', 'increments', 'features')",
    "   - Required fields at each level (e.g., 'sequential_order', 'estimated_stories', 'domain_concepts')",
    "   - Nested structure (epics â†’ sub_epics â†’ story_groups â†’ stories)",
    "   - Field types and formats (e.g., 'connector': null vs 'connector': 'and')",
    "5. Look at the '_explanation' section in the template for structural rules",
    "6. Your output must be structurally identical - only the values (names, responsibilities, etc.) differ",
    "",
    "**CRITICAL: Story Graph Structure - Main Epics Section is Single Source of Truth**",
    "",
    "**Two-Section Architecture (if increments are added later):**",
    "",
    "1. **Main 'epics' Section (Single Source of Truth)**",
    "   - Contains ALL story details: name, users, sequential_order, story_type, connector, story_groups, etc.",
    "   - This is the PRIMARY location - all story details must be here",
    "   - Used as the source for all views (outline, increments, discovery, exploration)",
    "",
    "2. **'increments' Section (Minimal Reference View - if present)**",
    "   - This is a MINIMAL REFERENCE VIEW - just enough to know which stories belong to which increment",
    "   - Stories in increments should ONLY contain: name, users (optional), sequential_order",
    "   - NO story details (no story_type, no connector, no story_groups, no domain_concepts, etc.)",
    "   - Increments are a COPY of the outline view at the story level - just for mapping stories to increments",
    "   - All story details come from the main epics section",
    "",
    "**Domain Model Creation (Integrated with Story Graph):**",
    "1. Domain concepts are integrated directly into the story graph structure",
    "2. Place domain_concepts at epic and sub_epic levels based on relevance",
    "3. Apply domain shaping rules (context: 'when shaping the domain')",
    "4. **DO NOT create separate domain_graph.json or domain model files**",
    "5. All domain modeling is captured within story-graph.json via domain_concepts arrays",
    "",
    "**Domain Concept Placement Logic:**",
    "- **Local placement (preferred)**: Place domain_concepts at the sub_epic level when they are relevant to only that sub_epic",
    "- **Global placement**: Elevate domain_concepts to parent epic/sub_epic level when they are relevant to multiple child sub_epics",
    "- **Favor local**: Start with local placement, but elevate if the concept is used by multiple sub_epics",
    "**Process:**",
    "1. Use clarification data from docs/stories/clarification.json",
    "2. Use planning decisions from docs/stories/planning.json",
    "3. **EXAMINE the knowledge_graph_template structure injected into your instructions**",
    "4. Build story graph matching that exact structure (root keys, field names, nesting)",
    "5. Identify domain concepts from clarification and planning data",
    "6. Map domain concepts to epics/sub_epics based on relevance (see placement logic above)",
    "7. Populate domain_concepts arrays in story-graph.json with proper placement",
    "8. Create story-graph.json in project area",
    "7. Populate domain_concepts arrays in story-graph.json with proper placement",
    "8. Create story-graph.json and domain model outputs in project area (same location)",
    "",
    "**Output:**",
    "- File: {project_area}/story-graph.json (JSON story graph with epics, sub_epics, story_groups, stories, and domain_concepts integrated)",
    "",
    "**Next Step:** Proceed to render step after story graph is created."
  ]
}

