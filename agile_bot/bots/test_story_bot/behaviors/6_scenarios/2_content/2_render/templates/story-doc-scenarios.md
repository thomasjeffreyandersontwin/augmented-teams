# üìù {story_name}

**Navigation:** [üìã Story Map]({story_map_filename}) | [‚öôÔ∏è Feature Overview]({feature_overview_filename})

**Epic:** {epic_name}
**Feature:** {feature_name}

## Story Description

<Actor> <verb> <noun> so that <business_value>

**Example:**
AI Chat processes story shaping request so that users can initiate story mapping workflows

## Acceptance Criteria

### Behavioral Acceptance Criteria

- **When** <action>, **then** <outcome>
- **When** <action>, **then** <outcome>
- **When** <action>, **then** <outcome>

**Example:**
- **When** Project loads configuration, **then** Agent configuration is loaded from agent.json
- **When** Workflow is created, **then** Workflow State is set to first behavior
- **When** next action is called, **then** shape behavior clarification is presented

## Background

**Common setup steps shared across all scenarios:**

```gherkin
Given <entity> is initialized with <parameter>=<value>
And <system_state_condition>
And <another_common_state>
```

**Example:**
```gherkin
Given Agent is initialized with agent_name='story_bot'
And Project is finished initializing
And Cursor chat window is open
```

## Scenarios

### Scenario: {scenario_name}

**Steps:**
```gherkin
Given <scenario_specific_state_condition>
And <scenario_specific_setup>
When <user_action_or_system_event>
Then <expected_outcome>
And <another_expected_outcome>
```

**Example:**
```gherkin
Given test project area is set up at test_data/projects/valid-project
And valid base agent.json exists at test_data/agents/base/agent.json
When Project initializes with project_path='test_data/projects/valid-project'
Then Project loads agent configuration from agent.json
And Project creates Workflow instance
```

### Scenario Outline: {scenario_outline_name} ({type})

**Note:** Scenario Outlines with Examples tables are included ONLY when decision criteria chooses Scenario Outline (formulas/calculations need multiple data points OR domain has named entities OR parameter variations exist).

**Steps:**
```gherkin
Given <step with "<variable>">
And <step with "<variable>">
When <step with "<variable>">
Then <step with "<expected>">
And <step with "<result>">
```

**Examples:**
| variable | variable | expected | result |
|----------|----------|----------|--------|
| value1   | value2   | result1  | result2 |
| value3   | value4   | result3  | result4 |

**Example:**
```gherkin
Given user types request message "<request_message>"
And MCP Server is unavailable due to "<unavailability_reason>"
When request is processed
Then user receives error "<expected_error_message>"
```

**Examples:**
| request_message | unavailability_reason | expected_error_message |
|-----------------|----------------------|------------------------|
| build story map | server_not_running    | "MCP Server is not available. Please check server status." |
| plan project    | connection_timeout    | "Connection to MCP Server timed out. Please retry." |
| shape domain    | server_error          | "MCP Server encountered an error. Please check logs." |

## Generated Artifacts

The specification_scenarios stage generates the following artifacts from acceptance criteria and story context:

### Story Documents with Scenarios
**Generated by:** specification_scenarios stage  
**Location:** `docs/stories/map/{epic_name}/{feature_name}/{story_name}.md`  
**Folder Structure:** Uses emoji monikers: üéØ for Epic folders, ‚öôÔ∏è for Feature folders  
**Example:** `docs/stories/map/üéØ Manage Mobs/‚öôÔ∏è Create Mob/üìù Select Minion Tokens.md`  
**Content:**
- Story description and acceptance criteria (from exploration stage)
- Background section with common setup steps (shared across 3+ scenarios)
- Scenarios covering happy path, edge cases, and error cases
- Plain English Given/When/Then steps (no variables or test data)
- **Scenario Outlines with Examples tables (when decision criteria = 'Yes')**
  - Variables in angle brackets: <variable_name>
  - Examples tables with concrete test data
  - All variables in steps have matching columns in Examples table
  - Examples include both input and output/expected result variables

**Example structure:**
```markdown
## Background
Given Agent is initialized with agent_name='story_bot'
And Project is finished initializing

## Scenarios
### Scenario: Successful project initialization
Given test project area is set up at test_data/projects/valid-project
When Project initializes with project_path='test_data/projects/valid-project'
Then Project loads agent configuration from agent.json

### Scenario Outline: Process request with error handling
Given user types request message "<request_message>"
And MCP Server is unavailable due to "<unavailability_reason>"
When request is processed
Then user receives error "<expected_error_message>"

Examples:
| request_message | unavailability_reason | expected_error_message |
| build story map | server_not_running    | "MCP Server is not available..." |
```

### Structured Data (structured.json)
**Generated by:** specification_scenarios stage  
**Location:** `docs/stories/{epic_name}/{feature_name}/structured.json`  
**Content:**
- JSON representation of epic/feature/story hierarchy
- Scenario definitions with Background and Steps
- Scenario Outline definitions with Examples tables (when decision criteria = 'Yes')
- Scenario types (happy_path, edge_case, error_case)
- Structured data for programmatic processing

**Example structure:**
```json
{
  "stories": [
    {
      "name": "{story_name}",
      "scenarios": [
        {
          "name": "{scenario_name}",
          "type": "happy_path",
          "background": ["Given Agent is initialized..."],
          "steps": ["Given test project area...", "When Project initializes...", "Then Project loads..."]
        }
      ],
      "scenario_outlines": [
        {
          "name": "{scenario_outline_name}",
          "type": "error_case",
          "background": ["Given Agent is initialized..."],
          "steps": ["Given user types request message \"<request_message>\"..."],
          "examples": {
            "columns": ["request_message", "unavailability_reason", "expected_error_message"],
            "rows": [
              ["build story map", "server_not_running", "MCP Server is not available..."]
            ]
          }
        }
      ]
    }
  ]
}
```

## Notes

---

## Source Material

{source_material}
          "background": ["Given Agent is initialized..."],
          "steps": ["Given user types request message \"<request_message>\"..."],
          "examples": {
            "columns": ["request_message", "unavailability_reason", "expected_error_message"],
            "rows": [
              ["build story map", "server_not_running", "MCP Server is not available..."]
            ]
          }
        }
      ]
    }
  ]
}
```

## Notes

---

## Source Material

{source_material}
          "background": ["Given Agent is initialized..."],
          "steps": ["Given user types request message \"<request_message>\"..."],
          "examples": {
            "columns": ["request_message", "unavailability_reason", "expected_error_message"],
            "rows": [
              ["build story map", "server_not_running", "MCP Server is not available..."]
            ]
          }
        }
      ]
    }
  ]
}
```

## Notes

---

## Source Material

{source_material}