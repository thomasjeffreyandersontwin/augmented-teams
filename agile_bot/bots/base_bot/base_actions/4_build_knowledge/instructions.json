{
  "actionName": "build_knowledge",
  "instructions": [
    "**MANDATORY: Before generating any content, you MUST load and review the project's context files:**",
    "1. Load `{project_area}/docs/stories/clarification.json` - Contains key questions and evidence (generated file)",
    "2. Load `{project_area}/docs/stories/planning.json` - Contains assumptions and decisions (generated file)",
    "3. Load `{project_area}/docs/context/input.txt` (or similar) - Original input/source material (original context)",
    "4. Load any other original context files from `{project_area}/docs/context/` folder",
    "",
    "**CRITICAL: File locations:**",
    "- **Generated files:** `{project_area}/docs/stories/clarification.json`, `{project_area}/docs/stories/planning.json`",
    "- **Original input:** `{project_area}/docs/context/input.txt` and other original context files",
    "",
    "These files contain critical requirements, decisions, and context that MUST be incorporated into all generated content.",
    "",
    "**CRITICAL: Load planning.json and check for the current behavior's section (e.g., 'shape', 'discovery', 'exploration', 'specification'). Reference decisions_made and assumptions_made for the current behavior, as well as any previous behaviors that affect this work (e.g., discovery decisions affect exploration).**",
    "",
    "**BUILD KNOWLEDGE GRAPH (Structured JSON Content):**",
    "Generate the knowledge graph as structured JSON content following the rules and schema provided. This is NOT about rendering markdown or documents - this action builds the structured data that will be rendered in the next step.",
    "",
    "**CRITICAL: PROACTIVE RULE VALIDATION:**",
    "Before generating any content, review ALL validation rules below. Your generated content MUST comply with every rule to avoid violations.",
    "",
    "**Agent-level rules:**",
    "{{agent_rules}}  --> load from behavior data files",
    "",
    "**Behavior-level rules:**",
    "{{behavior_rules}}  --> load from `{bot}/behaviors/{behavior}/rules/` directory",
    "",
    "**Validation rules (FOLLOW THESE PROACTIVELY):**",
    "{{validation_rules}}  --> loaded from validate_rules action to ensure compliance during generation",
    "",
    "Review each validation rule carefully. Your generated content must pass all validations on the first attempt. Pay special attention to:",
    "- Naming conventions (active verb-noun format, no actors in names)",
    "- Story classification (user vs system)",
    "- Conciseness (details go in acceptance criteria, not names)",
    "- Hierarchy sizing (epic/sub-epic counts within specified ranges)",
    "- Proper use of connectors (and/or)",
    "",
    "**Schema:** Use schema '{{schema}}'  --> load from behavior data files",
    "",
    "**Description:** {{description}}  --> load from behavior data files",
    "",
    "**Instructions:** {{instructions}}  --> load from behavior data files",
    "",
    "Generate the knowledge graph (structured JSON content) according to the schema and rules from the data files, ensuring all requirements from clarification.json and planning.json (especially the current behavior's decisions_made and assumptions_made) are incorporated. Your output must be compliant with ALL validation rules above.",
    "",
    "**OUTPUT:** The result of this action should be a structured JSON knowledge graph that will be saved to the project area. This structured content will then be transformed into rendered documents (markdown, diagrams, etc.) in the render_output action.",
    "",
    "**CRITICAL: UPDATING vs CREATING:**",
    "- Check if knowledge graph already exists in project area",
    "- If knowledge graph EXISTS, you are UPDATING it (not creating from scratch)",
    "- When updating, preserve existing content and add/modify only what's needed based on current behavior",
    "- If knowledge graph does NOT exist, create new one following the schema",
    "",
    "**AUTOMATIC PROGRESSION: After completing build_knowledge and storing the structured content, automatically proceed to render_output action without stopping or waiting for user confirmation. These two actions should execute sequentially as a single workflow step.**"
  ],
  "templates": {
    "initial_prompt": {
      "template": "Generate {{content_type}} with the following context:\n\n**Confirmed Assumptions:**\n{{confirmed_assumptions}}\n\n**Decision Criteria Applied:**\n{{applied_criteria}}\n\n**Approach:**\n{{approach_summary}}\n\n{{behavior_specific_instructions}}",
      "description": "Base prompt for generation, gets behavior-specific instructions injected"
    },
    "knowledge_graph_template": {
      "template": "{{knowledge_template}}",
      "description": "Knowledge graph template loaded from {bot}/behaviors/{behavior}/content/knowledge_graph/{knowledge_template}.json",
      "location": "{bot}/behaviors/{behavior}/content/knowledge_graph/{knowledge_template}.json"
    }
  }
}


    "knowledge_graph_template": {
      "template": "{{knowledge_template}}",
      "description": "Knowledge graph template loaded from {bot}/behaviors/{behavior}/content/knowledge_graph/{knowledge_template}.json",
      "location": "{bot}/behaviors/{behavior}/content/knowledge_graph/{knowledge_template}.json"
    }
  }
}


    "knowledge_graph_template": {
      "template": "{{knowledge_template}}",
      "description": "Knowledge graph template loaded from {bot}/behaviors/{behavior}/content/knowledge_graph/{knowledge_template}.json",
      "location": "{bot}/behaviors/{behavior}/content/knowledge_graph/{knowledge_template}.json"
    }
  }
}

