{
  "concepts": [
    {
      "name": "Agile Bot",
      "responsibilities": [
        {
          "name": "Loads Workflow",
          "collaborators": ["Workflow", "Bot Config"]
        },
        {
          "name": "Loads Project",
          "collaborators": ["Project", "Workflow"]
        },
        {
          "name": "Loads Behaviors",
          "collaborators": ["Behaviors", "Bot Config"]
        },
        {
          "name": "Generates MCP Server",
          "collaborators": ["MCP Bot Server Generator"]
        }
      ]
    },
    {
      "name": "Specific Bot",
      "examples": ["story_bot", "bdd_bot", "domain_bot"],
      "responsibilities": [
        {
          "name": "Loads Behavior Configuration",
          "collaborators": ["Bot Config", "Behaviors"]
        },
        {
          "name": "Provides Behavior List For Tool Generation",
          "collaborators": ["Behaviors", "MCP Bot Server Generator"]
        },
        {
          "name": "Provides Context For Tool Invocation",
          "collaborators": ["BaseBehavioralActionTool", "Behavior", "Base Action"]
        }
      ]
    },
    {
      "name": "Bot Behavior",
      "responsibilities": [
        {
          "name": "Defines Action Steps",
          "collaborators": ["Bot Config"]
        },
        {
          "name": "Compiles Instructions",
          "collaborators": ["Base Action", "Instructions File"]
        },
        {
          "name": "Returns Compiled Instructions",
          "collaborators": ["BaseBehavioralActionTool"]
        }
      ]
    },
    {
      "name": "Project",
      "responsibilities": [
        {
          "name": "Manages Project State",
          "collaborators": ["Project Bot State", "File System"]
        },
        {
          "name": "Manages Workflow State",
          "collaborators": ["Workflow", "Project Bot State", "File System"]
        },
        {
          "name": "Provides Project Scaffold",
          "collaborators": ["File System"]
        },
        {
          "name": "Tracks Bot State And Activity",
          "collaborators": ["Project Bot State", "Bot Activity", "File System"]
        }
      ]
    },
    {
      "name": "Project Bot State",
      "responsibilities": [
        {
          "name": "Stores Project Area",
          "collaborators": ["File System"]
        },
        {
          "name": "For A Bot",
          "collaborators": ["Bot Name"]
        },
        {
          "name": "Stores Activities",
          "collaborators": ["Bot Activity", "File System"]
        },
        {
          "name": "Stores Workflow State",
          "collaborators": ["Workflow State", "File System"]
        }
      ]
    },
    {
      "name": "Workflow State",
      "responsibilities": [
        {
          "name": "Stores Current Behavior Name",
          "collaborators": ["Behavior"]
        },
        {
          "name": "Stores Current Action Name",
          "collaborators": ["Action"]
        }
      ]
    },
    {
      "name": "Workflow",
      "responsibilities": [
        {
          "name": "Orders Behavior Action Steps",
          "collaborators": ["Agile Bot", "Bot Behavior"]
        },
        {
          "name": "Determines Next Action From Completed Actions",
          "collaborators": ["Completed Actions", "Action Configuration", "Transitions"]
        },
        {
          "name": "Checks If Action Is Completed",
          "collaborators": ["Completed Actions", "Workflow State"]
        },
        {
          "name": "Saves Completed Action To Workflow State",
          "collaborators": ["Workflow State", "Completed Actions", "File System"]
        },
        {
          "name": "Transitions To Next Action In Behavior",
          "collaborators": ["State Machine", "Action Configuration", "Transitions"]
        },
        {
          "name": "Detects Final Action In Behavior",
          "collaborators": ["Action Configuration", "State Machine"]
        },
        {
          "name": "Transitions To Next Behavior When Final Action Complete",
          "collaborators": ["Bot Config", "Behavior", "Workflow State"]
        },
        {
          "name": "Initializes Next Behavior At First Action",
          "collaborators": ["Behavior", "Action Configuration", "State Machine"]
        },
        {
          "name": "Loads State From workflow_state.json",
          "collaborators": ["Workflow State", "File System"]
        },
        {
          "name": "Persists State To workflow_state.json",
          "collaborators": ["Workflow State", "File System"]
        }
      ]
    },
    {
      "name": "Router",
      "responsibilities": [
        {
          "name": "Checks Workflow State For Current Behavior",
          "collaborators": ["Workflow State"]
        },
        {
          "name": "Loads workflow_state.json From Project Area",
          "collaborators": ["Workflow State", "File System"]
        },
        {
          "name": "Extracts current_behavior And current_action From State",
          "collaborators": ["Workflow State"]
        },
        {
          "name": "Routes To Current Behavior's MCP Tool",
          "collaborators": ["MCP Bot Server", "Behavior Tool"]
        },
        {
          "name": "Forwards To Bot.Behavior[current_behavior].Action[current_action]",
          "collaborators": ["Bot Behavior", "Base Action"]
        },
        {
          "name": "Defaults To First Behavior/Action If No State Exists",
          "collaborators": ["Bot Behavior", "Base Action"]
        }
      ]
    },
    {
      "name": "Activity Log",
      "responsibilities": [
        {
          "name": "Records Action Execution With Timestamp",
          "collaborators": ["Base Action", "File System"]
        },
        {
          "name": "Stores Behavior And Action Names",
          "collaborators": ["Bot Behavior", "Base Action"]
        },
        {
          "name": "Stores Violations Count For Validation",
          "collaborators": ["ValidateRulesAction"]
        },
        {
          "name": "Links Action To Generated Content File Path",
          "collaborators": ["Base Action", "File System"]
        },
        {
          "name": "Provides Audit Trail",
          "collaborators": ["Project"]
        },
        {
          "name": "Persists To activity_log.json",
          "collaborators": ["File System", "Project"]
        }
      ]
    },
    {
      "name": "MCP Bot Server Generator",
      "responsibilities": [
        {
          "name": "Generates MCP Bot Server",
          "collaborators": ["Bot Config", "MCP Bot Server"]
        },
        {
          "name": "Discovers Actions From base_actions Folder",
          "collaborators": ["File System", "Action Configuration"]
        },
        {
          "name": "Reads action_config.json From Each Action Folder",
          "collaborators": ["Action Configuration", "File System"]
        },
        {
          "name": "Identifies Workflow Actions (workflow: true)",
          "collaborators": ["Action Configuration"]
        },
        {
          "name": "Identifies Independent Actions (workflow: false)",
          "collaborators": ["Action Configuration"]
        },
        {
          "name": "Generates Bot Tools",
          "collaborators": ["Bot Config", "MCP Bot Server", "Bot Tool", "Trigger Words"]
        },
        {
          "name": "Generates Behavior Tools With Workflow Awareness",
          "collaborators": ["Bot Config", "MCP Bot Server", "Behavior Tool", "Bot Behavior", "Action Configuration"]
        },
        {
          "name": "Generates Behavior Action Tools",
          "collaborators": ["Bot Config", "MCP Bot Server", "BaseBehavioralActionTool", "Behavior", "Action", "Behavior Action Trigger Words"]
        },
        {
          "name": "Deploys Generated MCP Server",
          "collaborators": ["Generated MCP Server", "MCP Protocol Handler"]
        }
      ]
    },
    {
      "name": "MCP Bot Server",
      "note": "Unique per bot with unique server name",
      "responsibilities": [
        {
          "name": "Has Unique Server Name",
          "collaborators": ["Bot Name"]
        },
        {
          "name": "Created By Bot",
          "collaborators": ["Agile Bot"]
        },
        {
          "name": "Initializes In Separate Thread",
          "collaborators": ["Thread Manager"]
        },
        {
          "name": "Registers With Protocol Handler",
          "collaborators": ["MCP Protocol Handler"]
        },
        {
          "name": "Instantiates Bot For Project",
          "collaborators": ["Bot Config", "Specific Bot", "Project"]
        },
        {
          "name": "Preloads Bot Class At Startup",
          "collaborators": ["Specific Bot", "Bot Config"]
        },
        {
          "name": "Publishes Tool Catalog",
          "collaborators": ["AI Chat", "Tool Catalog"]
        },
        {
          "name": "Provides Bot Behavior Actions MCP Tools",
          "collaborators": ["BaseBehavioralActionTool"]
        },
        {
          "name": "Routes Tool Calls",
          "collaborators": ["AI Chat", "BaseBehavioralActionTool"]
        },
        {
          "name": "Routes To Specific MCP Tool Based On Trigger Words",
          "collaborators": ["AI Chat", "BaseBehavioralActionTool", "Trigger Words"]
        }
      ]
    },
    {
      "name": "Bot Tool",
      "examples": ["story_bot", "story_bot_close_current_action"],
      "responsibilities": [
        {
          "name": "Runs Active Action On Active Behavior",
          "collaborators": ["Agile Bot", "Project", "Project Bot State", "Workflow State", "Bot Behavior", "Bot Action"]
        },
        {
          "name": "Closes Current Action Explicitly",
          "collaborators": ["Workflow", "Workflow State", "Completed Actions"]
        },
        {
          "name": "Checks If Action Is In Completed Actions Before Closing",
          "collaborators": ["Workflow", "Completed Actions", "Workflow State"]
        },
        {
          "name": "Returns Error If Action Requires Confirmation",
          "collaborators": ["Completed Actions", "AI Chat"]
        },
        {
          "name": "Transitions To Next Action When Action Complete",
          "collaborators": ["Workflow", "Action Configuration", "Workflow State"]
        },
        {
          "name": "Transitions To Next Behavior When Final Action Complete",
          "collaborators": ["Workflow", "Bot Config", "Behavior", "Workflow State"]
        },
        {
          "name": "Initializes Next Behavior At First Action",
          "collaborators": ["Workflow", "Behavior", "Action Configuration"]
        },
        {
          "name": "Handles Idempotent Completion",
          "collaborators": ["Completed Actions", "Workflow State"]
        }
      ]
    },
    {
      "name": "Behavior Tool",
      "examples": ["story_bot_shape"],
      "responsibilities": [
        {
          "name": "Determines Active Or Next Behavior Action",
          "collaborators": ["Workflow State", "Workflow", "Bot Config"]
        },
        {
          "name": "Runs Active Action On Behavior",
          "collaborators": ["Agile Bot", "Project", "Project Bot State", "Workflow State", "Bot Behavior", "Bot Action"]
        },
        {
          "name": "Moves To Next Action If Done",
          "collaborators": ["Workflow", "Project Bot State", "Workflow State"]
        },
        {
          "name": "Moves To Next Behavior If Done",
          "collaborators": ["Workflow", "Project Bot State", "Workflow State"]
        }
      ]
    },
    {
      "name": "BaseTool",
      "responsibilities": [
        {
          "name": "Provides Invocation Logic",
          "collaborators": ["Bot", "Behavior", "Action"]
        },
        {
          "name": "Routes To Preloaded Bot",
          "collaborators": ["Specific Bot"]
        },
        {
          "name": "Loads Instructions",
          "collaborators": ["Instructions File", "File System"]
        },
        {
          "name": "Injects Instructions",
          "collaborators": ["AI Chat"]
        }
      ]
    },
    {
      "name": "BaseBehavioralActionTool",
      "examples": ["story_bot_shape_gather_context"],
      "responsibilities": [
        {
          "name": "Inherits From BaseTool",
          "collaborators": ["BaseTool"]
        },
        {
          "name": "Forwards Invocation To Bot Behavior Action",
          "collaborators": ["Specific Bot", "Behavior", "Base Action"]
        },
        {
          "name": "Annotated With Trigger Words",
          "collaborators": ["Trigger Words Config"]
        },
        {
          "name": "Runs Specific Behavior Action",
          "collaborators": ["Agile Bot", "Bot Behavior", "Bot Action"]
        }
      ]
    },
    {
      "name": "Project State Tool",
      "responsibilities": [
        {
          "name": "Reads Project State",
          "collaborators": ["Project Bot State", "Workflow State", "File System"]
        },
        {
          "name": "Returns Current State",
          "collaborators": ["AI Chat", "MCP Bot Server"]
        }
      ]
    },
    {
      "name": "Action Configuration",
      "responsibilities": [
        {
          "name": "Specifies Action Name",
          "collaborators": []
        },
        {
          "name": "Specifies Workflow Flag (true/false)",
          "collaborators": []
        },
        {
          "name": "Specifies Order In Workflow Sequence",
          "collaborators": ["Workflow"]
        },
        {
          "name": "Specifies Next Action In Sequence",
          "collaborators": ["Workflow", "Base Action"]
        },
        {
          "name": "Stored In action_config.json Per Action Folder",
          "collaborators": ["File System"]
        }
      ]
    },
    {
      "name": "Base Action",
      "responsibilities": [
        {
          "name": "Loads Base Action Instructions",
          "collaborators": ["Instructions File", "File System"]
        },
        {
          "name": "Merges Base And Behavior Instructions",
          "collaborators": ["Behavior Instructions", "Base Instructions"]
        },
        {
          "name": "Returns Compiled Instructions",
          "collaborators": ["Bot Behavior"]
        },
        {
          "name": "Loads Action Configuration",
          "collaborators": ["Action Configuration", "File System"]
        },
        {
          "name": "Injects Next Action Instructions (if workflow: true and next_action exists)",
          "collaborators": ["Action Configuration", "AI Chat"]
        }
      ]
    },
    {
      "name": "GatherContextAction",
      "responsibilities": [
        {
          "name": "Loads Guardrails",
          "collaborators": ["Guardrails", "Key Questions", "Evidence"]
        },
        {
          "name": "Injects Guardrails Into Clarify Requirements",
          "collaborators": ["Compiled Instructions"]
        }
      ]
    },
    {
      "name": "PlanningAction",
      "responsibilities": [
        {
          "name": "Loads Planning Guardrails",
          "collaborators": ["Guardrails", "Typical Assumptions", "Decision Criteria"]
        },
        {
          "name": "Injects Planning Guardrails",
          "collaborators": ["Compiled Instructions"]
        }
      ]
    },
    {
      "name": "BuildKnowledgeAction",
      "responsibilities": [
        {
          "name": "Loads Knowledge Graph Template",
          "collaborators": ["Knowledge Graph Template", "File System"]
        },
        {
          "name": "Injects Template And Build Instructions",
          "collaborators": ["Compiled Instructions"]
        },
        {
          "name": "Injects Validation Rules Reference",
          "collaborators": ["Validation Rules"]
        }
      ]
    },
    {
      "name": "RenderOutputAction",
      "responsibilities": [
        {
          "name": "Loads Render Templates",
          "collaborators": ["Render Templates", "File System"]
        },
        {
          "name": "Loads Transformer Methods",
          "collaborators": ["Transformers", "File System"]
        },
        {
          "name": "Injects Template And Transformer Paths",
          "collaborators": ["Compiled Instructions"]
        }
      ]
    },
    {
      "name": "ValidateRulesAction",
      "responsibilities": [
        {
          "name": "Loads Common Bot Rules",
          "collaborators": ["Common Rules", "File System"]
        },
        {
          "name": "Loads Behavior Specific Rules",
          "collaborators": ["Behavior Rules", "File System"]
        },
        {
          "name": "Merges And Injects Rules",
          "collaborators": ["Compiled Instructions"]
        }
      ]
    },
    {
      "name": "CorrectBotAction",
      "responsibilities": [
        {
          "name": "Loads Correct Bot Instructions",
          "collaborators": ["Base Instructions", "File System"]
        },
        {
          "name": "Injects Correction Instructions",
          "collaborators": ["Compiled Instructions"]
        }
      ]
    },
    {
      "name": "Guardrails",
      "responsibilities": [
        {
          "name": "Provides Required Context",
          "collaborators": ["Key Questions", "Evidence"]
        },
        {
          "name": "Provides Planning Guidance",
          "collaborators": ["Decision Criteria", "Assumptions"]
        }
      ]
    },
    {
      "name": "AI Chat",
      "responsibilities": [
        {
          "name": "Detects Trigger Words And Routes To Tools",
          "collaborators": ["Human", "Bot Server", "MCP Bot Tools", "BaseBehavioralActionTool"]
        },
        {
          "name": "Presents Information To Human",
          "collaborators": ["Human", "All tools"]
        }
      ]
    }
  ]
}

