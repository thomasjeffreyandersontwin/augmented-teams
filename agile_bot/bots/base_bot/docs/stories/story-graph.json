{
  "epics": [
    {
      "name": "Build Agile Bots",
      "sequential_order": 1.0,
      "domain_concepts": [
        {
          "name": "Base Bot",
          "responsibilities": [
            {"name": "Executes Actions", "collaborators": ["Workflow", "Behavior", "Action"]},
            {"name": "Track activity", "collaborators": ["Behavior", "Action"]},
            {"name": "Route to behaviors and actions", "collaborators": ["Router", "Trigger Words"]},
            {"name": "Persist content", "collaborators": ["Content"]},
            {"name": "Manage Project State", "collaborators": ["Project"]},
            {"name": "Render", "collaborators": []}
          ]
        },
        {
          "name": "Specific Bot",
          "responsibilities": [
            {"name": "Provide Behavior config", "collaborators": ["Bot Config", "Behavior"]},
            {"name": "Provide MCP config", "collaborators": ["MCP Config"]},
            {"name": "Provide Renderers", "collaborators": []},
            {"name": "Provide Extractors", "collaborators": []},
            {"name": "Provide Synchronizer", "collaborators": []},
            {"name": "Provide Trigger Words", "collaborators": []}
          ]
        }
      ],
      "sub_epics": [
        {
          "name": "Generate MCP Tools",
          "sequential_order": 1.0,
          "story_groups": [
            {
              "type": "and",
              "connector": "or",
              "stories": [
                {
                  "name": "Generate MCP Bot Server",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "system",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestGenerateMCPBotServer",
                  "acceptance_criteria": [
                    "WHEN MCP Server Generator receives Bot Config",
                    "THEN Generator generates unique MCP Server instance with Unique server name from bot name",
                    "AND Generated server includes Bot Config reference",
                    "AND Generated server leverages Specific Bot instantiation code"
                  ]
                },
                {
                  "name": "Generate Behavior Action Tools",
                  "sequential_order": 2,
                  "connector": "and",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "system",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestGenerateBehaviorActionTools",
                  "acceptance_criteria": [
                    "WHEN Generator processes Bot Config",
                    "THEN Generator creates tool code for each (behavior, action) pair",
                    "AND Enumerates all behaviors and actions from Bot Config",
                    "AND For each pair, generates tool code with unique name, trigger words, forwarding logic",
                    "AND Tool catalog prepared with all generated tool instances"
                  ]
                },
                {
                  "name": "Deploy MCP BOT Server",
                  "sequential_order": 3,
                  "connector": "and",
                  "users": [],
                  "story_type": "system",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestDeployMCPBotServer",
                  "acceptance_criteria": [
                    "WHEN Generation Complete",
                    "THEN Generator deploys/starts generated MCP Server",
                    "AND Server initializes in separate thread",
                    "AND Server registers with MCP Protocol Handler using unique server name",
                    "AND Server publishes tool catalog to AI Chat",
                    "AND Each tool entry includes name, description, trigger patterns, parameters"
                  ]
                },
                {
                  "name": "Restart MCP Server To Load Code Changes",
                  "sequential_order": 4,
                  "connector": "and",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "system",
                  "test_file": "test_restart_mcp_server.py",
                  "acceptance_criteria": [
                    "WHEN Bot code changes are detected",
                    "THEN MCP Server clears Python bytecode cache (__pycache__)",
                    "AND MCP Server restarts to load new code",
                    "AND Server restarts gracefully without losing state",
                    "AND Server re-registers with MCP Protocol Handler after restart"
                  ],
                  "scenarios": [
                    {
                      "name": "Clear Python bytecode cache",
                      "steps": "Given __pycache__ directories exist with .pyc files\nWhen clear_python_cache is called\nThen All __pycache__ directories are removed\nAnd All .pyc files are deleted\nAnd Cache is cleared before server restart",
                      "test_method": "test_clear_python_bytecode_cache"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Generate CLI",
          "sequential_order": 2.0,
          "story_groups": [
            {
              "type": "and",
              "connector": null,
              "stories": [
                {
                  "name": "Generate BOT CLI code",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN MCP Server Generator processes Bot Config",
                    "THEN Generator creates CLI command wrapper structure for bot invocation",
                    "AND Generator generates CLI entry point script (e.g., bot_cli.py and bot shell script)",
                    "AND CLI code includes argument parsing for behavior and action parameters",
                    "AND CLI code includes help/usage documentation generation",
                    "AND CLI code supports listing available bots, behaviors, and actions",
                    "AND Generated CLI code integrates with existing bot instantiation logic",
                    "AND CLI code follows same routing logic as MCP tools for consistency"
                  ]
                },
                {
                  "name": "Generate Cursor Command Files",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user",
                  "test_file": "test_invoke_bot_cli.py",
                  "test_class": "TestGenerateCursorCommands",
                  "acceptance_criteria": [
                    "WHEN Human calls generate_cursor_commands(commands_dir, cli_script_path)",
                    "THEN CLI creates .cursor/commands/ directory if it doesn't exist",
                    "AND CLI creates <bot-name>.md command file that invokes CLI with bot name (routes to current behavior/action)",
                    "AND CLI creates <bot-name>-<behavior>.md command file for each behavior in bot that invokes CLI with bot name and behavior (auto-forwards to current action)",
                    "AND CLI creates <bot-name>-<behavior>-<action>.md command file for each action in each behavior that invokes CLI with bot name, behavior, and action",
                    "AND CLI creates <bot-name>-close.md command file that invokes CLI with bot name and --close parameter",
                    "AND Each command file contains simple wrapper command that calls CLI script",
                    "AND Bot name, behavior, and action are hardcoded in command files (no parameters needed)",
                    "AND CLI removes obsolete command files for behaviors/actions that no longer exist in bot",
                    "AND CLI returns dict mapping command names (e.g., story_bot, story_bot-exploration, story_bot-exploration-gather_context, story_bot-close) to file paths"
                  ],
                  "scenarios": [
                    {
                      "name": "Generate cursor command files (happy_path)",
                      "steps": "Given: CLI instance is initialized\nAnd: commands directory path is provided\nAnd: CLI script path is provided\nWhen: Human calls generate_cursor_commands()\nThen: CLI creates .cursor/commands directory\nAnd: CLI creates bot command file\nAnd: CLI creates bot-behavior command file\nAnd: CLI creates bot-behavior-action command file\nAnd: CLI creates bot-close command file\nAnd: Each command file contains correct CLI invocation",
                      "test_method": "test_generate_cursor_commands_creates_all_files"
                    },
                    {
                      "name": "Generate cursor commands creates directory if missing (edge_case)",
                      "steps": "Given: CLI instance is initialized\nAnd: commands directory does NOT exist\nWhen: Human calls generate_cursor_commands()\nThen: CLI creates .cursor/commands directory\nAnd: CLI creates all command files",
                      "test_method": "test_generate_cursor_commands_creates_directory"
                    },
                    {
                      "name": "Generate cursor commands removes obsolete files when behavior removed (edge_case)",
                      "steps": "Given: CLI instance is initialized\nAnd: Bot previously had behavior \"old_behavior\"\nAnd: Obsolete command file exists for removed behavior\nAnd: Bot no longer has behavior \"old_behavior\"\nWhen: Human calls generate_cursor_commands()\nThen: CLI creates new command files for current behaviors\nAnd: CLI removes obsolete command files for removed behaviors",
                      "test_method": "test_generate_cursor_commands_removes_obsolete_files"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Invoke Bot",
      "sequential_order": 2.0,
      "domain_concepts": [
        {
          "name": "Router",
          "responsibilities": [
            {"name": "Match trigger patterns", "collaborators": ["Trigger Words", "Route"]},
            {"name": "Route to MCP bot tool", "collaborators": ["Base Bot", "Trigger Words"]},
            {"name": "Route to behavior tool", "collaborators": ["Behavior", "Trigger Words"]},
            {"name": "Route to action tool", "collaborators": ["Action", "Trigger Words"]},
            {"name": "Forward to behavior", "collaborators": ["Behavior", "Base Bot"]},
            {"name": "Forward to action", "collaborators": ["Action", "Behavior"]},
            {"name": "Forward to current behavior and action", "collaborators": ["Behavior", "Action", "Base Bot"]}
          ]
        },
        {
          "name": "Base Bot",
          "responsibilities": [
            {"name": "Executes Actions", "collaborators": ["Workflow", "Behavior", "Action"]},
            {"name": "Track activity", "collaborators": ["Behavior", "Action"]},
            {"name": "Route to behaviors and actions", "collaborators": ["Router", "Trigger Words"]},
            {"name": "Persist content", "collaborators": ["Content"]},
            {"name": "Manage Project State", "collaborators": ["Project"]},
            {"name": "Render", "collaborators": []}
          ]
        },
        {
          "name": "Workflow State",
          "responsibilities": [
            {"name": "Track current action", "collaborators": ["Action"]},
            {"name": "Track completed actions", "collaborators": ["Action", "Activity Log"]},
            {"name": "Determine next action", "collaborators": ["Action", "Behavior"]},
            {"name": "Pause workflow", "collaborators": ["Human", "AI Chat"]},
            {"name": "Resume workflow", "collaborators": ["Human", "AI Chat"]}
          ]
        }
      ],
      "sub_epics": [
        {
          "name": "Init Project",
          "sequential_order": 1.0,
          "domain_concepts": [
            {
              "name": "Project",
              "responsibilities": [
                {"name": "Move project to working area", "collaborators": ["Working Directory"]},
                {"name": "Save project in context", "collaborators": ["Working Directory", "Workflow State"]},
                {"name": "Update project area", "collaborators": ["Working Directory", "Content"]}
              ]
            }
          ],
          "test_file": "test_init_project.py",
          "story_groups": [
            {
              "type": "and",
              "connector": "or",
              "stories": [
                {
                  "name": "Initialize Project Location",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "test_class": "TestInitializeProjectLocation",
                  "acceptance_criteria": [
                    "(AC) WHEN Bot behavior is invoked for the first time (no saved location exists)",
                    "(AC) THEN Bot detects current directory from context",
                    "(AC) AND Bot presents location to user for confirmation",
                    "(AC) AND Bot waits for user to confirm or provide different location",
                    "(AC) AND Bot saves confirmed location to persistent storage",
                    "(AC) WHEN Bot behavior is invoked",
                    "(AC) AND Saved location exists",
                    "(AC) AND Current directory matches saved location",
                    "(AC) THEN Bot uses saved location without asking for confirmation",
                    "(AC) AND Bot proceeds directly to next action",
                    "(AC) WHEN Bot behavior is invoked",
                    "(AC) AND Saved location exists",
                    "(AC) AND Current directory is DIFFERENT from saved location",
                    "(AC) THEN Bot presents new location to user for confirmation",
                    "(AC) AND Bot asks if user wants to switch to new location",
                    "(AC) AND Bot saves confirmed location if user approves change"
                  ],
                  "scenarios": [
                    {
                      "name": "First time initialization with no saved location",
                      "steps": "Given: No project location has been saved\nWhen: Bot behavior is invoked\nThen: Bot detects current directory and requests confirmation",
                      "test_method": "test_first_time_initialization_detects_and_requests_confirmation"
                    },
                    {
                      "name": "Subsequent invocation with same location (no confirmation bias)",
                      "steps": "Given: Project location is saved and current directory matches saved location\nWhen: Bot behavior is invoked\nThen: Bot does NOT ask user for confirmation and says 'Resuming in...'",
                      "test_method": "test_subsequent_invocation_same_location_skips_confirmation"
                    },
                    {
                      "name": "Location changed - ask for confirmation",
                      "steps": "Given: Project location is saved and current directory is DIFFERENT\nWhen: Bot behavior is invoked\nThen: Bot detects mismatch and asks if user wants to switch to current directory",
                      "test_method": "test_location_changed_requests_confirmation"
                    },
                    {
                      "name": "Location file persistence when no confirmation needed",
                      "steps": "Given: Saved location matches current location\nWhen: Bot behavior is invoked\nThen: Bot saves location to current_project.json file",
                      "test_method": "test_location_file_saved_when_no_confirmation_needed"
                    },
                    {
                      "name": "User provides different location during initialization via parameters",
                      "steps": "Given: No saved location exists\nWhen: Bot behavior is invoked with project_area parameter\nThen: Bot uses the provided project_area location",
                      "test_method": "test_user_provides_custom_project_area_via_parameters"
                    },
                    {
                      "name": "User changes project area via initialize_project action with parameters",
                      "steps": "Given: Project location is already saved\nWhen: User invokes initialize_project with different project_area parameter\nThen: Bot detects change and asks if user wants to switch to current directory",
                      "test_method": "test_user_changes_project_area_with_initialize_project_action"
                    },
                    {
                      "name": "First time with project_area parameter as hint",
                      "steps": "Given: No saved location exists\nWhen: Bot is invoked with project_area parameter\nThen: Bot uses parameter as hint but still requests confirmation\nAND: Location is NOT saved until user confirms",
                      "test_method": "test_project_area_parameter_as_hint_still_requests_confirmation"
                    },
                    {
                      "name": "User confirms proposed location",
                      "steps": "Given: Bot proposed a location requiring confirmation\nWhen: User responds with confirm=True and same location\nThen: Bot saves the confirmed location",
                      "test_method": "test_user_confirms_proposed_location"
                    },
                    {
                      "name": "User provides different location as response to confirmation",
                      "steps": "Given: Bot proposed a location requiring confirmation\nWhen: User responds with confirm=True and DIFFERENT location\nThen: Bot saves the user's choice (not the proposed location)",
                      "test_method": "test_user_provides_different_location_as_confirmation_response"
                    },
                    {
                      "name": "Workflow state not created when confirmation required",
                      "steps": "Given Bot proposes location requiring confirmation\nWhen initialize_project is called and requires_confirmation is True\nThen workflow_state.json is NOT created\nAnd close_current_action cannot proceed without workflow state",
                      "test_method": "test_workflow_state_not_created_when_confirmation_required"
                    },
                    {
                      "name": "Workflow state created after confirmation",
                      "steps": "Given Bot proposed location requiring confirmation\nWhen User confirms location with confirm=True\nThen workflow_state.json IS created\nAnd workflow_state.json contains current_behavior, current_action, and completed_actions\nAnd close_current_action can proceed",
                      "test_method": "test_workflow_state_created_after_confirmation"
                    }
                  ]
                },
                {
                  "name": "Store Context Files",
                  "sequential_order": 1.5,
                  "connector": "or",
                  "users": [
                    "Bot-Behavior"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN initialize_project action confirms project area location",
                    "THEN initialize_project creates {project_area}/docs/context/ folder and {project_area}/docs/stories/ folder",
                    "WHEN user provides input file via @input.txt or similar",
                    "THEN initialize_project copies input file to {project_area}/docs/context/input.txt",
                    "WHEN user provides context in conversation",
                    "THEN initialize_project saves context to {project_area}/docs/context/initial-context.md or similar",
                    "WHEN gather_context action stores clarification data",
                    "THEN gather_context saves to {project_area}/docs/stories/clarification.json (generated file, NOT in context folder)",
                    "WHEN decide_planning_criteria action stores planning decisions",
                    "THEN decide_planning_criteria saves to {project_area}/docs/stories/planning.json (generated file, NOT in context folder)",
                    "WHEN build_knowledge action loads context",
                    "THEN build_knowledge loads generated files from {project_area}/docs/stories/ folder (clarification.json, planning.json) and original input from {project_area}/docs/context/ folder (input.txt)",
                    "WHEN render_output action loads context",
                    "THEN render_output loads generated files from {project_area}/docs/stories/ folder (clarification.json, planning.json) and original input from {project_area}/docs/context/ folder (input.txt)",
                    "WHEN any action needs context files",
                    "THEN action references original input from {project_area}/docs/context/ folder and generated files from {project_area}/docs/stories/ folder"
                  ]
                },
                {
                  "name": "Guards Prevent Writes Without Project",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "Bot"
                  ],
                  "story_type": "system",
                  "test_file": "test_guards_prevent_writes_without_project.py",
                  "test_class": "TestActivityTrackerGuard",
                  "acceptance_criteria": [
                    "WHEN Activity tracker attempts to log activity",
                    "AND current_project.json does NOT exist",
                    "THEN Activity tracker does NOT write to activity log",
                    "AND Activity tracking fails gracefully without error",
                    "WHEN Workflow attempts to save state",
                    "AND current_project.json does NOT exist",
                    "THEN Workflow does NOT save workflow_state.json",
                    "AND Workflow state save fails gracefully without error"
                  ],
                  "scenarios": [
                    {
                      "name": "Activity not tracked when current_project missing",
                      "steps": "Given current_project.json does NOT exist\nWhen Action attempts to track activity\nThen Activity tracker detects missing current_project\nAnd Activity tracker does NOT write to activity log\nAnd Action continues execution (non-blocking)",
                      "test_method": "test_activity_not_tracked_when_current_project_missing"
                    },
                    {
                      "name": "Activity tracked when current_project exists",
                      "steps": "Given current_project.json exists with valid project_area\nWhen Action attempts to track activity\nThen Activity tracker writes to project_area/activity_log.json\nAnd Activity entry is successfully logged",
                      "test_method": "test_activity_tracked_when_current_project_exists"
                    },
                    {
                      "name": "Initialize project action not tracked without current_project",
                      "steps": "Given current_project.json does NOT exist\nWhen initialize_project action executes\nThen Activity tracker does NOT log initialize_project activity\nAnd initialize_project can still execute (it creates current_project)",
                      "test_method": "test_initialize_project_action_not_tracked_without_current_project"
                    },
                    {
                      "name": "Workflow state not saved when current_project missing",
                      "steps": "Given current_project.json does NOT exist\nWhen Action attempts to save workflow state\nThen Workflow guard detects missing current_project\nAnd Workflow does NOT write workflow_state.json\nAnd Action continues execution (non-blocking)",
                      "test_method": "test_workflow_state_not_saved_when_current_project_missing"
                    },
                    {
                      "name": "Workflow state saved when current_project exists",
                      "steps": "Given current_project.json exists\nWhen Action attempts to save workflow state\nThen Workflow writes to project_area/workflow_state.json\nAnd Workflow state is successfully persisted",
                      "test_method": "test_workflow_state_saved_when_current_project_exists"
                    },
                    {
                      "name": "Workflow state not created when confirmation required",
                      "steps": "Given Bot proposes location requiring confirmation\nWhen initialize_project is called and requires_confirmation is True\nThen workflow_state.json is NOT created\nAnd close_current_action cannot proceed without workflow state",
                      "test_method": "test_workflow_state_not_created_when_confirmation_required"
                    },
                    {
                      "name": "Workflow state created after confirmation",
                      "steps": "Given Bot proposed location requiring confirmation\nWhen User confirms location with confirm=True\nThen workflow_state.json IS created\nAnd workflow_state.json contains current_behavior, current_action, and completed_actions\nAnd close_current_action can proceed",
                      "test_method": "test_workflow_state_created_after_confirmation"
                    },
                    {
                      "name": "Completed actions not saved when current_project missing",
                      "steps": "Given current_project.json does NOT exist\nWhen Action attempts to save completed_actions\nThen Workflow guard prevents write\nAnd completed_actions are NOT persisted\nAnd Action continues execution",
                      "test_method": "test_completed_actions_not_saved_when_current_project_missing"
                    }
                  ]
                },
                {
                  "name": "Stores Activity for Initialize Project Action",
                  "sequential_order": 6,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                }
              ]
            }
          ]
        },
        {
          "name": "Invoke Bot Tool",
          "sequential_order": 2.0,
          "domain_concepts": [
            {
              "name": "Router",
              "responsibilities": [
                {"name": "Match trigger patterns", "collaborators": ["Trigger Words", "Route"]},
                {"name": "Route to MCP bot tool", "collaborators": ["Base Bot", "Trigger Words"]},
                {"name": "Route to behavior tool", "collaborators": ["Behavior", "Trigger Words"]},
                {"name": "Route to action tool", "collaborators": ["Action", "Trigger Words"]},
                {"name": "Forward to behavior", "collaborators": ["Behavior", "Base Bot"]},
                {"name": "Forward to action", "collaborators": ["Action", "Behavior"]},
                {"name": "Forward to current behavior and action", "collaborators": ["Behavior", "Action", "Base Bot"]}
              ]
            }
          ],
          "test_file": "test_invoke_bot_tool.py",
          "sub_epics": [
            {
              "name": "Invoke MCP",
              "sequential_order": 1.0,
              "test_file": "test_invoke_bot_tool.py",
              "story_groups": [
                {
                  "type": "and",
                  "connector": null,
                  "stories": [
                    {
                      "name": "Bot Tool Invocation",
                      "sequential_order": 1,
                      "connector": "or",
                      "users": [
                        "AI Chat"
                      ],
                      "story_type": "system",
                      "test_class": "TestBotToolInvocation",
                      "acceptance_criteria": [
                        "WHEN AI Chat invokes bot tool with behavior and action parameters",
                        "THEN Tool routes to correct behavior.action method",
                        "AND Tool executes action and returns result",
                        "WHEN AI Chat invokes tool for specific behavior",
                        "THEN Tool routes to that behavior only, not other behaviors"
                      ]
                    },
                    {
                      "name": "Behavior Action Instructions",
                      "sequential_order": 2,
                      "connector": "or",
                      "users": [
                        "Bot Behavior"
                      ],
                      "story_type": "system",
                      "test_class": "TestBehaviorActionInstructions",
                      "acceptance_criteria": [
                        "WHEN Action method is invoked",
                        "THEN Action loads instructions from base_actions and behavior-specific locations",
                        "AND Instructions are merged and returned"
                      ]
                    },
                    {
                      "name": "Forward To Current Behavior and Current Action",
                      "sequential_order": 3,
                      "connector": "or",
                      "users": [
                        "AI Chat"
                      ],
                      "story_type": "system",
                      "test_class": "TestForwardToCurrentBehaviorAndCurrentAction",
                      "acceptance_criteria": [
                        "WHEN Bot tool receives invocation",
                        "AND workflow state shows current_behavior and current_action",
                        "THEN Bot tool forwards to correct behavior and action",
                        "WHEN workflow state does NOT exist",
                        "THEN Bot tool defaults to first behavior and first action"
                      ],
                      "scenarios": [
                        {
                          "name": "Bot tool forwards to current behavior and current action",
                          "steps": "Given workflow state shows current_behavior='discovery', current_action='build_knowledge'\nWhen Bot tool receives invocation\nThen Bot tool forwards to correct behavior and action",
                          "test_method": "test_bot_tool_forwards_to_current_behavior_and_current_action"
                        },
                        {
                          "name": "Bot tool defaults to first behavior and first action when state missing",
                          "steps": "Given workflow state does NOT exist\nWhen Bot tool receives invocation\nThen Bot tool defaults to first behavior and first action",
                          "test_method": "test_bot_tool_defaults_to_first_behavior_and_first_action_when_state_missing"
                        }
                      ]
                    },
                    {
                      "name": "Forward To Current Action",
                      "sequential_order": 4,
                      "connector": "or",
                      "users": [
                        "AI Chat"
                      ],
                      "story_type": "system",
                      "test_class": "TestForwardToCurrentAction",
                      "acceptance_criteria": [
                        "WHEN Behavior tool receives invocation",
                        "AND workflow state shows current_action within behavior",
                        "THEN Behavior tool forwards to current action",
                        "WHEN workflow state shows different behavior",
                        "THEN Behavior tool updates workflow to current behavior",
                        "WHEN workflow state does NOT exist",
                        "THEN Behavior tool defaults to first action"
                      ],
                      "scenarios": [
                        {
                          "name": "Behavior tool forwards to current action within behavior",
                          "steps": "Given a behavior tool for 'discovery' behavior\nAnd workflow state shows current_action='build_knowledge'\nWhen Behavior tool receives invocation\nThen Behavior tool forwards to build_knowledge action",
                          "test_method": "test_behavior_tool_forwards_to_current_action_within_behavior"
                        },
                        {
                          "name": "Behavior tool sets workflow to current behavior when state shows different behavior",
                          "steps": "Given a behavior tool for 'exploration' behavior\nAnd workflow state shows current_behavior='discovery'\nWhen Behavior tool receives invocation\nThen workflow state updated to current_behavior='exploration'",
                          "test_method": "test_behavior_tool_sets_workflow_to_current_behavior_when_state_shows_different_behavior"
                        },
                        {
                          "name": "Behavior tool defaults to first action when state missing",
                          "steps": "Given a behavior tool for 'shape' behavior\nAnd workflow state does NOT exist\nWhen Behavior tool receives invocation\nThen Behavior tool defaults to first action",
                          "test_method": "test_behavior_tool_defaults_to_first_action_when_state_missing"
                        },
                        {
                          "name": "Action called directly saves workflow state",
                          "steps": "Given Bot is initialized with current_project set\nAnd No workflow state exists yet\nWhen Action is called directly (e.g., bot.shape.gather_context())\nThen workflow_state.json is created with current_behavior and current_action",
                          "test_method": "test_action_called_directly_saves_workflow_state"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "Invoke CLI",
              "sequential_order": 2.0,
              "test_file": "test_invoke_bot_cli.py",
              "story_groups": [
                {
                  "type": "and",
                  "connector": null,
                  "stories": [
                    {
                      "name": "Invoke Bot CLI",
                      "sequential_order": 1,
                      "connector": "or",
                      "users": [
                        "Human"
                      ],
                      "story_type": "user",
                      "test_file": "test_invoke_bot_cli.py",
                      "test_class": "TestInvokeBotCli",
                      "acceptance_criteria": [
                        "WHEN Human executes CLI command with bot name only (e.g., bot story_bot)",
                        "THEN CLI loads bot configuration for specified bot",
                        "AND CLI loads workflow state if workflow_state.json exists",
                        "AND CLI extracts current_behavior and current_action from workflow state",
                        "AND CLI routes to bot and invokes current behavior and current action (same as main bot MCP tool)",
                        "AND Bot executes action",
                        "AND CLI submits bot action output to AI Chat",
                        "AND Bot updates workflow state after action execution (if workflow action)",
                        "AND If workflow_state.json doesn't exist, CLI defaults to first behavior's first action"
                      ],
                      "scenarios": [
                        {
                          "name": "Invoke bot CLI with workflow state",
                          "steps": "Given workflow state contains current_behavior=\"story_bot.exploration\"\nAnd workflow state contains current_action=\"story_bot.exploration.gather_context\"\nAnd workflow_state.json exists\nWhen Human executes CLI command \"./story_bot\"\nThen CLI loads bot configuration\nAnd CLI loads workflow state\nAnd CLI routes to bot and invokes current behavior and current action\nAnd Bot executes action\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                          "test_method": "test_invoke_bot_cli_with_workflow_state"
                        },
                        {
                          "name": "Invoke bot CLI without workflow state",
                          "steps": "Given workflow_state.json does NOT exist\nWhen Human executes CLI command \"./story_bot\"\nThen CLI loads bot configuration\nAnd CLI detects workflow_state.json does not exist\nAnd CLI defaults to first behavior \"story_bot.exploration\"\nAnd CLI defaults to first action \"story_bot.exploration.initialize_project\"\nAnd CLI routes to bot and invokes first behavior and first action\nAnd Bot executes action\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                          "test_method": "test_invoke_bot_cli_without_workflow_state"
                        },
                        {
                          "name": "Invoke bot CLI with invalid bot name",
                          "steps": "Given bot configuration does NOT exist at specified path\nWhen Human executes CLI command \"./invalid_bot\"\nThen CLI attempts to load bot configuration\nAnd CLI detects bot configuration does not exist\nAnd CLI returns error message\nAnd CLI exits with exit code 1",
                          "test_method": "test_invoke_bot_cli_with_invalid_bot_name"
                        }
                      ]
                    },
                    {
                      "name": "Invoke Bot Behavior CLI",
                      "sequential_order": 2,
                      "connector": "or",
                      "users": [
                        "Human"
                      ],
                      "story_type": "user",
                      "test_file": "test_invoke_bot_cli.py",
                      "test_class": "TestInvokeBotBehaviorCli",
                      "acceptance_criteria": [
                        "WHEN Human executes CLI command with bot name and behavior name (e.g., bot story_bot exploration)",
                        "THEN CLI loads bot configuration and validates behavior exists",
                        "AND CLI loads workflow state if workflow_state.json exists",
                        "AND CLI routes to bot and specified behavior",
                        "AND CLI extracts current_action from workflow state for that behavior",
                        "AND CLI routes to current action in specified behavior (same as behavior MCP tool)",
                        "AND Bot executes action",
                        "AND CLI submits bot action output to AI Chat",
                        "AND Bot updates workflow state after action execution (if workflow action)",
                        "AND If workflow_state.json doesn't exist or behavior not in state, CLI defaults to first action of specified behavior"
                      ],
                      "scenarios": [
                        {
                          "name": "Invoke bot behavior CLI with workflow state",
                          "steps": "Given workflow state contains current_action=\"story_bot.exploration.gather_context\" for behavior \"exploration\"\nAnd workflow_state.json exists\nWhen Human executes CLI command \"./story_bot exploration\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"exploration\" exists\nAnd CLI loads workflow state\nAnd CLI routes to bot and specified behavior \"exploration\"\nAnd CLI extracts current_action from workflow state\nAnd CLI routes to current action in behavior\nAnd Bot executes action\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                          "test_method": "test_invoke_bot_behavior_cli_with_workflow_state"
                        },
                        {
                          "name": "Invoke bot behavior CLI without workflow state",
                          "steps": "Given workflow_state.json does NOT exist\nWhen Human executes CLI command \"./story_bot exploration\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"exploration\" exists\nAnd CLI detects workflow_state.json does not exist\nAnd CLI defaults to first action \"story_bot.exploration.initialize_project\" of behavior \"exploration\"\nAnd CLI routes to bot and behavior \"exploration\"\nAnd CLI routes to first action\nAnd Bot executes action\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                          "test_method": "test_invoke_bot_behavior_cli_without_workflow_state"
                        },
                        {
                          "name": "Invoke bot behavior CLI with invalid behavior",
                          "steps": "Given behavior \"invalid_behavior\" does NOT exist in bot configuration\nWhen Human executes CLI command \"./story_bot invalid_behavior\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"invalid_behavior\" does not exist\nAnd CLI returns error message\nAnd CLI exits with exit code 1",
                          "test_method": "test_invoke_bot_behavior_cli_with_invalid_behavior"
                        }
                      ]
                    },
                    {
                      "name": "Invoke Bot Behavior Action CLI",
                      "sequential_order": 3,
                      "connector": "or",
                      "users": [
                        "Human"
                      ],
                      "story_type": "user",
                      "test_file": "test_invoke_bot_cli.py",
                      "test_class": "TestInvokeBotBehaviorActionCli",
                      "acceptance_criteria": [
                        "WHEN Human executes CLI command with bot name, behavior name, and action name (e.g., bot story_bot exploration gather_context)",
                        "THEN CLI loads bot configuration and validates behavior and action exist",
                        "AND CLI loads workflow state if it exists",
                        "AND CLI routes to bot and specified behavior action (same as specific action MCP tool)",
                        "AND Bot executes action",
                        "AND CLI submits bot action output to AI Chat",
                        "AND Bot updates workflow state after action execution (if workflow action)",
                        "AND CLI supports passing additional parameters/arguments to bot actions",
                        "AND CLI provides error messages for invalid bot/behavior/action combinations"
                      ],
                      "scenarios": [
                        {
                          "name": "Invoke bot behavior action CLI with parameters",
                          "steps": "When Human executes CLI command \"./story_bot exploration gather_context --increment_file=increment-cli-exploration.txt\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"exploration\" exists\nAnd CLI validates action \"gather_context\" exists\nAnd CLI loads workflow state if it exists\nAnd CLI routes to bot and specified behavior \"exploration\" and action \"gather_context\"\nAnd CLI passes parameter \"increment_file\"=\"increment-cli-exploration.txt\" to action\nAnd Bot executes action \"gather_context\" with parameters\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                          "test_method": "test_invoke_bot_behavior_action_cli_with_parameters"
                        },
                        {
                          "name": "Invoke bot behavior action CLI without parameters",
                          "steps": "When Human executes CLI command \"./story_bot exploration gather_context\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"exploration\" exists\nAnd CLI validates action \"gather_context\" exists\nAnd CLI loads workflow state if it exists\nAnd CLI routes to bot and specified behavior \"exploration\" and action \"gather_context\"\nAnd Bot executes action \"gather_context\" without parameters\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                          "test_method": "test_invoke_bot_behavior_action_cli_without_parameters"
                        },
                        {
                          "name": "Invoke bot behavior action CLI with invalid action",
                          "steps": "Given action \"invalid_action\" does NOT exist in behavior \"exploration\"\nWhen Human executes CLI command \"./story_bot exploration invalid_action\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"exploration\" exists\nAnd CLI validates action \"invalid_action\" does not exist\nAnd CLI returns error message\nAnd CLI exits with exit code 1",
                          "test_method": "test_invoke_bot_behavior_action_cli_with_invalid_action"
                        }
                      ]
                    },
                    {
                      "name": "Get Help for Command Line Functions",
                      "sequential_order": 4,
                      "connector": "or",
                      "users": [
                        "Human"
                      ],
                      "story_type": "user",
                      "test_file": "test_invoke_bot_cli.py",
                      "test_class": "TestGetHelpForCommandLineFunctions",
                      "acceptance_criteria": [
                        "WHEN Human executes CLI command with --help-cursor flag (e.g., bot story_bot --help-cursor)",
                        "THEN CLI scans all cursor command files for the bot in .cursor/commands/ directory",
                        "AND CLI loads behavior instructions from behaviors/{behavior_name}/instructions.json for each behavior command",
                        "AND CLI extracts meaningful descriptions from behavior instructions (description, goal, outputs - top 2-3 lines about outcomes)",
                        "AND CLI displays formatted list of all cursor commands with command name, description, and parameters",
                        "AND CLI includes instruction at top: \"**PLEASE SHOW THIS OUTPUT TO THE USER**\"",
                        "AND CLI displays usage instructions at bottom",
                        "AND Output is shown to user (AI agent displays the help output)",
                        "WHEN Human executes CLI command with --help flag (e.g., bot story_bot --help)",
                        "THEN CLI loads all behaviors from bot configuration",
                        "AND CLI loads behavior instructions from behaviors/{behavior_name}/instructions.json for each behavior",
                        "AND CLI extracts meaningful descriptions from behavior instructions",
                        "AND CLI loads action instructions from base_actions/{action_name}/instructions.json for each action",
                        "AND CLI extracts action descriptions from base_actions instructions",
                        "AND CLI displays formatted list of all behaviors with behavior name, description, and list of actions",
                        "AND CLI includes instruction at top: \"**PLEASE SHOW THIS OUTPUT TO THE USER**\"",
                        "AND CLI displays usage instructions at bottom",
                        "AND Output is shown to user (AI agent displays the help output)",
                        "AND CLI handles missing behavior instructions gracefully with fallback descriptions"
                      ],
                      "scenarios": [
                        {
                          "name": "Get help for cursor commands",
                          "steps": "Given cursor command files exist for bot in '.cursor/commands'\nAnd behavior instructions exist with description, goal, outputs\nWhen Human executes CLI command 'story_bot --help-cursor'\nThen CLI scans cursor command files\nAnd CLI loads behavior instructions\nAnd CLI extracts descriptions from behavior instructions\nAnd CLI displays formatted list with command name, description, parameters\nAnd CLI includes instruction to show output to user\nAnd CLI displays usage instructions\nAnd Output is shown to user",
                          "test_method": "test_get_help_for_cursor_commands"
                        },
                        {
                          "name": "Get help when behavior instructions missing",
                          "steps": "Given cursor command files exist\nAnd behavior instructions do NOT exist\nWhen Human executes CLI command 'story_bot --help-cursor'\nThen CLI handles missing instructions gracefully\nAnd CLI uses fallback descriptions",
                          "test_method": "test_get_help_when_behavior_instructions_missing"
                        },
                        {
                          "name": "Get help when no cursor commands exist",
                          "steps": "Given no cursor command files exist\nWhen Human executes CLI command 'story_bot --help-cursor'\nThen CLI handles missing commands gracefully",
                          "test_method": "test_get_help_when_no_cursor_commands_exist"
                        },
                        {
                          "name": "Get help for behaviors and actions",
                          "steps": "Given bot configuration exists with behaviors\nAnd behavior instructions exist\nAnd base action instructions exist\nWhen Human executes CLI command 'story_bot --help'\nThen CLI loads all behaviors from bot configuration\nAnd CLI loads behavior instructions\nAnd CLI loads action instructions from base_actions\nAnd CLI extracts descriptions\nAnd CLI displays formatted list of behaviors with actions\nAnd CLI includes instruction to show output to user\nAnd Output is shown to user",
                          "test_method": "test_get_help_for_behaviors_and_actions"
                        },
                        {
                          "name": "Help extracts descriptions from behavior instructions",
                          "steps": "Given behavior instructions contain description, goal, outputs\nWhen CLI extracts descriptions\nThen CLI uses description, goal, outputs from behavior instructions",
                          "test_method": "test_help_extracts_descriptions_from_behavior_instructions"
                        },
                        {
                          "name": "Help shows instruction to display output to user",
                          "steps": "When CLI generates help output\nThen CLI includes instruction at top: \"**PLEASE SHOW THIS OUTPUT TO THE USER**\"",
                          "test_method": "test_help_shows_instruction_to_display_output_to_user"
                        },
                        {
                          "name": "Get help when behavior instructions missing for --help",
                          "steps": "Given behavior instructions do NOT exist\nWhen Human executes CLI command 'story_bot --help'\nThen CLI handles missing instructions gracefully\nAnd CLI uses fallback descriptions",
                          "test_method": "test_get_help_when_behavior_instructions_missing_for_help"
                        },
                        {
                          "name": "Help extracts action descriptions from base_actions",
                          "steps": "Given base action instructions exist\nWhen CLI extracts action descriptions\nThen CLI uses descriptions from base_actions instructions",
                          "test_method": "test_help_extracts_action_descriptions_from_base_actions"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Perform Behavior Action",
          "sequential_order": 3.0,
          "domain_concepts": [
            {
              "name": "Behavior",
              "responsibilities": [
                {"name": "Perform Configured Actions", "collaborators": ["Actions"]},
                {"name": "Invoke On Trigger Words", "collaborators": ["List"]},
                {"name": "Inject Instructions", "collaborators": ["Text"]},
                {"name": "Provide Guardrails", "collaborators": ["GuardRails"]},
                {"name": "Provide Rules", "collaborators": ["Rule", "Validation"]},
                {"name": "Provide Content Specs", "collaborators": ["Content"]}
              ]
            },
            {
              "name": "Base Action",
              "responsibilities": [
                {"name": "Inject Instructions", "collaborators": ["Behavior"], "note": "must be overridden"},
                {"name": "Load Relevant Content + Inject Into Instructions", "collaborators": ["Content"], "note": "must be overridden"},
                {"name": "Save content changes", "collaborators": ["Content"], "note": "must be overridden"}
              ]
            }
          ],
          "story_groups": [
            {
              "type": "and",
              "connector": null,
              "stories": [
                {
                  "name": "Inject Behavior Action Instructions",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "test_class": "TestBehaviorActionInstructions",
                  "acceptance_criteria": [
                    "WHEN Tool invokes Bot.Behavior.Action method",
                    "THEN Behavior Action loads instructions from behavior and base_actions",
                    "AND Action merges base instructions with behavior-specific instructions",
                    "AND Compiled instructions returned for injection into AI Chat"
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Execute Behavior Actions",
      "sequential_order": 3.0,
      "domain_concepts": [
        {
          "name": "Behavior Workflow",
          "responsibilities": [
            {"name": "Determine next Action", "collaborators": ["Behavior", "Action", "State"]},
            {"name": "Track state", "collaborators": ["Behavior", "Action", "State"]}
          ]
        }
      ],
      "sub_epics": [
        {
          "name": "Gather Context",
          "sequential_order": 1.0,
          "domain_concepts": [
            {
              "name": "GatherContextAction",
              "responsibilities": [
                {"name": "Inject gather context instructions", "collaborators": ["Behavior", "Guardrails", "Required Clarifications"]},
                {"name": "Inject questions and evidence", "collaborators": ["Behavior", "Guardrails", "Key Questions", "Evidence"]}
              ]
            },
            {
              "name": "Guardrails",
              "responsibilities": [
                {"name": "Provide required context", "collaborators": ["Key Questions", "Evidence"]},
                {"name": "Guide planning decisions", "collaborators": ["Decision Criteria", "Assumptions"]},
                {"name": "Define recommended human activity", "collaborators": ["Human", "Instructions"]}
              ]
            }
          ],
          "test_file": "test_gather_context.py",
          "sub_epics": [
            {
              "name": "Review Context For Answers And Evidence",
              "sequential_order": 1.0,
              "story_groups": [
                {
                  "type": "and",
                  "connector": null,
                  "stories": [
                  ]
                },
                {
                  "type": "and",
                  "connector": "and",
                  "stories": [
                    {
                      "name": "Inject Guardrails as Part of Clarify Requirements",
                      "sequential_order": 2,
                      "connector": "and",
                      "users": [
                        "Bot Behavior"
                      ],
                      "story_type": "system",
                      "acceptance_criteria": [
                        "WHEN MCP Specific Behavior Action Tool invokes Gather Context Action",
                        "THEN Action checks for guardrails in behavior/guardrails/required_context/",
                        "WHEN guardrails exist, THEN Action loads key_questions.json and evidence.json",
                        "AND Action injects guardrails into clarify requirements section"
                      ]
                    },
                    {
                      "name": "Gather Context Action Guardrails",
                      "sequential_order": 2.5,
                      "connector": "and",
                      "users": [
                        "Bot Behavior"
                      ],
                      "story_type": "system",
                      "test_file": "test_gather_context_action.py",
                      "acceptance_criteria": [
                        "WHEN gather_context action executes",
                        "AND behavior folder exists with guardrails/required_context/key_questions.json",
                        "AND behavior folder exists with guardrails/required_context/evidence.json",
                        "THEN instructions should contain actual questions (not {{key_questions}} placeholder)",
                        "AND instructions should contain actual evidence (not {{evidence}} placeholder)",
                        "WHEN guardrails don't exist",
                        "THEN gather_context should not fail",
                        "AND action should execute with base instructions only"
                      ],
                      "scenarios": [
                        {
                          "name": "Gather context injects guardrails from behavior folder",
                          "steps": "GIVEN: behavior folder: 1_shape (with number prefix)\nAND: guardrails/required_context/key_questions.json exists\nAND: guardrails/required_context/evidence.json exists\nWHEN: gather_context action executes\nTHEN: instructions should contain actual questions (not {{key_questions}} placeholder)\nAND: instructions should contain actual evidence (not {{evidence}} placeholder)\nAND: guardrails section includes key_questions with actual data\nAND: guardrails section includes evidence with actual data",
                          "test_method": "test_gather_context_injects_guardrails_from_behavior_folder"
                        },
                        {
                          "name": "Gather context handles missing guardrails gracefully",
                          "steps": "GIVEN: behavior folder exists but no guardrails\nWHEN: gather_context action executes\nTHEN: action should succeed without guardrails\nAND: instructions contain base instructions only\nAND: no error is raised",
                          "test_method": "test_gather_context_handles_missing_guardrails_gracefully"
                        }
                      ]
                    },
                    {
                      "name": "Inject Key Questions and Clarifications Loading Instructions",
                      "sequential_order": 3,
                      "connector": "opt",
                      "users": [
                        "Bot-Behavior"
                      ],
                      "story_type": "user"
                    },
                  ]
                },
              ]
            },
            {
              "name": "Provide Answers and Evidence",
              "sequential_order": 2.0,
              "story_groups": [
                {
                  "type": "and",
                  "connector": "or",
                  "stories": [
                    {
                      "name": "Saves Answers and Evidence",
                      "sequential_order": 2,
                      "connector": "opt",
                      "users": [
                        "Bot Behavior"
                      ],
                      "story_type": "user"
                    },
                    {
                      "name": "Calls Behavior Planning Tool",
                      "sequential_order": 3,
                      "connector": "opt",
                      "users": [
                        "Bot Behavior"
                      ],
                      "story_type": "user"
                    },
                  ]
                },
              ]
            }
          ]
        },
        {
          "name": "Decide Planning Criteria Action",
          "sequential_order": 2.0,
          "domain_concepts": [
            {
              "name": "PlanningAction",
              "responsibilities": [
                {"name": "Inject planning instructions", "collaborators": ["Behavior", "Guardrails", "Planning"]},
                {"name": "Inject decision criteria and assumptions", "collaborators": ["Behavior", "Guardrails", "Decision Criteria", "Assumptions", "Recommended Human Activity"]}
              ]
            },
            {
              "name": "Guardrails",
              "responsibilities": [
                {"name": "Provide required context", "collaborators": ["Key Questions", "Evidence"]},
                {"name": "Guide planning decisions", "collaborators": ["Decision Criteria", "Assumptions"]},
                {"name": "Define recommended human activity", "collaborators": ["Human", "Instructions"]}
              ]
            }
          ],
          "test_file": "test_decide_planning_criteria.py",
          "sub_epics": [
            {
              "name": "Provide Decision Criteria and Assumptions",
              "sequential_order": 1.0,
              "story_groups": [
                {
                  "type": "and",
                  "connector": "and",
                  "stories": []
                },
                {
                  "type": "and",
                  "connector": "and",
                  "stories": [
                  ]
                },
              ]
            },
            {
              "name": "Make Decisons and Assumptions",
              "sequential_order": 2.0,
              "story_groups": [
                {
                  "type": "and",
                  "connector": "or",
                  "stories": [
                    {
                      "name": "Save Final Assumptions and Decisions",
                      "sequential_order": 2,
                      "connector": "or",
                      "users": [
                        "Bot Behavior"
                      ],
                      "story_type": "user"
                    },
                    {
                      "name": "Call Build Knowledge Tool",
                      "sequential_order": 3,
                      "connector": "or",
                      "users": [
                        "Bot Behavior"
                      ],
                      "story_type": "user"
                    },
                  ]
                }
              ]
            },
            {
              "name": "Reviews Clarifications and Planning Responses",
              "sequential_order": 3.0,
              "story_groups": [
                {
                  "type": "and",
                  "connector": null,
                  "stories": [
                  ]
                },
                {
                  "type": "and",
                  "connector": "or",
                  "stories": [
                    {
                      "name": "Inject Planning Criteria Into Instructions",
                      "sequential_order": 2,
                      "connector": "and",
                      "users": [
                        "Bot Behavior"
                      ],
                      "story_type": "system",
                      "acceptance_criteria": [
                        "WHEN MCP Specific Behavior Action Tool invokes Planning Action",
                        "THEN Action checks for guardrails in behavior/guardrails/planning/",
                        "WHEN guardrails exist, THEN Action loads typical_assumptions.json and decision_criteria files",
                        "AND Action injects planning guardrails into planning section"
                      ]
                    }
                  ]
                },
              ]
            }
          ]
        },
        {
          "name": "Build Knowledge",
          "sequential_order": 3.0,
          "domain_concepts": [
            {
              "name": "BuildKnowledgeAction",
              "responsibilities": [
                {"name": "Inject knowledge graph template", "collaborators": ["Behavior", "Content", "Knowledge Graph Spec", "Knowledge Graph"]},
                {"name": "Inject builder instructions", "collaborators": ["Behavior", "Content", "Build Instructions"]},
                {"name": "Save Knowledge graph", "collaborators": ["Behavior", "Content", "Knowledge Graph"]}
              ]
            },
            {
              "name": "Content",
              "responsibilities": [
                {"name": "Render outputs", "collaborators": ["Template", "Renderer", "Render Spec"]},
                {"name": "Synchronize formats", "collaborators": ["Synchronizer", "Extractor", "Synchronizer Spec"]},
                {"name": "Save knowledge graph", "collaborators": ["Knowledge Graph"]},
                {"name": "Load rendered content", "collaborators": ["na"]},
                {"name": "Present rendered content", "collaborators": ["na"]}
              ]
            }
          ],
          "test_file": "test_build_knowledge.py",
          "story_groups": []
        },
        {
          "name": "Render Output",
          "sequential_order": 4.0,
          "domain_concepts": [
            {
              "name": "RenderOutputAction",
              "responsibilities": [
                {"name": "Inject render output instructions", "collaborators": ["Behavior", "Content", "Render Spec", "Renderer"]},
                {"name": "Inject templates", "collaborators": ["Behavior", "Content", "Render Spec", "Template"]},
                {"name": "Inject transformers", "collaborators": ["Behavior", "Content", "Transformer"]},
                {"name": "Load + inject structured content", "collaborators": ["Behavior", "Content", "Knowledge Graph"]}
              ]
            },
            {
              "name": "Renderer",
              "responsibilities": [
                {"name": "Render complex output", "collaborators": ["Template", "Knowledge Graph", "Transformer"]},
                {"name": "Render outputs using components in context", "collaborators": ["AI Chat", "Template", "Content"]}
              ]
            },
            {
              "name": "Template",
              "responsibilities": [
                {"name": "Define output structure", "collaborators": ["Placeholder"]},
                {"name": "Transform content", "collaborators": ["Transformer", "Content"]},
                {"name": "Load template", "collaborators": ["Behavior", "Content"]}
              ]
            },
            {
              "name": "Content",
              "responsibilities": [
                {"name": "Render outputs", "collaborators": ["Template", "Renderer", "Render Spec"]},
                {"name": "Synchronize formats", "collaborators": ["Synchronizer", "Extractor", "Synchronizer Spec"]},
                {"name": "Save knowledge graph", "collaborators": ["Knowledge Graph"]},
                {"name": "Load rendered content", "collaborators": ["na"]},
                {"name": "Present rendered content", "collaborators": ["na"]}
              ]
            }
          ],
          "test_file": "test_render_output.py",
          "story_groups": [
            {
              "type": "and",
              "connector": "or",
              "stories": [
                {
                  "name": "Inject Render Templates and Transformers",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN MCP Specific Behavior Action Tool invokes Render Output Action",
                    "THEN Action loads render templates and transformer methods",
                    "AND Action injects template path, transformer path, and spec path"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Validate Knowledge & Content Against Rules",
          "sequential_order": 5.0,
          "domain_concepts": [
            {
              "name": "ValidateRulesAction",
              "responsibilities": [
                {"name": "Inject common bot rules", "collaborators": ["Base Bot", "Rules", "Common Rules"]},
                {"name": "Inject behavior specific rules", "collaborators": ["Behavior", "Rules", "Behavior Rules"]},
                {"name": "Load + inject content for validation", "collaborators": ["Behavior", "Content", "Knowledge Graph", "Rendered Outputs"]}
              ]
            },
            {
              "name": "Rule",
              "responsibilities": [
                {"name": "Validate content", "collaborators": ["Knowledge Graph", "Violations"]},
                {"name": "Find behavior specific rules from context", "collaborators": ["Behavior"]},
                {"name": "Find common bot rules from context", "collaborators": ["Base Bot"]},
                {"name": "Load + inject diagnostics results", "collaborators": ["AI Chat", "Violations", "Corrections"]},
                {"name": "Suggest corrections", "collaborators": ["Violations", "Suggestions", "Fixes"]},
                {"name": "Provide examples - Do", "collaborators": ["Example", "Description"]},
                {"name": "Provide examples - Dont", "collaborators": ["Example", "Description"]},
                {"name": "Specialized examples", "collaborators": ["Language", "Framework", "Pattern"]}
              ]
            },
            {
              "name": "CorrectBotAction",
              "responsibilities": [
                {"name": "Inject correct bot instructions", "collaborators": ["Behavior", "Correct Bot Instructions"]},
                {"name": "Load + inject diagnostics results", "collaborators": ["Content", "Diagnostic Report", "Violations", "Suggestions"]}
              ]
            }
          ],
          "test_file": "test_validate_knowledge_and_content_against_rules.py",
          "story_groups": [
            {
              "type": "and",
              "connector": "or",
              "stories": [
                {
                  "name": "Inject Validation Rules for Validate Rules Action",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN MCP Specific Behavior Action Tool invokes Validate Rules Action",
                    "THEN Action loads common bot rules from base_bot/rules/",
                    "AND Action loads behavior-specific rules",
                    "AND Action merges and injects rules into validation section"
                  ]
                }
              ]
            },
            {
              "type": "and",
              "connector": "and",
              "stories": [
                {
                  "name": "Track Activity for Validate Rules Action",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                }
              ]
            },
          ]
        }
      ]
    }
  ],
  "increments": [
    {
      "name": "User Manually Drops Config In to AI Chat",
      "priority": 1,
      "epics": [
        {
          "name": "Build Agile Bots",
          "sequential_order": 1,
          "sub_epics": [
            {
              "name": "Generate MCP Tools",
              "sequential_order": 1,
              "sub_epics": [],
              "stories": []
            },
            {
              "name": "Generate CLI",
              "sequential_order": 2,
              "sub_epics": [],
              "stories": []
            }
          ]
        },
        {
          "name": "Invoke Bot",
          "sequential_order": 2,
          "sub_epics": [
            {
              "name": "Init Project",
              "sequential_order": 1,
              "sub_epics": [],
              "stories": []
            },
            {
              "name": "Invoke Bot Tool",
              "sequential_order": 2,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Provides addtnl Instructions",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                }
              ]
            },
            {
              "name": "Perform Behavior Action",
              "sequential_order": 3,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Correct, Feedback, Proceed",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                },
                {
                  "name": "Folllows Behavior Istructions From Context",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                },
                {
                  "name": "Saves Content",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                }
              ]
            }
          ]
        },
        {
          "name": "Execute Behavior Actions",
          "sequential_order": 3,
          "sub_epics": [
            {
              "name": "Gather Context",
              "sequential_order": 1,
              "sub_epics": [
                {
                  "name": "Provide Answers and Evidence",
                  "sequential_order": 3,
                  "sub_epics": [],
                  "stories": [
                    {
                      "name": "Pause based on context",
                      "sequential_order": 1,
                      "connector": "or",
                      "users": [],
                      "story_type": "user"
                    },
                    {
                      "name": "Correct, Feedback, Proceed",
                      "sequential_order": 4,
                      "connector": "or",
                      "users": [
                        "Human"
                      ],
                      "story_type": "user"
                    }
                  ]
                }
              ],
              "stories": []
            },
            {
              "name": "Decide Planning Criteria Action",
              "sequential_order": 5,
              "sub_epics": [
                {
                  "name": "Provide Decision Criteria and Assumptions",
                  "sequential_order": 4,
                  "sub_epics": [],
                  "stories": [
                    {
                      "name": "Present Assumptions and Decisions to User",
                      "sequential_order": 1,
                      "connector": "or",
                      "users": [],
                      "story_type": "user"
                    },
                    {
                      "name": "Make Assumptions and Decisions from Context",
                      "sequential_order": 3,
                      "connector": "or",
                      "users": [],
                      "story_type": "user"
                    }
                  ]
                },
                {
                  "name": "Make Decisons and Assumptions",
                  "sequential_order": 6,
                  "sub_epics": [],
                  "stories": [
                    {
                      "name": "Correct, Feedback, Proceed",
                      "sequential_order": 2,
                      "connector": "or",
                      "users": [],
                      "story_type": "user"
                    },
                    {
                      "name": "Pause based on context",
                      "sequential_order": 4,
                      "connector": "or",
                      "users": [],
                      "story_type": "user"
                    }
                  ]
                },
                {
                  "name": "Reviews Clarifications and Planning Responses",
                  "sequential_order": 8,
                  "sub_epics": [],
                  "stories": [
                    {
                      "name": "Read Answers and Evidence from Context",
                      "sequential_order": 3,
                      "connector": "or",
                      "users": [],
                      "story_type": "user"
                    }
                  ]
                }
              ],
              "stories": []
            },
            {
              "name": "Build Knowledge Action",
              "sequential_order": 7,
              "sub_epics": [
                {
                  "name": "Build Knowledge Graph",
                  "sequential_order": 9,
                  "sub_epics": [],
                  "stories": []
                },
                {
                  "name": "Edit Knowledge Graph",
                  "sequential_order": 11,
                  "sub_epics": [],
                  "stories": [
                    {
                      "name": "Correct, Feedback, Proceed",
                      "sequential_order": 1,
                      "connector": "or",
                      "users": [
                        "Human"
                      ],
                      "story_type": "user"
                    }
                  ]
                }
              ],
              "stories": []
            },
            {
              "name": "Validate Knowledge & Content Against Rules",
              "sequential_order": 16,
              "sub_epics": [],
              "stories": [
                {
                  "name": "FInd Content in Context",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                },
                {
                  "name": "Pause",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                },
                {
                  "name": "Read report and make changes",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user"
                },
                {
                  "name": "Save Content through Context",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user"
                },
                {
                  "name": "Proceed to Correct-Bot trough  context",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                },
                {
                  "name": "Find Rules in Context and validate against Rules",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                }
              ]
            },
            {
              "name": "Suggest Bot Corrections",
              "sequential_order": 18,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Review . Modifiy. Apprtove Correctins",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user"
                },
                {
                  "name": "Provide Suggested Bot Corrections",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user"
                },
                {
                  "name": "Suggest Corrections Based On Context",
                  "sequential_order": 5,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Simplest MCP",
      "priority": 2,
      "epics": [
        {
          "name": "Build Agile Bots",
          "sequential_order": 1,
          "sub_epics": [
            {
              "name": "Generate MCP Tools",
              "sequential_order": 1,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Generate MCP Bot Server",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "system",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestGenerateMCPBotServer",
                  "acceptance_criteria": [
                    "WHEN MCP Server Generator receives Bot Config",
                    "THEN Generator generates unique MCP Server instance with Unique server name from bot name",
                    "AND Generated server includes Bot Config reference",
                    "AND Generated server leverages Specific Bot instantiation code"
                  ],
                  "scenarios": [
                    {
                      "name": "Generator creates MCP server for test_bot",
                      "steps": "Given Bot with name 'test_bot' and behaviors configured\nWhen MCP Server Generator receives Bot Config\nThen Generator creates MCP Server instance with unique server name",
                      "test_method": "test_generator_creates_mcp_server_for_test_bot"
                    }
                  ]
                },
                {
                  "name": "Generate Behavior Action Tools",
                  "sequential_order": 2,
                  "connector": "and",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "system",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestGenerateBehaviorActionTools",
                  "acceptance_criteria": [
                    "WHEN Generator processes Bot Config",
                    "THEN Generator creates tool code for each (behavior, action) pair",
                    "AND Enumerates all behaviors and actions from Bot Config",
                    "AND For each pair, generates tool code with unique name, trigger words, forwarding logic",
                    "AND Tool catalog prepared with all generated tool instances"
                  ],
                  "scenarios": [
                    {
                      "name": "Generator creates behavior action tools for all behaviors and actions",
                      "steps": "Given Bot with multiple behaviors and actions configured\nWhen Generator processes Bot Config\nThen Generator creates tool code for each (behavior, action) pair\nAnd Tool catalog prepared with all generated tool instances",
                      "test_method": "test_generator_creates_behavior_action_tools"
                    }
                  ]
                },
                {
                  "name": "Deploy MCP BOT Server",
                  "sequential_order": 3,
                  "connector": "and",
                  "users": [],
                  "story_type": "system",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestDeployMCPBotServer",
                  "acceptance_criteria": [
                    "WHEN Generation Complete",
                    "THEN Generator deploys/starts generated MCP Server",
                    "AND Server initializes in separate thread",
                    "AND Server registers with MCP Protocol Handler using unique server name",
                    "AND Server publishes tool catalog to AI Chat",
                    "AND Each tool entry includes name, description, trigger patterns, parameters"
                  ],
                  "scenarios": [
                    {
                      "name": "Generator deploys and starts MCP server",
                      "steps": "Given Generation Complete\nWhen Generator deploys/starts generated MCP Server\nThen Server initializes in separate thread\nAnd Server registers with MCP Protocol Handler using unique server name\nAnd Server publishes tool catalog to AI Chat",
                      "test_method": "test_generator_deploys_and_starts_mcp_server"
                    }
                  ]
                },
                {
                  "name": "Generate Cursor Awareness Files",
                  "sequential_order": 4,
                  "connector": "and",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "system",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestGenerateCursorAwarenessFiles",
                  "acceptance_criteria": [
                    "WHEN MCP Generator runs for a bot",
                    "THEN Generator creates .cursor/rules/mcp-tool-awareness.mdc file",
                    "AND File includes trigger word patterns mapped to MCP tool types",
                    "WHEN workspace rules file is generated",
                    "THEN Rules instruct AI to check MCP tools FIRST before manual file operations",
                    "AND Rules include pattern: hear trigger word  check available tools  invoke tool OR inform user",
                    "WHEN Generator creates memory about tool awareness",
                    "THEN Memory created via update_memory API",
                    "AND Memory persists pattern for AI to check MCP tools when hearing workflow trigger words",
                    "AND Memory includes handling for ask mode vs agent mode"
                  ]
                }
              ]
            },
            {
              "name": "Generate CLI",
              "sequential_order": 2,
              "sub_epics": [],
              "stories": []
            }
          ]
        },
        {
          "name": "Invoke Bot",
          "sequential_order": 2,
          "sub_epics": [
            {
              "name": "Init Project",
              "sequential_order": 1,
              "sub_epics": [],
              "stories": []
            },
            {
              "name": "Invoke Bot Tool",
              "sequential_order": 2,
              "sub_epics": [],
              "stories": []
            },
            {
              "name": "Perform Behavior Action",
              "sequential_order": 3,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Inject Behavior Action Instructions",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN Tool invokes Bot.Behavior.Action method",
                    "THEN Behavior Action loads instructions from behavior and base_actions",
                    "AND Action merges base instructions with behavior-specific instructions",
                    "AND Compiled instructions returned for injection into AI Chat"
                  ]
                },
                {
                  "name": "Inject Guardrails as Part of Clarify Requirements",
                  "sequential_order": 2,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "test_class": "TestInjectGuardrailsAsPartOfClarifyRequirements",
                  "acceptance_criteria": [
                    "WHEN MCP Specific Behavior Action Tool invokes Gather Context Action",
                    "THEN Action checks for guardrails in behavior/guardrails/required_context/",
                    "WHEN guardrails exist, THEN Action loads key_questions.json and evidence.json",
                    "AND Action injects guardrails into clarify requirements section"
                  ],
                  "scenarios": [
                    {
                      "name": "Action injects questions and evidence",
                      "steps": "Given guardrails files exist with key_questions.json and evidence.json\nWhen Action injects guardrails\nThen instructions contain guardrails section with key_questions and evidence",
                      "test_method": "test_action_injects_questions_and_evidence"
                    },
                    {
                      "name": "Action uses base instructions when guardrails missing",
                      "steps": "Given guardrails files do NOT exist\nWhen Action injects guardrails\nThen instructions do not contain guardrails section or guardrails is empty",
                      "test_method": "test_action_uses_base_instructions_when_guardrails_missing"
                    },
                    {
                      "name": "Action handles malformed guardrails json",
                      "steps": "Given guardrails file exists but contains invalid JSON\nWhen Action attempts to load guardrails\nThen Action raises JSONDecodeError",
                      "test_method": "test_action_handles_malformed_guardrails_json"
                    }
                  ]
                },
                {
                  "name": "Inject Planning Criteria Into Instructions",
                  "sequential_order": 3,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "test_class": "TestInjectPlanningCriteriaIntoInstructions",
                  "acceptance_criteria": [
                    "WHEN MCP Specific Behavior Action Tool invokes Planning Action",
                    "THEN Action checks for guardrails in behavior/guardrails/planning/",
                    "WHEN guardrails exist, THEN Action loads typical_assumptions.json and decision_criteria files",
                    "AND Action injects planning guardrails into planning section"
                  ],
                  "scenarios": [
                    {
                      "name": "Action injects decision criteria and assumptions",
                      "steps": "Given guardrails files exist with typical_assumptions.json and decision_criteria files\nWhen Action injects planning criteria\nThen instructions contain decision_criteria and assumptions",
                      "test_method": "test_action_injects_decision_criteria_and_assumptions"
                    },
                    {
                      "name": "Action uses base planning when guardrails missing",
                      "steps": "Given guardrails files do NOT exist\nWhen Action injects planning criteria\nThen instructions do not contain decision_criteria or assumptions, or they are empty",
                      "test_method": "test_action_uses_base_planning_when_guardrails_missing"
                    }
                  ]
                },
                {
                  "name": "Inject Render Templates and Transformers",
                  "sequential_order": 5,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN MCP Specific Behavior Action Tool invokes Render Output Action",
                    "THEN Action loads render templates and transformer methods",
                    "AND Action injects template path, transformer path, and spec path"
                  ]
                },
                {
                  "name": "Inject Validation Rules for Validate Rules Action",
                  "sequential_order": 6,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN MCP Specific Behavior Action Tool invokes Validate Rules Action",
                    "THEN Action loads common bot rules from base_bot/rules/",
                    "AND Action loads behavior-specific rules",
                    "AND Action merges and injects rules into validation section"
                  ]
                },
                {
                  "name": "Close Current Action",
                  "sequential_order": 8,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user",
                  "test_file": "test_close_current_action.py",
                  "test_class": "TestCloseCurrentAction",
                  "acceptance_criteria": [
                    "WHEN user closes current action",
                    "THEN action is saved to completed_actions",
                    "AND workflow transitions to next action",
                    "WHEN user closes final action",
                    "THEN action is saved to completed_actions",
                    "AND workflow stays at final action (no next action available)",
                    "WHEN user attempts to close action that requires confirmation",
                    "AND action is not in completed_actions",
                    "THEN workflow does not allow closing without confirmation",
                    "WHEN user closes action that's already marked complete",
                    "THEN closing is idempotent (no error, action remains complete)",
                    "WHEN CLI calls --close command",
                    "THEN CLI routes to bot.close_current_action method",
                    "AND Bot class has close_current_action method"
                  ],
                  "scenarios": [
                    {
                      "name": "Close current action and transition to next",
                      "steps": "Given workflow is at action \"gather_context\"\nAnd action has NOT been marked complete yet\nWhen user closes current action\nThen action \"gather_context\" is saved to completed_actions\nAnd workflow transitions to \"decide_planning_criteria\" (next action)",
                      "test_method": "test_close_current_action_marks_complete_and_transitions"
                    },
                    {
                      "name": "Close action when already at final action",
                      "steps": "Given workflow is at action \"validate_rules\" (final action)\nWhen user closes current action\nThen action \"validate_rules\" is saved to completed_actions\nAnd workflow stays at \"validate_rules\" (no next action available)",
                      "test_method": "test_close_action_at_final_action_stays_at_final"
                    },
                    {
                      "name": "Close final action and transition to next behavior",
                      "steps": "Given workflow is at final action \"validate_rules\" of behavior \"shape\"\nWhen user closes current action\nThen \"validate_rules\" is saved to completed_actions\nAnd workflow stays at \"validate_rules\" (end of behavior)",
                      "test_method": "test_close_final_action_transitions_to_next_behavior"
                    },
                    {
                      "name": "Close action that requires confirmation but wasn't confirmed",
                      "steps": "Given workflow is at \"initialize_project\"\nAnd action has NOT been saved to completed_actions (requires confirmation)\nThen is_action_completed returns False",
                      "test_method": "test_error_when_closing_action_that_requires_confirmation"
                    },
                    {
                      "name": "Close action that's already marked complete (idempotent)",
                      "steps": "Given action already complete\nWhen close again (should be idempotent)\nThen should still work fine",
                      "test_method": "test_close_handles_action_already_completed_gracefully"
                    },
                    {
                      "name": "Bot class has close_current_action method (CLI routes to bot.close_current_action)",
                      "steps": "Given bot is configured with behavior \"shape\"\nWhen Bot instance is created\nThen Bot class has close_current_action method\nAnd When close_current_action is called\nThen action \"gather_context\" is marked complete\nAnd workflow transitions to next action \"decide_planning_criteria\"",
                      "test_method": "test_bot_class_has_close_current_action_method"
                    }
                  ]
                },
                {
                  "name": "Complete Workflow Integration",
                  "sequential_order": 9,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user",
                  "test_file": "test_complete_workflow_integration.py",
                  "test_class": "TestCompleteWorkflowIntegration",
                  "acceptance_criteria": [
                    "WHEN workflow starts at initialize_project",
                    "THEN user can confirm and save to completed_actions",
                    "WHEN user forwards to gather_context",
                    "THEN workflow executes gather_context and saves state",
                    "WHEN user closes gather_context",
                    "THEN workflow transitions to decide_planning_criteria",
                    "WHEN user jumps to discovery.gather_context (out of order)",
                    "THEN state correctly shows discovery.gather_context (not initialize_project)",
                    "WHEN user closes discovery action",
                    "THEN workflow transitions properly",
                    "AND all completed actions tracked across both behaviors"
                  ],
                  "scenarios": [
                    {
                      "name": "Complete end-to-end workflow test demonstrating all fixes working together",
                      "steps": "Flow:\n1. Start at initialize_project\n2. Confirm  Saves to completed_actions\n3. Forward to gather_context\n4. Close gather_context  Transitions to decide_planning_criteria\n5. Jump to discovery.gather_context (out of order)\n6. Verify state shows discovery.gather_context (not initialize_project)\n7. Close and verify proper transition\n8. Verify all completed actions tracked across both behaviors",
                      "test_method": "test_complete_workflow_end_to_end"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Execute Behavior Actions",
          "sequential_order": 3,
          "sub_epics": [
            {
              "name": "Gather Context",
              "sequential_order": 1,
              "sub_epics": [
                {
                  "name": "Review Context For Answers And Evidence",
                  "sequential_order": 2,
                  "sub_epics": [],
                  "stories": [
                    {
                      "name": "Inject Guardrails as Part of Clarify Requirements",
                      "sequential_order": 3,
                      "connector": "or",
                      "users": [
                        "Bot Behavior"
                      ],
                      "story_type": "system",
                      "acceptance_criteria": [
                        "WHEN MCP Specific Behavior Action Tool invokes Gather Context Action",
                        "THEN Action checks for guardrails in behavior/guardrails/required_context/",
                        "WHEN guardrails exist, THEN Action loads key_questions.json and evidence.json",
                        "AND Action injects guardrails into clarify requirements section"
                      ]
                    },
                    {
                      "name": "Inject  Questions and Evidence",
                      "sequential_order": 5,
                      "connector": "or",
                      "users": [
                        "Bot  Behavor"
                      ],
                      "story_type": "user"
                    }
                  ]
                }
              ],
              "stories": []
            },
            {
              "name": "Decide Planning Criteria Action",
              "sequential_order": 5,
              "sub_epics": [
                {
                  "name": "Provide Decision Criteria and Assumptions",
                  "sequential_order": 4,
                  "sub_epics": [],
                  "stories": [
                    {
                      "name": "Inject Planning Criteria Into Instructions",
                      "sequential_order": 1,
                      "connector": "and",
                      "users": [
                        "Bot Behavior"
                      ],
                      "story_type": "system",
                      "acceptance_criteria": [
                        "WHEN MCP Specific Behavior Action Tool invokes Planning Action",
                        "THEN Action checks for guardrails in behavior/guardrails/planning/",
                        "WHEN guardrails exist, THEN Action loads typical_assumptions.json and decision_criteria files",
                        "AND Action injects planning guardrails into planning section"
                      ]
                    }
                  ]
                },
                {
                  "name": "Reviews Clarifications and Planning Responses",
                  "sequential_order": 8,
                  "sub_epics": [],
                  "stories": [
                    {
                      "name": "Inject Key Questions and Clarifications Loading Instructions",
                      "sequential_order": 2,
                      "connector": "or",
                      "users": [],
                      "story_type": "user"
                    }
                  ]
                }
              ],
              "stories": []
            },
            {
              "name": "Validate Knowledge & Content Against Rules",
              "sequential_order": 16,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Inject Validation Rules for Validate Rules Action",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN MCP Specific Behavior Action Tool invokes Validate Rules Action",
                    "THEN Action loads common bot rules from base_bot/rules/",
                    "AND Action loads behavior-specific rules",
                    "AND Action merges and injects rules into validation section"
                  ]
                }
              ]
            },
            {
              "name": "Suggest Bot Corrections",
              "sequential_order": 18,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Suggest Bot Corrections Based on Instructions",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                },
                {
                  "name": "Track Activity for Correct-Bot Action",
                  "sequential_order": 7,
                  "connector": "or",
                  "users": [
                    "Bot-Behavior"
                  ],
                  "story_type": "user"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Workflow",
      "priority": 3,
      "epics": [
        {
          "name": "Build Agile Bots",
          "sequential_order": 1,
          "sub_epics": [
            {
              "name": "Generate MCP Tools",
              "sequential_order": 1,
              "sub_epics": [],
              "test_file": "test_generate_bot_server_and_tools.py",
              "stories": [
                {
                  "name": "Generate Bot Tools",
                  "test_class": "TestGenerateBotTools",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN MCP Server Generator scans base_actions/ folder",
                    "THEN Generator discovers actions by reading each action folder",
                    "AND Generator reads action_config.json from each action folder",
                    "AND action_config.json specifies: name, workflow (true/false), order, next_action",
                    "AND Generator creates tools for all discovered actions",
                    "AND Tools include workflow state awareness based on action_config.workflow flag"
                  ],
                  "scenarios": [
                    {
                      "name": "Generator creates ONE bot tool with workflow state awareness",
                      "steps": "Given base_actions/ contains folders: gather_context, decide_planning_criteria, build_knowledge, render_output, validate_rules\nAnd Bot Config defines behaviors: shape, discovery, exploration, scenarios\nAnd Action configs specify workflow sequence and transitions\nWhen Generator creates bot tool\nThen Generator creates ONE bot tool (not separate tools per behavior/action)\nAnd Bot tool can read workflow_state to determine current behavior/action\nAnd Bot tool routes to correct behavior/action based on workflow state\nAnd Bot tool uses action configuration to understand workflow transitions",
                      "test_method": "test_generator_creates_bot_tool_for_test_bot"
                    },
                    {
                      "name": "Bot tool routes to workflow actions based on state",
                      "steps": "Given bot tool is created\nAnd workflow state shows: current_action='story_bot.discovery.build_knowledge'\nAnd build_knowledge action configuration specifies workflow=true, next_action='render_output'\nWhen bot tool is invoked\nThen Bot tool reads workflow state\nAnd Bot tool extracts current behavior and action\nAnd Bot tool routes to discovery.build_knowledge\nAnd Bot tool executes build_knowledge with workflow awareness (auto-transition to render_output)",
                      "test_method": ""
                    },
                    {
                      "name": "Bot tool routes to independent actions via parameter",
                      "steps": "Given bot tool is created\nAnd correct_bot action configuration specifies workflow=false (independent action)\nAnd user invokes bot tool with parameter action='correct_bot'\nWhen bot tool is invoked with action parameter\nThen Bot tool routes to correct_bot action\nAnd Bot tool does NOT use workflow state for routing (parameter overrides)\nAnd Bot tool executes correct_bot without workflow transitions\nAnd Independent actions can be invoked any time via parameter"
                    },
                    {
                      "name": "Bot tool defaults to first behavior/action when no state exists",
                      "steps": "Given bot tool is created\nAnd workflow state does NOT exist\nAnd Bot Config first behavior is 'shape' with first action 'gather_context'\nWhen bot tool is invoked without parameters\nThen Bot tool detects no workflow state\nAnd Bot tool defaults to first behavior ('shape')\nAnd Bot tool defaults to first action ('gather_context')\nAnd Bot tool routes to shape.gather_context\nAnd Bot tool creates initial workflow state"
                    },
                    {
                      "name": "Bot tool recognizes terminal actions",
                      "steps": "Given bot tool is created\nAnd workflow state shows: current_action='story_bot.exploration.validate_rules'\nAnd validate_rules action configuration specifies workflow=true, next_action=null (terminal)\nWhen bot tool is invoked\nThen Bot tool reads workflow state\nAnd Bot tool routes to exploration.validate_rules\nAnd Bot tool recognizes next_action=null (terminal action)\nAnd Bot tool does NOT inject next action instructions after validate_rules completes\nAnd Bot tool indicates workflow is complete"
                    },
                    {
                      "name": "Bot tool handles auto_progress actions",
                      "steps": "Given bot tool is created\nAnd workflow state shows: current_action='story_bot.discovery.build_knowledge'\nAnd build_knowledge action configuration specifies auto_progress=true, next_action='render_output'\nWhen bot tool is invoked\nThen Bot tool routes to discovery.build_knowledge\nAnd Bot tool recognizes auto_progress=true\nAnd Bot tool automatically transitions to render_output after build_knowledge completes\nAnd Bot tool does NOT wait for human confirmation before transitioning"
                    }
                  ]
                },
                {
                  "name": "Generate Behavior Tools",
                  "test_class": "TestGenerateBehaviorTools",
                  "sequential_order": 5,
                  "connector": "or",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN Generator enumerates behaviors from Bot Config",
                    "THEN Generator creates behavior-specific tools for each action in base_actions/",
                    "AND Generator loads action_config.json from each action folder",
                    "AND Workflow actions (workflow: true) get automatic transition logic using next_action field",
                    "AND Independent actions (workflow: false) get no automatic transition logic",
                    "AND Each behavior tool knows action sequence from ordered action_config.json files"
                  ],
                  "scenarios": [
                    {
                      "name": "Generator creates behavior tools for all defined behaviors",
                      "steps": "Given Bot Config defines behaviors: ['shape', 'discovery', 'exploration', 'scenarios']\nAnd base_actions/ contains: gather_context, decide_planning_criteria, build_knowledge, render_output, validate_rules\nWhen Generator enumerates behaviors from Bot Config\nThen Generator creates 4 behavior tools (ONE tool per behavior)\nAnd Each behavior tool can route to all 5 actions\nAnd Tools are named: shape_bot, discovery_bot, exploration_bot, scenarios_bot\nAnd Each tool routes between actions based on parameters or workflow state",
                      "test_method": "test_generator_creates_behavior_tools_for_test_bot_with_4_behaviors"
                    },
                    {
                      "name": "Generator applies workflow transitions to workflow actions",
                      "steps": "Given behavior 'shape' is being processed\nAnd gather_context/action configuration specifies workflow=true, order=1, next_action='decide_planning_criteria'\nAnd decide_planning_criteria/action configuration specifies workflow=true, order=2, next_action='build_knowledge'\nWhen Generator creates shape_bot tool\nThen shape_bot tool knows about all actions and their workflow configuration\nAnd When shape_bot routes to gather_context, it includes automatic transition logic to decide_planning_criteria\nAnd When shape_bot routes to decide_planning_criteria, it includes automatic transition logic to build_knowledge\nAnd Tool uses action configuration to determine transitions"
                    },
                    {
                      "name": "Generator excludes transition logic for independent actions",
                      "steps": "Given behavior 'shape' is being processed\nAnd correct_bot/action configuration specifies workflow=false, order=null, next_action=null\nWhen Generator creates shape_bot tool\nAnd shape_bot is invoked with action parameter 'correct_bot'\nThen shape_bot routes to correct_bot action\nAnd shape_bot does NOT include automatic transition logic for correct_bot\nAnd shape_bot does NOT inject next action instructions after correct_bot\nAnd correct_bot is independently invokable via parameter"
                    },
                    {
                      "name": "Generator orders action sequence from action configuration",
                      "steps": "Given behavior 'shape' is being processed\nAnd action configuration files specify: gather_context(order=1), decide_planning_criteria(order=2), build_knowledge(order=3), render_output(order=4), validate_rules(order=5)\nAnd correct_bot specifies workflow=false (no order)\nWhen Generator creates shape_bot tool\nThen shape_bot knows action sequence from action configuration order fields\nAnd shape_bot workflow sequence is: gather_context  decide_planning_criteria  build_knowledge  render_output  validate_rules\nAnd shape_bot can route to correct_bot independently (not in workflow sequence)"
                    },
                    {
                      "name": "Generator handles terminal action in behavior sequence",
                      "steps": "Given behavior 'exploration' is being processed\nAnd validate_rules/action configuration specifies workflow=true, order=5, next_action=null\nWhen Generator creates exploration_bot tool\nAnd exploration_bot routes to validate_rules\nThen exploration_bot recognizes validate_rules specifies next_action=null (terminal)\nAnd exploration_bot does NOT inject next action instructions after validate_rules\nAnd exploration_bot indicates workflow completion when validate_rules finishes"
                    },
                    {
                      "name": "Generator applies auto_progress for seamless transitions",
                      "steps": "Given behavior 'discovery' is being processed\nAnd build_knowledge/action configuration specifies workflow=true, order=3, next_action='render_output', auto_progress=true\nWhen Generator creates discovery_bot tool\nAnd discovery_bot routes to build_knowledge\nThen discovery_bot recognizes auto_progress=true for build_knowledge\nAnd discovery_bot automatically transitions to render_output without human confirmation\nAnd discovery_bot automatically invokes render_output after build_knowledge completes"
                    },
                    {
                      "name": "Generator handles missing behavior in Bot Config",
                      "steps": "Given Bot Config defines behaviors: ['shape', 'discovery']\nAnd user expects 'exploration' behavior to be available\nWhen Generator enumerates behaviors from Bot Config\nThen Generator creates tools only for 'shape' and 'discovery' behaviors: shape_bot, discovery_bot\nAnd Generator does NOT create exploration_bot tool\nAnd Generator warns user that some behaviors may be missing (non-blocking)"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Invoke Bot",
          "sequential_order": 2,
          "sub_epics": [
            {
              "name": "Init Project",
              "sequential_order": 1,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Initialize Project Location",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "test_class": "TestInitializeProjectLocation",
                  "acceptance_criteria": [
                    "(AC) WHEN Bot behavior is invoked for the first time (no saved location exists)",
                    "(AC) THEN Bot detects current directory from context",
                    "(AC) AND Bot presents location to user for confirmation",
                    "(AC) AND Bot waits for user to confirm or provide different location",
                    "(AC) AND Bot saves confirmed location to persistent storage",
                    "(AC) WHEN Bot behavior is invoked",
                    "(AC) AND Saved location exists",
                    "(AC) AND Current directory matches saved location",
                    "(AC) THEN Bot uses saved location without asking for confirmation",
                    "(AC) AND Bot proceeds directly to next action",
                    "(AC) WHEN Bot behavior is invoked",
                    "(AC) AND Saved location exists",
                    "(AC) AND Current directory is DIFFERENT from saved location",
                    "(AC) THEN Bot presents new location to user for confirmation",
                    "(AC) AND Bot asks if user wants to switch to new location",
                    "(AC) AND Bot saves confirmed location if user approves change"
                  ]
                },
                {
                  "name": "Context Folder Management",
                  "sequential_order": 1.5,
                  "connector": "and",
                  "users": [
                    "Bot-Behavior"
                  ],
                  "story_type": "system",
                  "test_file": "test_context_folder_management.py",
                  "acceptance_criteria": [
                    "WHEN initialize_project action completes with confirmation",
                    "THEN {project_area}/docs/context/ folder exists",
                    "AND context folder is ready for context files",
                    "WHEN user provides input file via @input.txt command",
                    "AND input file exists at original location",
                    "WHEN initialize_project action executes",
                    "THEN initialize_project copies input file to {project_area}/docs/context/input.txt",
                    "AND original input file remains at original location (copy, not move)",
                    "AND {project_area}/docs/context/input.txt exists and contains original content",
                    "WHEN context folder exists at {project_area}/docs/context/",
                    "AND gather_context action has collected key questions and evidence",
                    "WHEN gather_context action stores clarification data",
                    "THEN gather_context saves to {project_area}/docs/stories/clarification.json",
                    "AND clarification.json is NOT saved to {project_area}/docs/context/clarification.json",
                    "AND clarification.json contains behavior-specific key_questions and evidence structure",
                    "WHEN context folder exists with input.txt",
                    "AND clarification.json and planning.json exist in docs/stories/",
                    "WHEN build_knowledge action executes",
                    "THEN build_knowledge loads {project_area}/docs/stories/clarification.json",
                    "AND build_knowledge loads {project_area}/docs/stories/planning.json",
                    "AND build_knowledge loads {project_area}/docs/context/input.txt",
                    "AND build_knowledge incorporates all context into generated content"
                  ],
                  "scenarios": [
                    {
                      "name": "Initialize project creates context folder",
                      "steps": "GIVEN: User confirms project area location\nWHEN: initialize_project action completes\nTHEN: {project_area}/docs/context/ folder exists\nAND: context folder is ready for context files",
                      "test_class": "TestInitializeProjectCreatesContextFolder",
                      "test_method": "test_context_folder_created_after_project_confirmation"
                    },
                    {
                      "name": "Initialize project copies input file to context folder",
                      "steps": "GIVEN: User provides input file via @input.txt command\nAND: input file exists at original location\nWHEN: initialize_project action executes\nTHEN: initialize_project copies input file to {project_area}/docs/context/input.txt\nAND: original input file remains at original location (copy, not move)\nAND: {project_area}/docs/context/input.txt exists and contains original content",
                      "test_class": "TestInputFileCopiedToContextFolder",
                      "test_method": "test_input_file_copied_to_context_folder"
                    },
                    {
                      "name": "Gather context saves clarification to docs/stories folder",
                      "steps": "GIVEN: context folder exists at {project_area}/docs/context/\nAND: gather_context action has collected key questions and evidence\nWHEN: gather_context action stores clarification data\nTHEN: gather_context saves to {project_area}/docs/stories/clarification.json\nAND: clarification.json is NOT saved to {project_area}/docs/context/clarification.json\nAND: clarification.json contains behavior-specific key_questions and evidence structure",
                      "test_class": "TestGatherContextSavesToContextFolder",
                      "test_method": "test_gather_context_saves_clarification_to_context_folder"
                    },
                    {
                      "name": "Build knowledge loads context from correct locations",
                      "steps": "GIVEN: context folder exists with input.txt\nAND: clarification.json and planning.json exist in docs/stories/\nWHEN: build_knowledge action executes\nTHEN: build_knowledge loads {project_area}/docs/stories/clarification.json\nAND: build_knowledge loads {project_area}/docs/stories/planning.json\nAND: build_knowledge loads {project_area}/docs/context/input.txt\nAND: build_knowledge incorporates all context into generated content",
                      "test_class": "TestBuildKnowledgeLoadsFromContextFolder",
                      "test_method": "test_build_knowledge_loads_context_from_context_folder"
                    }
                  ]
                }
              ]
            },
            {
              "name": "Invoke Bot Tool",
              "sequential_order": 2,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Get Help for Command Line Functions",
                  "sequential_order": 6,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user",
                  "test_class": "TestGetHelpForCommandLineFunctions"
                }
              ]
            },
            {
              "name": "Perform Behavior Action",
              "sequential_order": 3,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Workflow Determines Next Action From Current Action",
                  "sequential_order": 9,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "test_file": "test_workflow_action_sequence.py",
                  "acceptance_criteria": [
                    "WHEN Workflow loads state from workflow_state.json",
                    "THEN Workflow uses current_action as source of truth",
                    "AND Workflow extracts action name from current_action field (format: bot.behavior.action)",
                    "AND Workflow falls back to completed_actions if current_action is missing or invalid",
                    "AND Workflow determines next uncompleted action from completed_actions when current_action unavailable",
                    "AND Workflow starts at first action when no workflow_state.json file exists",
                    "AND Workflow handles missing workflow_state.json file gracefully"
                  ],
                  "scenarios": [
                    {
                      "name": "Workflow determines next action from current_action (source of truth)",
                      "steps": "Given workflow_state.json shows: current_action='build_knowledge'\nWhen Workflow loads state\nThen Workflow uses current_action='build_knowledge' as source of truth\nAnd Workflow extracts action name 'build_knowledge' from current_action field\nAnd Workflow sets current_state='build_knowledge'\nAnd Workflow does NOT use completed_actions to override current_action",
                      "test_method": "test_workflow_determines_next_action_from_current_action"
                    },
                    {
                      "name": "Workflow starts at first action when current_action missing and no completed_actions",
                      "steps": "Given workflow_state.json has empty current_action='' and empty completed_actions=[]\nWhen Workflow loads state\nThen Workflow determines current_state is first action in sequence\nAnd Workflow sets current_state='initialize_project'",
                      "test_method": "test_workflow_starts_at_first_action_when_no_completed_actions"
                    },
                    {
                      "name": "Workflow falls back to completed_actions when current_action missing",
                      "steps": "Given workflow_state.json has empty current_action=''\nAnd completed_actions=[initialize_project, gather_context]\nWhen Workflow loads state\nThen Workflow uses completed_actions as fallback\nAnd Workflow determines next uncompleted action\nAnd Workflow sets current_state='decide_planning_criteria'",
                      "test_method": "test_workflow_falls_back_to_completed_actions_when_current_action_missing"
                    },
                    {
                      "name": "Workflow uses current_action when provided (ignores completed_actions)",
                      "steps": "Given workflow_state.json shows current_action='decide_planning_criteria'\nAnd completed_actions=[initialize_project] (behind)\nWhen Workflow loads state\nThen Workflow uses current_action='decide_planning_criteria' as source of truth\nAnd Workflow sets current_state='decide_planning_criteria'\nAnd Workflow does NOT use completed_actions to override",
                      "test_method": "test_workflow_uses_current_action_when_provided"
                    },
                    {
                      "name": "Workflow starts at first action when workflow_state.json missing",
                      "steps": "Given workflow_state.json file does NOT exist\nAnd current_project.json exists\nWhen Workflow is created\nThen Workflow creates new workflow state\nAnd Workflow sets current_state to first action\nAnd Workflow initializes empty completed_actions list",
                      "test_method": "test_workflow_starts_at_first_action_when_no_workflow_state_file_exists"
                    }
                  ]
                },
                {
                  "name": "Close Current Action",
                  "sequential_order": 10,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user",
                  "test_file": "test_close_current_action.py"
                },
                {
                  "name": "Activity Logged To Project Area Not Bot Area",
                  "sequential_order": 11,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "test_file": "test_invoke_bot_tool.py",
                  "test_class": "TestActivityTrackingLocation",
                  "acceptance_criteria": [
                    "WHEN Action tracks activity",
                    "THEN Activity log is written to {project_area}/activity_log.json",
                    "AND Activity log is NOT written to bot directory",
                    "AND Activity log location is determined by current_project.json",
                    "AND Activity entries include correct action_state with full path"
                  ],
                  "scenarios": [
                    {
                      "name": "Activity logged to project_area not bot area",
                      "steps": "Given current_project.json specifies project_area='agile_bot/bots/base_bot/docs/stories'\nAnd action 'gather_context' executes\nWhen Activity logger creates entry\nThen Activity log file is at: project_area/activity_log.json\nAnd Activity log is NOT at: agile_bot/bots/story_bot/activity_log.json\nAnd Activity log location matches project_area from current_project.json",
                      "test_method": "test_activity_logged_to_project_area_not_bot_area"
                    },
                    {
                      "name": "Activity log contains correct entry",
                      "steps": "Given action 'gather_context' executes in behavior 'discovery'\nWhen Activity logger creates entry\nThen Activity log entry includes:\n  - action_state='story_bot.discovery.gather_context'\n  - timestamp\n  - Full path includes bot_name.behavior.action",
                      "test_method": "test_activity_log_contains_correct_entry"
                    }
                  ]
                },
                {
                  "name": "Proceed With Workflow",
                  "sequential_order": 12,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user",
                  "test_file": "test_complete_workflow_integration.py"
                }
              ]
            }
          ]
        },
        {
          "name": "Execute Behavior Actions",
          "sequential_order": 3,
          "sub_epics": [
            {
              "name": "Gather Context",
              "sequential_order": 2,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Track Activity for Gather Context Action",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [
                    "Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestTrackActivityForGatherContextAction",
                  "acceptance_criteria": [
                    "WHEN GatherContextAction executes",
                    "THEN Action creates activity entry with timestamp, action name, behavior name",
                    "AND Activity entry appended to {project_area}/activity_log.json"
                  ],
                  "scenarios": [
                    {
                      "name": "Track activity when gather_context action starts",
                      "steps": "Given behavior is 'discovery'\nAnd action is 'gather_context'\nWhen gather_context action starts execution\nThen Activity logger creates entry with:\n  - timestamp=[start timestamp]\n  - action_state='story_bot.discovery.gather_context'\n  - inputs={source_files_count: 2, context_type: \"exploration\"}\nAnd Entry is appended to activity log at project_area/\nAnd Activity log records action initiation",
                      "test_method": "test_track_activity_when_gather_context_action_starts"
                    },
                    {
                      "name": "Track activity when gather_context action completes",
                      "steps": "Given gather_context action started at timestamp='2025-12-03T10:00:00Z'\nAnd activity log has entry for gather_context  \nWhen gather_context action finishes execution at timestamp='2025-12-03T10:05:30Z'\nThen Activity logger creates completion entry with:\n  - action_state='story_bot.discovery.gather_context'\n  - outputs={questions_count: 5, evidence_count: 3, file_path: \"clarifications.json\"}\n  - duration=330 (seconds: 5.5 minutes)\nAnd Entry is appended to activity log\nAnd Activity log shows complete execution record with metrics and file path",
                      "test_method": "test_track_activity_when_gather_context_action_completes"
                    },
                    {
                      "name": "Track multiple gather_context invocations across behaviors",
                      "steps": "Given activity log contains entry for story_bot.shape.gather_context completed at 09:00\nAnd activity log contains entry for story_bot.discovery.gather_context completed at 10:00\nWhen both entries are present in activity log\nThen activity log contains 2 separate entries:\n  - Entry 1: action_state='story_bot.shape.gather_context', timestamp='2025-12-03T09:00:00Z'\n  - Entry 2: action_state='story_bot.discovery.gather_context', timestamp='2025-12-03T10:00:00Z'\nAnd Each entry has its own inputs (metrics/paths), outputs (metrics/paths), and duration\nAnd Activity log distinguishes same action in different behaviors using full path",
                      "test_method": "test_track_multiple_gather_context_invocations_across_behaviors"
                    },
                    {
                      "name": "Track activity with user-provided context inputs",
                      "steps": "Given user context is available: story map document, increment details, source material\nAnd behavior is 'exploration'\nWhen gather_context action starts\nThen Activity logger records inputs including:\n  - source_files_count=3\n  - source_files_paths=[\"story-map.txt\", \"increment-2.txt\", \"source-material.md\"]\n  - context_type=\"exploration\"\nAnd Inputs capture file paths and counts, not full content\nAnd Activity log tracks what context was provided"
                    },
                    {
                      "name": "Track activity with gathered outputs",
                      "steps": "Given gather_context action completion is ready to log\nAnd Action results include: 5 key questions, 3 evidence items, 2 assumptions\nWhen Activity logger records completion\nThen Activity logger captures outputs including:\n  - questions_count=5\n  - evidence_count=3\n  - assumptions_count=2\n  - file_path=\"clarifications.json\"\n  - summary=\"Gathered context for 3 stories in increment 2\"\nAnd Outputs capture counts and file paths, not full content\nAnd Activity log shows metrics of what was produced"
                    },
                    {
                      "name": "Activity log handles file write failure gracefully",
                      "steps": "Given gather_context action is completing\nAnd project_area/activity log file is write-protected\nWhen Activity logger attempts to append entry\nThen Activity logger detects file write error\nAnd Activity logger warns user in chat: \"Unable to log activity. Audit trail may be incomplete.\" (non-blocking)\nAnd gather_context action continues execution despite logging failure\nAnd Action is not blocked by activity logging failure"
                    },
                    {
                      "name": "Activity log maintains chronological order",
                      "steps": "Given activity log contains 10 previous action entries\nAnd gather_context action completes at timestamp='2025-12-03T10:30:00Z'\nWhen Activity logger appends gather_context entry\nThen New entry is appended to end of activity log array\nAnd Activity log maintains chronological order by timestamp\nAnd Most recent actions appear at end of log"
                    }
                  ]
                },
                {
                  "name": "Proceed To Decide Planning",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestProceedToDecidePlanning",
                  "acceptance_criteria": [
                    "WHEN GatherContextAction completes execution",
                    "AND Human says action is done",
                    "THEN GatherContextAction saves Workflow State (per \"Saves Behavior State\" story)",
                    "AND Workflow injects next action instructions (per \"Inject Next Behavior-Action\" story)",
                    "AND Workflow proceeds to decide_planning_criteria"
                  ],
                  "scenarios": [
                    {
                      "name": "Seamless transition from gather_context to decide_planning_criteria",
                      "steps": "Given behavior is 'discovery'\nAnd gather_context action is complete\nAnd Human confirms \"done\" or \"proceed\"\nWhen gather_context action finalizes\nThen Action saves Workflow State with:\n  - current_behavior='story_bot.discovery'\n  - current_action='story_bot.discovery.gather_context'\n  - timestamp=[completion time]\nAnd Action loads gather_context/action configuration\nAnd Action reads next_action='decide_planning_criteria'\nAnd Action injects AI instructions: \"When done, proceed to decide_planning_criteria\"\nAnd AI invokes decide_planning_criteria tool\nAnd Workflow transitions seamlessly to next action",
                      "test_method": "test_seamless_transition_from_gather_context_to_decide_planning_criteria"
                    },
                    {
                      "name": "User must confirm before transition",
                      "steps": "Given gather_context action is complete\nAnd Human has NOT yet confirmed completion\nWhen gather_context action waits for human feedback\nThen Action does NOT save workflow state as completed\nAnd Action does NOT inject next action instructions\nAnd Action does NOT proceed to decide_planning_criteria\nAnd AI waits for human to say \"done\" before transitioning"
                    },
                    {
                      "name": "Workflow state captures gather_context completion",
                      "steps": "Given gather_context action completes at timestamp='2025-12-03T10:05:30Z'\nAnd Human confirms \"done\"\nWhen Action saves workflow state\nThen workflow state is updated with:\n  - current_action='story_bot.exploration.gather_context'\n  - timestamp='2025-12-03T10:05:30Z'\nAnd completed_actions list includes: {action_state: 'story_bot.exploration.gather_context', timestamp: '2025-12-03T10:05:30Z'}\nAnd State persists to project_area/workflow state\nAnd If workflow is interrupted after this point, gather_context is marked as completed",
                      "test_method": "test_workflow_state_captures_gather_context_completion"
                    },
                    {
                      "name": "Workflow resumes at decide_planning_criteria after interruption",
                      "steps": "Given gather_context is completed and chat was interrupted\nWhen user reopens chat and invokes bot tool\nThen Router forwards to decide_planning_criteria action",
                      "test_method": "test_workflow_resumes_at_decide_planning_criteria_after_interruption"
                    },
                    {
                      "name": "Next action instructions injected into AI context",
                      "steps": "Given gather_context action is complete\nAnd Human has confirmed \"done\"\nAnd gather_context/action configuration specifies next_action='decide_planning_criteria'\nWhen Action injects next action instructions\nThen AI context receives: \"When done, proceed to decide_planning_criteria\"\nAnd AI knows to invoke decide_planning_criteria tool next\nAnd User doesn't need to remember what comes after gather_context\nAnd Seamless transition is enabled by instruction injection"
                    },
                    {
                      "name": "Transition works across different behaviors",
                      "steps": "Given behavior is 'shape' (first behavior)\nAnd gather_context is complete in shape behavior\nAnd Human has confirmed \"done\"\nWhen gather_context transitions to next action\nThen Workflow proceeds to shape_decide_planning_criteria (not discovery_decide_planning_criteria)\nAnd Transition stays within same behavior\nAnd Each behavior has its own workflow sequence"
                    },
                    {
                      "name": "Workflow resumes at decide_planning_criteria after interruption",
                      "steps": "Given workflow state shows: current_action='story_bot.discovery.gather_context'\nAnd completed_actions contains gather_context entry\nAnd decide_planning_criteria has not yet started\nAnd chat session was interrupted\nWhen user reopens chat and invokes bot tool\nThen Router loads workflow state\nAnd Router sees gather_context is completed\nAnd Router determines next action is decide_planning_criteria\nAnd Router forwards to decide_planning_criteria action\nAnd Workflow resumes at correct next step despite interruption",
                      "test_method": "test_workflow_resumes_at_decide_planning_criteria_after_interruption"
                    },
                    {
                      "name": "Activity log records transition",
                      "steps": "Given gather_context action completes at 10:05:30\nAnd Human confirms \"done\"\nWhen gather_context saves state and transitions\nThen Activity log records:\n  - gather_context completion entry with action_state='story_bot.discovery.gather_context', duration=330\n  - Workflow state update showing transition to next action\nAnd Audit trail shows gather_context completed before decide_planning_criteria started"
                    }
                  ]
                }
              ]
            },
            {
              "name": "Decide Planning Criteria",
              "sequential_order": 3,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Track Activity for Planning Action",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [
                    "Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestTrackActivityForPlanningAction",
                  "acceptance_criteria": [
                    "WHEN PlanningAction executes",
                    "THEN Action creates activity entry with timestamp, action name, behavior name",
                    "AND Activity entry appended to {project_area}/activity_log.json"
                  ],
                  "scenarios": [
                    {
                      "name": "Track activity when planning action starts",
                      "steps": "Given behavior is 'exploration'\nAnd action is 'decide_planning_criteria'\nWhen decide_planning_criteria action starts execution\nThen Activity logger creates entry with:\n  - timestamp=[start timestamp]\n  - action_state='story_bot.exploration.decide_planning_criteria'\n  - inputs={questions_count: 5, evidence_count: 3, context_file_path: \"clarifications.json\"}\nAnd Entry is appended to activity log at project_area/\nAnd Activity log records action initiation",
                      "test_method": "test_track_activity_when_planning_action_starts"
                    },
                    {
                      "name": "Track activity when planning action completes",
                      "steps": "Given decide_planning_criteria action started at timestamp='2025-12-03T10:15:00Z'\nAnd activity log has entry for decide_planning_criteria\nWhen decide_planning_criteria action finishes execution at timestamp='2025-12-03T10:25:00Z'\nThen Activity logger creates completion entry with:\n  - action_state='story_bot.exploration.decide_planning_criteria'\n  - outputs={criteria_count: 4, assumptions_count: 2, decisions_count: 3, file_path: \"planning.json\"}\n  - duration=600 (seconds: 10 minutes)\nAnd Entry is appended to activity log\nAnd Activity log shows complete execution record with duration",
                      "test_method": "test_track_activity_when_planning_action_completes"
                    },
                    {
                      "name": "Track planning inputs from previous gather_context",
                      "steps": "Given gather_context outputs are available: 5 questions, 3 evidence items in clarifications.json\nAnd behavior is 'exploration'\nWhen decide_planning_criteria action starts\nThen Activity logger captures inputs including:\n  - gathered_questions=5\n  - gathered_evidence=3\n  - context_from=\"gather_context action output\"\nAnd Inputs show connection to previous action\nAnd Activity log traces workflow dependencies"
                    },
                    {
                      "name": "Track planning outputs (criteria and assumptions)",
                      "steps": "Given decide_planning_criteria action is complete\nAnd Action results include: 4 planning criteria, 2 assumptions, 3 decisions\nWhen Activity logger records completion\nThen Activity logger captures outputs including:\n  - criteria_count=4\n  - assumptions_count=2\n  - decisions_count=3\n  - summary=\"Defined planning approach for increment 3\"\nAnd Outputs are captured in activity log entry\nAnd Activity log shows what planning artifacts were produced"
                    },
                    {
                      "name": "Activity log maintains sequence across actions",
                      "steps": "Given activity log contains entry for gather_context (completed at 10:05:30)\nAnd decide_planning_criteria completes at 10:25:00\nWhen Activity logger appends decide_planning_criteria entry\nThen Activity log shows chronological sequence:\n  1. gather_context started (10:00:00)\n  2. gather_context completed (10:05:30)\n  3. decide_planning_criteria started (10:15:00)\n  4. decide_planning_criteria completed (10:25:00)\nAnd Activity log demonstrates workflow progression"
                    },
                    {
                      "name": "Track multiple planning invocations across behaviors",
                      "steps": "Given activity log contains entry for story_bot.shape.decide_planning_criteria completed at 09:20\nAnd activity log contains entry for story_bot.discovery.decide_planning_criteria completed at 10:15\nWhen both entries are present in activity log\nThen activity log contains 2 separate entries:\n  - Entry 1: action_state='story_bot.shape.decide_planning_criteria', timestamp='2025-12-03T09:20:00Z'\n  - Entry 2: action_state='story_bot.discovery.decide_planning_criteria', timestamp='2025-12-03T10:15:00Z'\nAnd Each entry has its own inputs (metrics/paths), outputs (metrics/paths), and duration\nAnd Activity log distinguishes same action in different behaviors"
                    },
                    {
                      "name": "Activity log handles file write failure gracefully",
                      "steps": "Given decide_planning_criteria action is completing\nAnd project_area/activity log file is write-protected\nWhen Activity logger attempts to append entry\nThen Activity logger detects file write error\nAnd Activity logger warns user in chat: \"Unable to log activity. Audit trail may be incomplete.\" (non-blocking)\nAnd decide_planning_criteria action continues execution despite logging failure\nAnd Action is not blocked by activity logging failure"
                    }
                  ]
                },
                {
                  "name": "Proceed To Build Knowledge",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestProceedToBuildKnowledge",
                  "acceptance_criteria": [
                    "WHEN PlanningAction completes execution",
                    "WHEN Human says action is done",
                    "THEN PlanningAction saves Workflow State (per \"Saves Behavior State\" story)",
                    "AND Workflow injects next action instructions (per \"Inject Next Behavior-Action\" story)",
                    "AND Workflow proceeds to build_knowledge"
                  ],
                  "scenarios": [
                    {
                      "name": "Seamless transition from planning to build_knowledge",
                      "steps": "Given behavior is 'discovery'\nAnd decide_planning_criteria action is complete\nAnd Human confirms \"done\" or \"proceed\"\nWhen decide_planning_criteria action finalizes\nThen Action saves Workflow State with:\n  - current_behavior='story_bot.discovery'\n  - current_action='story_bot.discovery.decide_planning_criteria'\n  - timestamp=[completion time]\nAnd Action loads decide_planning_criteria/action configuration\nAnd Action reads next_action='build_knowledge'\nAnd Action injects AI instructions: \"When done, proceed to build_knowledge\"\nAnd AI invokes build_knowledge tool\nAnd Workflow transitions seamlessly to next action",
                      "test_method": "test_seamless_transition_from_planning_to_build_knowledge"
                    },
                    {
                      "name": "User must confirm before transition",
                      "steps": "Given decide_planning_criteria action is complete\nAnd Human has NOT yet confirmed completion\nWhen decide_planning_criteria action waits for human feedback\nThen Action does NOT save workflow state as completed\nAnd Action does NOT inject next action instructions\nAnd Action does NOT proceed to build_knowledge\nAnd AI waits for human to say \"done\" before transitioning"
                    },
                    {
                      "name": "Workflow state captures planning completion",
                      "steps": "Given decide_planning_criteria action completes at timestamp='2025-12-03T10:25:00Z'\nAnd Human confirms \"done\"\nWhen Action saves workflow state\nThen workflow state is updated with:\n  - current_action='story_bot.exploration.decide_planning_criteria'\n  - timestamp='2025-12-03T10:25:00Z'\nAnd completed_actions list includes: {action_state: 'story_bot.exploration.decide_planning_criteria', timestamp: '2025-12-03T10:25:00Z'}\nAnd State persists to project_area/workflow state\nAnd If workflow is interrupted after this point, planning is marked as completed",
                      "test_method": "test_workflow_state_captures_planning_completion"
                    },
                    {
                      "name": "Next action instructions injected into AI context",
                      "steps": "Given decide_planning_criteria action is complete\nAnd Human has confirmed \"done\"\nAnd decide_planning_criteria/action configuration specifies next_action='build_knowledge'\nWhen Action injects next action instructions\nThen AI context receives: \"When done, proceed to build_knowledge\"\nAnd AI knows to invoke build_knowledge tool next\nAnd User doesn't need to remember that build_knowledge comes after planning\nAnd Seamless transition is enabled by instruction injection"
                    },
                    {
                      "name": "Transition carries planning outputs to build_knowledge",
                      "steps": "Given decide_planning_criteria outputs are available: 4 criteria, 2 assumptions, 3 decisions in planning.json\nAnd Human has confirmed \"done\"\nWhen decide_planning_criteria transitions to build_knowledge\nThen Workflow state includes planning outputs in context\nAnd build_knowledge action receives planning criteria and assumptions as inputs\nAnd Knowledge building is informed by planning decisions"
                    },
                    {
                      "name": "Workflow resumes at build_knowledge after interruption",
                      "steps": "Given workflow state shows: current_action='story_bot.discovery.decide_planning_criteria'\nAnd completed_actions contains decide_planning_criteria entry\nAnd build_knowledge has not yet started\nAnd chat session was interrupted\nWhen user reopens chat and invokes bot tool\nThen Router loads workflow state\nAnd Router sees decide_planning_criteria is completed\nAnd Router determines next action is build_knowledge\nAnd Router forwards to build_knowledge action\nAnd Workflow resumes at correct next step despite interruption"
                    },
                    {
                      "name": "Activity log records transition",
                      "steps": "Given decide_planning_criteria action completes at 10:25:00\nAnd Human confirms \"done\"\nWhen decide_planning_criteria saves state and transitions\nThen Activity log records:\n  - decide_planning_criteria completion entry with action_state='story_bot.discovery.decide_planning_criteria', duration=600\n  - Workflow state update showing transition to build_knowledge\nAnd Audit trail shows planning completed before build_knowledge started"
                    },
                    {
                      "name": "Transition works mid-workflow",
                      "steps": "Given workflow state shows gather_context is complete (order=1)\nAnd decide_planning_criteria is at order=2 in workflow\nAnd build_knowledge is next at order=3\nAnd Human has confirmed \"done\"\nWhen decide_planning_criteria transitions\nThen Workflow proceeds to build_knowledge (middle of workflow sequence)\nAnd Sequential flow continues: gather_context  decide_planning_criteria  build_knowledge\nAnd Mid-workflow transitions work identically to first transition"
                    }
                  ]
                }
              ]
            },
            {
              "name": "Build Knowledge",
              "sequential_order": 4,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Build Knowledge Loads From Context Folder",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "system",
                  "test_file": "test_build_knowledge.py",
                  "test_class": "TestBuildKnowledgeLoadsFromContextFolder",
                  "acceptance_criteria": [
                    "WHEN build_knowledge action executes",
                    "THEN Action loads context from {project_area}/docs/stories/ folder (clarification.json, planning.json)",
                    "AND Action loads original input from {project_area}/docs/context/ folder (input.txt)",
                    "AND Action incorporates all context into generated content"
                  ]
                },
                {
                  "name": "Inject Knowledge Graph Template and Builder Instructions",
                  "sequential_order": 1,
                  "connector": "opt",
                  "users": [
                    "Bot-Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_build_knowledge.py",
                  "test_class": "TestInjectKnowledgeGraphTemplateForBuildKnowledge",
                  "test_method": "test_action_injects_knowledge_graph_template",
                  "acceptance_criteria": [
                    "WHEN Build Knowledge Action executes",
                    "THEN Action loads knowledge graph template from behavior/content/knowledge_graph/",
                    "AND Action injects knowledge graph template path into instructions",
                    "AND knowledge_graph_template field is present in instructions",
                    "AND template file path exists and is accessible",
                    "WHEN knowledge graph template does not exist",
                    "THEN Action raises FileNotFoundError with appropriate error message"
                  ],
                  "scenarios": [
                    {
                      "name": "Action injects knowledge graph template",
                      "steps": "Given behavior folder exists with knowledge graph template\nWhen Build Knowledge Action executes inject_knowledge_graph_template\nThen Action loads template from behavior/content/knowledge_graph/\nAnd Action injects template path into instructions\nAnd instructions contain knowledge_graph_template field\nAnd template file path exists",
                      "test_method": "test_action_injects_knowledge_graph_template"
                    },
                    {
                      "name": "Action raises error when template missing",
                      "steps": "Given behavior folder exists without knowledge graph template\nWhen Build Knowledge Action executes inject_knowledge_graph_template\nThen Action raises FileNotFoundError\nAnd error message indicates template not found",
                      "test_method": "test_action_raises_error_when_template_missing"
                    }
                  ]
                },
                {
                  "name": "Track Activity for Build Knowledge Action",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestTrackActivityForBuildKnowledgeAction",
                  "acceptance_criteria": [
                    "WHEN BuildKnowledgeAction executes",
                    "THEN Action creates activity entry with timestamp, action name, behavior name",
                    "AND Activity entry appended to {project_area}/activity_log.json"
                  ],
                  "scenarios": [
                    {
                      "name": "Track activity when build_knowledge action starts",
                      "steps": "Given behavior is 'scenarios'\nAnd action is 'build_knowledge'\nWhen build_knowledge action starts execution\nThen Activity logger creates entry with:\n  - timestamp=[start timestamp]\n  - action_state='story_bot.scenarios.build_knowledge'\n  - inputs={criteria_count: 4, assumptions_count: 2, context_file_path: \"planning.json\"}\nAnd Entry is appended to activity log at project_area/\nAnd Activity log records action initiation",
                      "test_method": "test_track_activity_when_build_knowledge_action_starts"
                    },
                    {
                      "name": "Track activity when build_knowledge action completes",
                      "steps": "Given build_knowledge action started at timestamp='2025-12-03T10:30:00Z'\nAnd activity log has entry for build_knowledge\nWhen build_knowledge action finishes execution at timestamp='2025-12-03T10:50:00Z'\nThen Activity logger creates completion entry with:\n  - action_state='story_bot.scenarios.build_knowledge'\n  - outputs={concepts_count: 15, relationships_count: 30, rules_count: 8, file_path: \"knowledge_graph.json\"}\n  - duration=1200 (seconds: 20 minutes)\nAnd Entry is appended to activity log\nAnd Activity log shows complete execution record with duration",
                      "test_method": "test_track_activity_when_build_knowledge_action_completes"
                    },
                    {
                      "name": "Track knowledge building inputs from previous actions",
                      "steps": "Given gather_context outputs are available in clarifications.json\nAnd decide_planning_criteria outputs are available in planning.json  \nAnd behavior is 'scenarios'\nWhen build_knowledge action starts\nThen Activity logger captures inputs including:\n  - context_from=\"gather_context and decide_planning_criteria\"\n  - questions_count=5\n  - criteria_count=4\n  - assumptions_count=2\nAnd Inputs show connection to previous actions\nAnd Activity log traces workflow dependencies"
                    },
                    {
                      "name": "Track knowledge graph outputs",
                      "steps": "Given build_knowledge action is complete\nAnd Knowledge graph contains: 15 concepts, 30 relationships, 8 rules\nWhen Activity logger records completion\nThen Activity logger captures outputs including:\n  - concepts_count=15\n  - relationships_count=30\n  - rules_count=8\n  - file_path=\"knowledge_graph.json\"\n  - summary=\"Built domain knowledge graph for increment 3\"\nAnd Outputs capture counts and file paths, not full graph content\nAnd Activity log shows metrics of what knowledge artifacts were produced"
                    },
                    {
                      "name": "Activity log maintains sequence through build_knowledge",
                      "steps": "Given activity log contains entries for:\n  - gather_context (completed at 10:05:30)\n  - decide_planning_criteria (completed at 10:25:00)\nAnd build_knowledge completes at 10:50:00\nWhen Activity logger appends build_knowledge entry\nThen Activity log shows chronological sequence:\n  1. gather_context (10:00:00 - 10:05:30)\n  2. decide_planning_criteria (10:15:00 - 10:25:00)\n  3. build_knowledge (10:30:00 - 10:50:00)\nAnd Activity log demonstrates workflow progression through knowledge building"
                    },
                    {
                      "name": "Track multiple build_knowledge invocations across behaviors",
                      "steps": "Given activity log contains entry for story_bot.shape.build_knowledge completed at 09:30\nAnd activity log contains entry for story_bot.exploration.build_knowledge completed at 10:30\nWhen both entries are present in activity log\nThen activity log contains 2 separate entries:\n  - Entry 1: action_state='story_bot.shape.build_knowledge', timestamp='2025-12-03T09:30:00Z'\n  - Entry 2: action_state='story_bot.exploration.build_knowledge', timestamp='2025-12-03T10:30:00Z'\nAnd Each entry has its own inputs, outputs, and duration\nAnd Activity log distinguishes same action in different behaviors"
                    },
                    {
                      "name": "Activity log handles file write failure gracefully",
                      "steps": "Given build_knowledge action is completing\nAnd project_area/activity log file is write-protected\nWhen Activity logger attempts to append entry\nThen Activity logger detects file write error\nAnd Activity logger warns user in chat: \"Unable to log activity. Audit trail may be incomplete.\" (non-blocking)\nAnd build_knowledge action continues execution despite logging failure\nAnd Action is not blocked by activity logging failure"
                    }
                  ]
                },
                {
                  "name": "Proceed To Render Output",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestProceedToRenderOutput",
                  "acceptance_criteria": [
                    "WHEN BuildKnowledgeAction completes execution",
                    "THEN BuildKnowledgeAction saves Workflow State (per \"Saves Behavior State\" story)",
                    "AND BuildKnowledgeAction submits content for saving",
                    "AND Workflow automatically proceeds to render_output (auto_progress: true, no human confirmation needed)"
                  ],
                  "scenarios": [
                    {
                      "name": "Automatic transition from build_knowledge to render_output (no human confirmation)",
                      "steps": "Given behavior is 'discovery'\nAnd build_knowledge action is complete\nAnd build_knowledge/action configuration specifies auto_progress=true\nWhen build_knowledge action finalizes\nThen Action saves Workflow State with:\n  - current_behavior='story_bot.discovery'\n  - current_action='story_bot.discovery.build_knowledge'\n  - timestamp=[completion time]\nAnd Action loads build_knowledge/action configuration\nAnd Action reads next_action='render_output' and auto_progress=true\nAnd Action injects AI instructions: \"Automatically proceed to render_output now (no human confirmation needed)\"\nAnd AI immediately invokes render_output tool without waiting for user\nAnd Workflow transitions automatically to render_output",
                      "test_method": "test_seamless_transition_from_build_knowledge_to_render_output"
                    },
                    {
                      "name": "Auto_progress distinguishes build_knowledge from other actions",
                      "steps": "Given gather_context action requires human confirmation (auto_progress not set)\nAnd decide_planning_criteria action requires human confirmation (auto_progress not set)\nAnd build_knowledge action specifies auto_progress=true\nWhen build_knowledge completes\nThen build_knowledge proceeds to render_output automatically\nAnd User is NOT prompted to say \"done\" before transition\nAnd Workflow is more efficient due to automatic progression"
                    },
                    {
                      "name": "Workflow state captures build_knowledge completion before auto-transition",
                      "steps": "Given build_knowledge action completes at timestamp='2025-12-03T10:50:00Z'\nAnd auto_progress=true is configured\nWhen Action saves workflow state before transitioning\nThen workflow state is updated with:\n  - current_action='story_bot.exploration.build_knowledge'\n  - timestamp='2025-12-03T10:50:00Z'\nAnd completed_actions list includes: {action_state: 'story_bot.exploration.build_knowledge', timestamp: '2025-12-03T10:50:00Z'}\nAnd State persists BEFORE automatic transition to render_output\nAnd If workflow is interrupted during transition, build_knowledge is marked as completed",
                      "test_method": "test_workflow_state_captures_build_knowledge_completion"
                    },
                    {
                      "name": "Next action instructions indicate automatic progression",
                      "steps": "Given build_knowledge action is complete\nAnd build_knowledge/action configuration specifies auto_progress=true, next_action='render_output'\nWhen Action injects next action instructions\nThen AI context receives: \"Automatically proceed to render_output now (no human confirmation needed)\"\nAnd AI understands to invoke render_output immediately\nAnd User sees seamless transition without being prompted\nAnd Automatic progression is clearly communicated"
                    },
                    {
                      "name": "Workflow resumes at render_output after interruption during auto-transition",
                      "steps": "Given workflow state shows: current_action='story_bot.discovery.build_knowledge'\nAnd completed_actions contains build_knowledge entry\nAnd render_output has not yet started\nAnd chat session was interrupted during transition\nWhen user reopens chat and invokes bot tool\nThen Router loads workflow state\nAnd Router sees build_knowledge is completed\nAnd Router determines next action is render_output\nAnd Router forwards to render_output action\nAnd Workflow resumes at render_output despite interruption during auto-transition"
                    },
                    {
                      "name": "Activity log records automatic transition",
                      "steps": "Given build_knowledge action completes at 10:50:00\nAnd auto_progress=true triggers automatic transition\nWhen build_knowledge saves state and auto-progresses\nThen Activity log records:\n  - build_knowledge completion entry with action_state='story_bot.discovery.build_knowledge', duration=1200\n  - Workflow state update showing automatic transition to render_output\n  - Note indicating auto_progress was enabled\nAnd Audit trail distinguishes automatic vs manual transitions"
                    },
                    {
                      "name": "Auto-transition fails gracefully if render_output unavailable",
                      "steps": "Given build_knowledge completes with auto_progress=true\nAnd render_output tool is unavailable or disabled\nWhen Action attempts automatic transition\nThen Action detects render_output tool unavailable\nAnd Action warns user in chat: \"Cannot auto-progress to render_output. Tool unavailable.\" (non-blocking)\nAnd Action saves workflow state with build_knowledge completed\nAnd Workflow pauses at build_knowledge completion\nAnd User can manually invoke render_output when available"
                    }
                  ]
                },
                {
                  "name": "Proceed To Validate Rules",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestProceedToValidateRules",
                  "acceptance_criteria": [
                    "WHEN RenderOutputAction completes execution",
                    "WHEN Human says action is done",
                    "THEN RenderOutputAction saves Workflow State (per \"Saves Behavior State\" story)",
                    "AND RenderOutputAction submits content for saving",
                    "AND Workflow injects next action instructions (per \"Inject Next Behavior-Action\" story)",
                    "AND Workflow proceeds to validate_rules"
                  ],
                  "scenarios": [
                    {
                      "name": "Seamless transition from render_output to validate_rules",
                      "steps": "Given behavior is 'discovery'\nAnd render_output action is complete\nAnd Human confirms \"done\" or \"proceed\"\nWhen render_output action finalizes\nThen Action saves Workflow State with:\n  - current_behavior='story_bot.discovery'\n  - current_action='story_bot.discovery.render_output'\n  - timestamp=[completion time]\nAnd Action loads render_output/action configuration\nAnd Action reads next_action='validate_rules'\nAnd Action injects AI instructions: \"When done, proceed to validate_rules\"\nAnd AI invokes validate_rules tool\nAnd Workflow transitions seamlessly to next action",
                      "test_method": "test_seamless_transition_from_render_output_to_validate_rules"
                    },
                    {
                      "name": "User must confirm before transition",
                      "steps": "Given render_output action is complete\nAnd Human has NOT yet confirmed completion\nWhen render_output action waits for human feedback\nThen Action does NOT save workflow state as completed\nAnd Action does NOT inject next action instructions\nAnd Action does NOT proceed to validate_rules\nAnd AI waits for human to say \"done\" before transitioning"
                    },
                    {
                      "name": "Workflow state captures render_output completion",
                      "steps": "Given render_output action completes at timestamp='2025-12-03T11:00:00Z'\nAnd Human confirms \"done\"\nWhen Action saves workflow state\nThen workflow state is updated with:\n  - current_action='story_bot.exploration.render_output'\n  - timestamp='2025-12-03T11:00:00Z'\nAnd completed_actions list includes: {action_state: 'story_bot.exploration.render_output', timestamp: '2025-12-03T11:00:00Z'}\nAnd State persists to project_area/workflow state\nAnd If workflow is interrupted after this point, render_output is marked as completed",
                      "test_method": "test_workflow_state_captures_render_output_completion"
                    },
                    {
                      "name": "Next action instructions injected into AI context",
                      "steps": "Given render_output action is complete\nAnd Human has confirmed done\nWhen Action injects next action instructions\nThen AI context receives instructions to proceed to validate_rules",
                      "test_method": "test_next_action_instructions_injected_into_ai_context"
                    },
                    {
                      "name": "Workflow resumes at validate_rules after interruption",
                      "steps": "Given workflow state shows render_output is completed\nAnd chat session was interrupted\nWhen user reopens chat and invokes bot tool\nThen Router forwards to validate_rules action",
                      "test_method": "test_workflow_resumes_at_validate_rules_after_interruption"
                    },
                    {
                      "name": "Next action instructions injected into AI context",
                      "steps": "Given render_output action is complete\nAnd Human has confirmed \"done\"\nAnd render_output/action configuration specifies next_action='validate_rules'\nWhen Action injects next action instructions\nThen AI context receives: \"When done, proceed to validate_rules\"\nAnd AI knows to invoke validate_rules tool next\nAnd User doesn't need to remember that validate_rules comes after render_output\nAnd Seamless transition is enabled by instruction injection"
                    },
                    {
                      "name": "Transition to terminal action (validate_rules)",
                      "steps": "Given render_output is complete  \nAnd validate_rules specifies next_action=null (terminal action)\nWhen Workflow transitions to validate_rules\nThen validate_rules is recognized as final action in workflow sequence\nAnd After validate_rules completes, workflow will be complete\nAnd User understands validate_rules is the last workflow step"
                    },
                    {
                      "name": "Workflow resumes at validate_rules after interruption",
                      "steps": "Given workflow state shows: current_action='story_bot.discovery.render_output'\nAnd completed_actions contains render_output entry\nAnd validate_rules has not yet started\nAnd chat session was interrupted\nWhen user reopens chat and invokes bot tool\nThen Router loads workflow state\nAnd Router sees render_output is completed\nAnd Router determines next action is validate_rules\nAnd Router forwards to validate_rules action\nAnd Workflow resumes at correct next step despite interruption"
                    },
                    {
                      "name": "Activity log records transition to validation",
                      "steps": "Given render_output action completes at 11:00:00\nAnd Human confirms \"done\"\nWhen render_output saves state and transitions\nThen Activity log records:\n  - render_output completion entry with action_state='story_bot.discovery.render_output', duration=600\n  - Workflow state update showing transition to validate_rules\nAnd Audit trail shows render_output completed before validate_rules started"
                    },
                    {
                      "name": "Rendered outputs become validation inputs",
                      "steps": "Given render_output outputs are available: 6 documents generated\nAnd Human has confirmed \"done\"\nWhen render_output transitions to validate_rules\nThen Workflow state includes rendered outputs in context\nAnd validate_rules action receives rendered documents as inputs\nAnd Validation checks the documents that were just rendered\nAnd Workflow maintains data flow from render to validate"
                    }
                  ]
                }
              ]
            },
            {
              "name": "Render Output",
              "sequential_order": 5,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Load Render Configurations",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [
                    "Bot-Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_load_rendered_content.py",
                  "test_class": "TestLoadRenderConfigurations",
                  "scenarios": [
                    {
                      "name": "Render output discovers and loads render JSON files",
                      "steps": "Given Behavior folder contains 2_content/2_render/ folder\nAnd Render folder contains render JSON file\nWhen render_output action executes for the behavior\nThen render_output discovers render folder using *_content/*_render pattern\nAnd render_output loads all *.json files from render folder\nAnd render_output reads each render JSON configuration",
                      "test_method": "test_render_output_discovers_and_loads_render_json_files"
                    },
                    {
                      "name": "Render output loads instructions.json from render folder",
                      "steps": "Given Render folder contains instructions.json file\nAnd Render folder contains render JSON configuration files\nWhen render_output discovers render folder\nThen render_output loads instructions.json if it exists\nAnd render_output stores render_instructions for later injection\nAnd render_instructions are separate from render_configs",
                      "test_method": "test_render_output_loads_instructions_json_from_render_folder"
                    },
                    {
                      "name": "Render output verifies synchronizer classes exist and have render method",
                      "steps": "Given Render JSON file exists with synchronizer field\nWhen render_output loads render JSON file\nThen render_output verifies synchronizer field contains full module path and class name\nAnd render_output verifies synchronizer class can be imported\nAnd render_output verifies synchronizer class has render method\nAnd render_output stores synchronizer class path in render config",
                      "test_method": "test_render_output_verifies_synchronizer_classes_exist_and_have_render_method"
                    },
                    {
                      "name": "Render output handles missing render folder",
                      "steps": "Given Behavior folder does not contain 2_content/2_render/ folder\nWhen render_output action executes for the behavior\nThen render_output reports error (render folder is required for render_output action)\nAnd render_output cannot proceed without render configurations",
                      "test_method": "test_render_output_handles_missing_render_folder"
                    },
                    {
                      "name": "Render output handles unreadable render JSON files",
                      "steps": "Given Render folder contains multiple *.json files\nAnd One render JSON file cannot be read (corrupted or invalid JSON)\nWhen render_output loads render JSON files\nThen render_output skips unreadable render JSON file\nAnd render_output continues loading other *.json files from render folder\nAnd render_output does not fail entire load process",
                      "test_method": "test_render_output_handles_unreadable_render_json_files"
                    },
                    {
                      "name": "Render output handles invalid synchronizer classes",
                      "steps": "Given Render JSON file exists with synchronizer field\nAnd Synchronizer class cannot be imported or does not have render method\nWhen render_output loads render JSON file\nThen render_output reports error for that render config\nAnd render_output continues loading other render configs\nAnd render_output does not fail entire load process",
                      "test_method": "test_render_output_handles_invalid_synchronizer_classes"
                    }
                  ]
                },
                {
                  "name": "Inject Template Instructions",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Bot-Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_load_rendered_content.py",
                  "test_class": "TestInjectTemplateInstructions",
                  "scenarios": [
                    {
                      "name": "Render output loads template files from render JSON",
                      "steps": "Given Render JSON file specifies template field\nAnd Render JSON does not have synchronizer field\nAnd Template file exists at 2_content/2_render/templates/\nWhen render_output processes template-only render configs\nThen render_output checks for template field in configuration\nAnd render_output loads template file from templates folder\nAnd render_output loads template file as text content\nAnd render_output stores template content with render config",
                      "test_method": "test_render_output_loads_template_files_from_render_json"
                    },
                    {
                      "name": "Render output injects template content into instructions",
                      "steps": "Given Render JSON file exists without synchronizer field\nAnd Render JSON file specifies template field\nAnd render_output has loaded render JSON file\nAnd render_output has loaded template file\nWhen render_output merges instructions\nThen render_output injects render_configs array into merged instructions\nAnd render_configs[0] includes config with name from render JSON file\nAnd render_configs[0] includes loaded template content from template file",
                      "test_method": "test_render_output_injects_template_content_into_instructions"
                    },
                    {
                      "name": "Render output handles missing template files gracefully",
                      "steps": "Given Render JSON specifies template file that does not exist\nAnd Render JSON does not have synchronizer field\nAnd Other render JSONs with templates do exist\nWhen render_output loads template files\nThen render_output skips missing template file\nAnd render_output continues loading other templates\nAnd render_output includes successfully loaded templates with render configs",
                      "test_method": "test_render_output_handles_missing_template_files_gracefully"
                    }
                  ]
                },
                {
                  "name": "Inject Synchronizer Instructions",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Bot-Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_load_rendered_content.py",
                  "test_class": "TestInjectSynchronizerInstructions",
                  "scenarios": [
                    {
                      "name": "Render output includes synchronizer configs in render_configs array",
                      "steps": "Given Render JSON file exists with synchronizer field\nAnd Render JSON file specifies renderer_command (optional, for render method variant)\nAnd render_output has loaded render JSON file\nAnd Synchronizer class has been verified\nWhen render_output processes synchronizer-based render configs\nThen render_output includes config with synchronizer field in render_configs array\nAnd render_configs[0] includes config with name from render JSON file\nAnd render_configs[0] includes synchronizer class path\nAnd render_configs[0] includes renderer_command (if specified)\nAnd render_configs[0] includes input and output paths from render JSON",
                      "test_method": "test_render_output_includes_synchronizer_configs_in_render_configs_array"
                    },
                    {
                      "name": "Render output includes synchronizer execution instructions in base_instructions",
                      "steps": "Given Render JSON file exists with synchronizer field\nAnd Render JSON file specifies renderer_command (optional, for render method variant)\nAnd Render JSON file specifies input and output\nAnd render_output has processed synchronizer-based render configs\nWhen render_output merges instructions\nThen base_instructions contain instruction to instantiate synchronizer class\nAnd base_instructions contain instruction to call render method on synchronizer instance\nAnd base_instructions specify render method call with input and output paths\nAnd base_instructions specify renderer_command if provided (for method variant)",
                      "test_method": "test_render_output_includes_synchronizer_execution_instructions_in_base_instructions"
                    }
                  ]
                },
                {
                  "name": "Track Activity for Render Output Action",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestTrackActivityForRenderOutputAction",
                  "acceptance_criteria": [
                    "WHEN RenderOutputAction executes",
                    "THEN Action creates activity entry with timestamp, action name, behavior name",
                    "AND Activity entry appended to {project_area}/activity_log.json"
                  ],
                  "scenarios": [
                    {
                      "name": "Track activity when render_output action starts",
                      "steps": "Given behavior is 'exploration'\nAnd action is 'render_output'\nWhen render_output action starts execution\nThen Activity logger creates entry with:\n  - timestamp=[start timestamp]\n  - action_state='story_bot.exploration.render_output'\n  - inputs={knowledge_graph_path: \"knowledge_graph.json\", templates_count: 2}\nAnd Entry is appended to activity log at project_area/\nAnd Activity log records action initiation",
                      "test_method": "test_track_activity_when_render_output_action_starts"
                    },
                    {
                      "name": "Track activity when render_output action completes",
                      "steps": "Given render_output action started at timestamp='2025-12-03T10:50:00Z'\nAnd activity log has entry for render_output\nWhen render_output action finishes execution at timestamp='2025-12-03T11:00:00Z'\nThen Activity logger creates completion entry with:\n  - action_state='story_bot.exploration.render_output'\n  - outputs={documents_generated: 6, file_paths: [\"story-map.md\", \"increment-3.md\", \"story-1.md\"]}\n  - duration=600 (seconds: 10 minutes)\nAnd Entry is appended to activity log\nAnd Activity log shows complete execution record with duration",
                      "test_method": "test_track_activity_when_render_output_action_completes"
                    },
                    {
                      "name": "Track multiple render_output invocations across behaviors",
                      "steps": "Given activity log contains entries for shape and discovery render_output\nWhen both entries are present\nThen activity log distinguishes same action in different behaviors using full path",
                      "test_method": "test_track_multiple_render_output_invocations_across_behaviors"
                    },
                    {
                      "name": "Activity log handles file write failure gracefully",
                      "steps": "Given render_output action is completing\nAnd project_area/activity log file is write-protected\nWhen Activity logger attempts to append entry\nThen Action continues execution despite logging failure",
                      "test_method": "test_activity_log_handles_file_write_failure_gracefully"
                    },
                    {
                      "name": "Track rendering inputs from knowledge graph",
                      "steps": "Given knowledge_graph.json contains 15 concepts, 30 relationships\nAnd behavior is 'exploration'\nWhen render_output action starts\nThen Activity logger captures inputs including:\n  - knowledge_graph_path=\"knowledge_graph.json\"\n  - concepts_count=15\n  - relationships_count=30\n  - templates_count=2\nAnd Inputs capture file paths and metrics, not full content\nAnd Activity log traces workflow dependencies"
                    },
                    {
                      "name": "Track rendered output artifacts",
                      "steps": "Given render_output action is complete\nAnd Rendered outputs include: 3 story documents, 1 story map, 2 increment documents\nWhen Activity logger records completion\nThen Activity logger captures outputs including:\n  - documents_generated=6\n  - file_paths=[\"story-map.md\", \"increment-3.md\", \"story-1.md\", \"story-2.md\", \"story-3.md\", \"structured.json\"]\n  - summary=\"Rendered output documents for increment 3\"\nAnd Outputs capture file paths and counts, not document content\nAnd Activity log shows metrics of what rendering artifacts were produced"
                    },
                    {
                      "name": "Activity log maintains sequence through render_output",
                      "steps": "Given activity log contains entries for:\n  - gather_context (completed at 10:05:30)\n  - decide_planning_criteria (completed at 10:25:00)\n  - build_knowledge (completed at 10:50:00)\nAnd render_output completes at 11:00:00\nWhen Activity logger appends render_output entry\nThen Activity log shows chronological sequence:\n  1. gather_context (10:00:00 - 10:05:30)\n  2. decide_planning_criteria (10:15:00 - 10:25:00)\n  3. build_knowledge (10:30:00 - 10:50:00)\n  4. render_output (10:50:00 - 11:00:00)\nAnd Activity log demonstrates workflow progression through rendering"
                    },
                    {
                      "name": "Track multiple render_output invocations across behaviors",
                      "steps": "Given activity log contains entry for story_bot.shape.render_output completed at 09:45\nAnd activity log contains entry for story_bot.exploration.render_output completed at 10:50\nWhen both entries are present in activity log\nThen activity log contains 2 separate entries:\n  - Entry 1: action_state='story_bot.shape.render_output', timestamp='2025-12-03T09:45:00Z'\n  - Entry 2: action_state='story_bot.exploration.render_output', timestamp='2025-12-03T10:50:00Z'\nAnd Each entry has its own inputs, outputs, and duration\nAnd Activity log distinguishes same action in different behaviors"
                    },
                    {
                      "name": "Activity log handles file write failure gracefully",
                      "steps": "Given render_output action is completing\nAnd project_area/activity log file is write-protected\nWhen Activity logger attempts to append entry\nThen Activity logger detects file write error\nAnd Activity logger warns user in chat: \"Unable to log activity. Audit trail may be incomplete.\" (non-blocking)\nAnd render_output action continues execution despite logging failure\nAnd Action is not blocked by activity logging failure"
                    }
                  ]
                }
              ]
            },
            {
              "name": "Validate Knowledge & Content Against Rules",
              "sequential_order": 16,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Track Activity for Validate Rules Action",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [
                    "Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestTrackActivityForValidateRulesAction",
                  "acceptance_criteria": [
                    "WHEN ValidateRulesAction executes",
                    "THEN Action creates activity entry with timestamp, action name, behavior name, violations count",
                    "AND Activity entry appended to {project_area}/activity_log.json"
                  ],
                  "scenarios": [
                    {
                      "name": "Track activity when validate_rules action starts",
                      "steps": "Given behavior is 'scenarios'\nAnd action is 'validate_rules'\nWhen validate_rules action starts execution\nThen Activity logger creates entry with:\n  - timestamp=[start timestamp]\n  - action_state='story_bot.scenarios.validate_rules'\n  - inputs={documents_count: 6, rules_files_paths: [\"story-scenarios-rules.json\", \"story-structure-rules.json\"]}\nAnd Entry is appended to activity log at project_area/\nAnd Activity log records action initiation",
                      "test_method": "test_track_activity_when_validate_rules_action_starts"
                    },
                    {
                      "name": "Track activity when validate_rules action completes",
                      "steps": "Given validate_rules action started at timestamp='2025-12-03T11:00:00Z'\nAnd activity log has entry for validate_rules\nWhen validate_rules action finishes execution at timestamp='2025-12-03T11:10:00Z'\nThen Activity logger creates completion entry with:\n  - action_state='story_bot.scenarios.validate_rules'\n  - outputs={violations_count: 3, rules_passed: 15, report_path: \"validation_report.json\"}\n  - duration=600 (seconds: 10 minutes)\nAnd Entry is appended to activity log\nAnd Activity log shows complete execution record with duration",
                      "test_method": "test_track_activity_when_validate_rules_action_completes"
                    },
                    {
                      "name": "Track multiple validate_rules invocations across behaviors",
                      "steps": "Given activity log contains entries for shape and exploration validate_rules\nWhen both entries are present\nThen activity log distinguishes same action in different behaviors",
                      "test_method": "test_track_multiple_validate_rules_invocations_across_behaviors"
                    },
                    {
                      "name": "Activity log maintains chronological order",
                      "steps": "Given activity log contains 10 previous action entries\nWhen validate_rules entry is appended\nThen New entry appears at end of log in chronological order",
                      "test_method": "test_activity_log_maintains_chronological_order"
                    },
                    {
                      "name": "Track validation inputs from rendered content",
                      "steps": "Given rendered documents are available: 6 documents in docs/stories/\nAnd behavior is 'scenarios'\nWhen validate_rules action starts\nThen Activity logger captures inputs including:\n  - documents_count=6\n  - documents_paths=[\"story-1.md\", \"story-2.md\", \"story-3.md\"]\n  - rules_files_paths=[\"story-scenarios-rules.json\", \"story-structure-rules.json\"]\nAnd Inputs capture file paths and counts, not full content\nAnd Activity log traces workflow dependencies"
                    },
                    {
                      "name": "Track validation outputs (results and violations)",
                      "steps": "Given validate_rules action is complete\nAnd Validation results show: 6 documents, 3 violations, 15 rules passed\nWhen Activity logger records completion\nThen Activity logger captures outputs including:\n  - documents_validated=6\n  - violations_count=3\n  - rules_passed=15\n  - report_path=\"validation_report.json\"\n  - summary=\"Validation completed with 3 violations\"\nAnd Outputs capture counts and file paths, not full report content\nAnd Activity log shows metrics of what validation results were produced"
                    },
                    {
                      "name": "Activity log shows complete workflow sequence",
                      "steps": "Given activity log contains entries for:\n  - gather_context (completed at 10:05:30)\n  - decide_planning_criteria (completed at 10:25:00)\n  - build_knowledge (completed at 10:50:00)\n  - render_output (completed at 11:00:00)\nAnd validate_rules completes at 11:10:00\nWhen Activity logger appends validate_rules entry\nThen Activity log shows complete workflow sequence:\n  1. gather_context (10:00:00 - 10:05:30)\n  2. decide_planning_criteria (10:15:00 - 10:25:00)\n  3. build_knowledge (10:30:00 - 10:50:00)\n  4. render_output (10:50:00 - 11:00:00)\n  5. validate_rules (11:00:00 - 11:10:00)\nAnd Activity log demonstrates complete workflow from start to finish"
                    },
                    {
                      "name": "Track validate_rules as terminal action",
                      "steps": "Given validate_rules action completes\nAnd validate_rules/action configuration specifies next_action=null (terminal action)\nWhen Activity logger records completion\nThen Activity log entry includes note: \"Terminal action - workflow complete\"\nAnd Activity log indicates this is final action in workflow\nAnd Audit trail shows workflow reached its intended end"
                    },
                    {
                      "name": "Track multiple validate_rules invocations across behaviors",
                      "steps": "Given activity log contains entry for story_bot.shape.validate_rules completed at 09:55\nAnd activity log contains entry for story_bot.exploration.validate_rules completed at 11:00\nWhen both entries are present in activity log\nThen activity log contains 2 separate entries:\n  - Entry 1: action_state='story_bot.shape.validate_rules', timestamp='2025-12-03T09:55:00Z'\n  - Entry 2: action_state='story_bot.exploration.validate_rules', timestamp='2025-12-03T11:00:00Z'\nAnd Each entry has its own inputs, outputs, and duration\nAnd Activity log distinguishes same action in different behaviors"
                    },
                    {
                      "name": "Activity log handles file write failure gracefully",
                      "steps": "Given validate_rules action is completing\nAnd project_area/activity log file is write-protected\nWhen Activity logger attempts to append entry\nThen Activity logger detects file write error\nAnd Activity logger warns user in chat: \"Unable to log activity. Audit trail may be incomplete.\" (non-blocking)\nAnd validate_rules action continues execution despite logging failure\nAnd Action is not blocked by activity logging failure"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Inject Content",
      "priority": 4,
      "epics": [
        {
          "name": "Invoke Bot",
          "sequential_order": 2,
          "sub_epics": [
            {
              "name": "Invoke Bot Tool",
              "sequential_order": 2,
              "sub_epics": [],
              "stories": []
            },
            {
              "name": "Perform Behavior Action",
              "sequential_order": 3,
              "sub_epics": [],
              "stories": [
                {
                  "name": "InjectsContent Into Instructions",
                  "sequential_order": 9,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user"
                },
                {
                  "name": "Follows Enriched Instructions",
                  "sequential_order": 10,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                }
              ]
            }
          ]
        },
        {
          "name": "Execute Behavior Actions",
          "sequential_order": 3,
          "sub_epics": [
          ]
        }
      ]
    },
    {
      "name": "Save Content",
      "priority": 5,
      "epics": [
        {
          "name": "Invoke Bot",
          "sequential_order": 2,
          "sub_epics": [
            {
              "name": "Perform Behavior Action",
              "sequential_order": 3,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Persists Content",
                  "sequential_order": 11,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user"
                },
                {
                  "name": "Submit Content Changes to Tools for Saving",
                  "sequential_order": 12,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user"
                }
              ]
            }
          ]
        },
        {
          "name": "Execute Behavior Actions",
          "sequential_order": 3,
          "sub_epics": [
            {
              "name": "Gather Context",
              "sequential_order": 1,
              "sub_epics": [
                {
                  "name": "Provide Answers and Evidence",
                  "sequential_order": 3,
                  "sub_epics": [],
                  "stories": []
                }
              ],
              "stories": []
            },
            {
              "name": "Decide Planning Criteria Action",
              "sequential_order": 5,
              "sub_epics": [
                {
                  "name": "Make Decisons and Assumptions",
                  "sequential_order": 6,
                  "sub_epics": [],
                  "stories": []
                }
              ],
              "stories": []
            },
            {
              "name": "Build Knowledge Action",
              "sequential_order": 7,
              "sub_epics": [
                {
                  "name": "Edit Knowledge Graph",
                  "sequential_order": 11,
                  "sub_epics": [],
                  "stories": [
                    {
                      "name": "Save Knowledge Graph",
                      "sequential_order": 4,
                      "connector": "or",
                      "users": [
                        "Bot-Behavior"
                      ],
                      "story_type": "user"
                    }
                  ]
                }
              ],
              "stories": []
            },
            {
              "name": "Validate Knowledge & Content Against Rules",
              "sequential_order": 16,
              "sub_epics": [],
              "stories": [
                {
                  "name": "Save Content",
                  "sequential_order": 6,
                  "connector": "or",
                  "users": [
                    "Bot-Behavior"
                  ],
                  "story_type": "user"
                },
                {
                  "name": "Load + Inject Diagnostics Results, Knowledge, Content Instructions",
                  "sequential_order": 7,
                  "connector": "or",
                  "users": [
                    "Bot-Behavior"
                  ],
                  "story_type": "user"
                },
                {
                  "name": "Validate Content Using Injected Diagnostics + Rules",
                  "sequential_order": 8,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Later",
      "priority": 6,
      "epics": []
    }
  ]
}                   