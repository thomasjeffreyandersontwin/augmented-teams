{
  "behaviorName": "shape",
  "instructions": [
    "**BUILD KNOWLEDGE GRAPH - STORY GRAPH AND DOMAIN MODEL CREATION:**",
    "",
    "Build the initial story graph structure AND domain model from gathered context and planning decisions. Capture domain concepts alongside story structure.",
    "",
    "**Configuration:**",
    "- Reference: build_story_graph_outline.json",
    "- Template: story-graph-outline.json",
    "",
    "**Domain Model Creation (Integrated with Story Graph):**",
    "1. Build domain model alongside story graph structure",
    "2. Apply domain shaping rules (context: 'when shaping the domain')",
    "3. Map domain concepts to epics/sub_epics in story-graph.json based on relevance",
    "",
    "**Domain Concept Placement Logic:**",
    "- **Local placement (preferred)**: Place domain_concepts at the sub_epic level when they are relevant to only that sub_epic",
    "- **Global placement**: Elevate domain_concepts to parent epic/sub_epic level when they are relevant to multiple child sub_epics",
    "- **Favor local**: Start with local placement, but elevate if the concept is used by multiple sub_epics",
    "- **Think about the core**: Consider the core domain concepts that span multiple epics - these should be placed at the epic level",
    "",
    "**Process:**",
    "1. Use clarification data from docs/story-io-synch/stories/clarification.json",
    "2. Use planning decisions from docs/story-io-synch/stories/planning.json",
    "3. Build story graph structure following the template in story-graph-outline.json",
    "4. Build domain model alongside story graph structure",
    "5. Map domain concepts to epics/sub_epics based on relevance",
    "6. Populate domain_concepts arrays in story-graph.json with proper placement",
    "7. Create story-graph.json and domain model outputs in project area (same location)",
    "",
    "**Output:**",
    "- File: {project_area}/story-graph.json (JSON story graph with epics, sub_epics, stories, domain_concepts)",
    "- Domain model outputs in same project area",
    "",
    "**Next Step:** Proceed to render step after story graph is created."
  ]
}

