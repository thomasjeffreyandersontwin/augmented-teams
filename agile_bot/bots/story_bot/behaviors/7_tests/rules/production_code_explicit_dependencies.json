{
  "description": "PRODUCTION CODE RULE: Make dependencies explicit through constructor injection. Pass all external dependencies (file systems, APIs, services) as constructor parameters. No hidden global state or singleton access. Tests should easily inject test doubles when needed. Follow user's rule: 'Maximize use of constructor injection - objects should have external dependencies passed in at construction time'.",
  "examples": [
    {
      "do": {
        "description": "Explicit constructor injection",
        "content": [
          "# Production Code - Dependencies injected",
          "class Agent:",
          "    def __init__(",
          "        self,",
          "        agent_name: str,",
          "        workspace_root: Path,",
          "        config_loader: ConfigLoader,",
          "        domain_graph: DomainGraph",
          "    ):",
          "        \"\"\"All dependencies explicit and injected.\"\"\"",
          "        self.agent_name = agent_name",
          "        self.workspace_root = workspace_root",
          "        self._config_loader = config_loader",
          "        self._domain_graph = domain_graph",
          "    ",
          "    def initialize(self):",
          "        \"\"\"Use injected dependencies.\"\"\"",
          "        config = self._config_loader.load(self.agent_name)",
          "        self._domain_graph.build_from_config(config)",
          "",
          "# Test easily injects test doubles",
          "def test_agent_initializes_with_config(self):",
          "    # Given: Create test dependencies",
          "    config_loader = FakeConfigLoader({'name': 'story_bot'})",
          "    domain_graph = FakeDomainGraph()",
          "    ",
          "    # When: Inject dependencies",
          "    agent = Agent(",
          "        agent_name='story_bot',",
          "        workspace_root=Path('/test'),",
          "        config_loader=config_loader,",
          "        domain_graph=domain_graph",
          "    )",
          "    agent.initialize()",
          "    ",
          "    # Then: Verify behavior",
          "    assert domain_graph.was_built",
          "    # Easy to test - no mocking needed!"
        ]
      },
      "dont": {
        "description": "Hidden dependencies and global state",
        "content": [
          "# DON'T: Hidden dependencies created inside class",
          "class Agent:",
          "    def __init__(self, agent_name: str, workspace_root: Path):",
          "        self.agent_name = agent_name",
          "        self.workspace_root = workspace_root",
          "        # WRONG - creates dependencies internally",
          "        self._config_loader = ConfigLoader()  # Hidden!",
          "        self._domain_graph = DomainGraph.get_instance()  # Singleton!",
          "    ",
          "    def load_data(self):",
          "        # WRONG - accesses global state",
          "        db = DatabaseConnection.instance()  # Hidden dependency!",
          "        return db.query('SELECT * FROM agents')",
          "",
          "# Test is forced to mock globally",
          "def test_agent_loads_data(self):",
          "    # WRONG - must patch global state",
          "    with patch('module.ConfigLoader') as mock_loader:",
          "        with patch('module.DomainGraph.get_instance') as mock_graph:",
          "            with patch('module.DatabaseConnection.instance') as mock_db:",
          "                agent = Agent('bot', Path('/test'))",
          "                # Fragile test coupled to implementation!",
          "                # Can't easily test with real implementations!"
        ]
      }
    },
    {
      "do": {
        "description": "Use factories for complex construction",
        "content": [
          "# Production Code - Factory with explicit dependencies",
          "class AgentFactory:",
          "    def __init__(",
          "        self,",
          "        workspace_root: Path,",
          "        config_loader: ConfigLoader,",
          "        domain_graph: DomainGraph",
          "    ):",
          "        \"\"\"Factory has its own explicit dependencies.\"\"\"",
          "        self._workspace_root = workspace_root",
          "        self._config_loader = config_loader",
          "        self._domain_graph = domain_graph",
          "    ",
          "    def create_agent(self, agent_name: str) -> Agent:",
          "        \"\"\"Create agent with injected dependencies.\"\"\"",
          "        return Agent(",
          "            agent_name=agent_name,",
          "            workspace_root=self._workspace_root,",
          "            config_loader=self._config_loader,",
          "            domain_graph=self._domain_graph",
          "        )",
          "",
          "# Test with factory",
          "def test_factory_creates_agent_with_dependencies(self, tmp_path):",
          "    # Given: Create factory with test dependencies",
          "    config_loader = FakeConfigLoader()",
          "    domain_graph = FakeDomainGraph()",
          "    factory = AgentFactory(",
          "        workspace_root=tmp_path,",
          "        config_loader=config_loader,",
          "        domain_graph=domain_graph",
          "    )",
          "    ",
          "    # When: Factory creates agent",
          "    agent = factory.create_agent('story_bot')",
          "    ",
          "    # Then: Agent has correct dependencies",
          "    assert agent.agent_name == 'story_bot'",
          "    assert agent.workspace_root == tmp_path"
        ]
      },
      "dont": {
        "description": "Factory with hidden dependencies",
        "content": [
          "# DON'T: Factory creates dependencies",
          "class AgentFactory:",
          "    @staticmethod",
          "    def create_agent(agent_name: str, workspace_root: Path) -> Agent:",
          "        # WRONG - creates dependencies inside",
          "        config_loader = ConfigLoader()  # Hidden!",
          "        domain_graph = DomainGraph()  # Hidden!",
          "        return Agent(agent_name, workspace_root, config_loader, domain_graph)",
          "",
          "# Test can't control dependencies",
          "def test_factory(self, tmp_path):",
          "    # WRONG - can't inject test dependencies",
          "    with patch('module.ConfigLoader'):  # Forced to mock",
          "        with patch('module.DomainGraph'):  # Forced to mock",
          "            agent = AgentFactory.create_agent('bot', tmp_path)",
          "            # Fragile test!"
        ]
      }
    }
  ]
}


