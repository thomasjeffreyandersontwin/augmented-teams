{
  "rule_id": "tests_must_match_story_graph_exactly",
  "description": "Test structure must match story graph exactly: file names match sub-epics, class names match stories, method names match scenarios, and ordering follows story map sequence",
  "scanner": "agile_bot.bots.base_bot.src.scanners.class_based_organization_scanner.ClassBasedOrganizationScanner",
  "rationale": "Tests provide 1-to-1 traceability with story map. Exact naming and ordering makes it trivial to find tests for any story or scenario by following story map hierarchy.",
  
  "sub_rules": [
    {
      "rule_id": "test_file_matches_sub_epic",
      "description": "Test file name must match sub-epic name in snake_case format: test_<sub_epic_name>.py",
      "examples": [
        {
          "sub_epic": "Generate Bot Server And Tools",
          "correct": "test_generate_bot_server_and_tools.py",
          "wrong": [
            "test_increment_3_generate_bot_server_and_tools.py (includes increment number)",
            "test_bot_server_tools.py (abbreviated)",
            "test_generator.py (too generic)"
          ]
        },
        {
          "sub_epic": "Invoke Bot Tool",
          "correct": "test_invoke_bot_tool.py",
          "wrong": [
            "test_bot_tool_invocation.py (different words)",
            "test_tool_routing.py (generic)"
          ]
        },
        {
          "sub_epic": "Validate Knowledge & Content Against Rules",
          "correct": "test_validate_knowledge_and_content_against_rules.py",
          "wrong": [
            "test_validate_rules.py (too short)",
            "test_validation.py (generic)"
          ]
        }
      ]
    },
    
    {
      "rule_id": "test_class_matches_story_exactly",
      "description": "Test class name must match story name EXACTLY in PascalCase: class Test<ExactStoryName>. NO abbreviations, NO generic terms.",
      "examples": [
        {
          "story": "Generate Bot Tools",
          "correct": "class TestGenerateBotTools:",
          "wrong": [
            "class TestGenBotTools: (abbreviated)",
            "class TestBotToolGeneration: (reworded)",
            "class TestToolGenerator: (different words)"
          ]
        },
        {
          "story": "Inject Guardrails as Part of Clarify Requirements",
          "correct": "class TestInjectGuardrailsAsPartOfClarifyRequirements:",
          "wrong": [
            "class TestGuardrailsInjection: (generic, missing context)",
            "class TestInjectGuardrails: (missing 'as Part of Clarify Requirements')",
            "class TestClarifyRequirements: (wrong focus)"
          ]
        },
        {
          "story": "Track Activity for Gather Context Action",
          "correct": "class TestTrackActivityForGatherContextAction:",
          "wrong": [
            "class TestTrackActivity: (missing context)",
            "class TestGatherContext: (wrong focus)",
            "class TestActivityTracking: (reworded)"
          ]
        },
        {
          "story": "Inject Validation Rules for Validate Rules Action",
          "correct": "class TestInjectValidationRulesForValidateRulesAction:",
          "wrong": [
            "class TestValidationRules: (generic)",
            "class TestInjectRules: (abbreviated)"
          ]
        }
      ]
    },
    
    {
      "rule_id": "test_method_matches_scenario",
      "description": "Test method name must match scenario name from story document in snake_case: def test_<scenario_name_snake_case>",
      "examples": [
        {
          "scenario": "Generator creates bot tool for test_bot",
          "correct": "def test_generator_creates_bot_tool_for_test_bot(self, workspace_root):",
          "wrong": [
            "def test_creates_tool(self): (abbreviated)",
            "def test_bot_tool_generation(self): (generic)",
            "def test_scenario_1(self): (numbered, not descriptive)"
          ]
        },
        {
          "scenario": "Bot tool loads workflow state to determine routing",
          "correct": "def test_bot_tool_loads_workflow_state_to_determine_routing(self, workspace_root):",
          "wrong": [
            "def test_loads_state(self): (abbreviated)",
            "def test_routing(self): (too generic)"
          ]
        },
        {
          "scenario": "Router routes to current behavior from saved state",
          "correct": "def test_router_routes_to_current_behavior_from_saved_state(self, workspace_root):",
          "wrong": [
            "def test_routes_to_behavior(self): (abbreviated)",
            "def test_routing_behavior(self): (reworded)"
          ]
        }
      ]
    },
    
    {
      "rule_id": "test_classes_ordered_by_story_map",
      "description": "Test classes must appear in same order as stories in story map. File should read like story map.",
      "examples": [
        {
          "story_map_order": [
            "1. Generate Bot Tools (Increment 3)",
            "2. Generate Behavior Tools (Increment 3)",
            "3. Generate MCP Bot Server (Increment 2)",
            "4. Generate Behavior Action Tools (Increment 2)"
          ],
          "correct_test_order": [
            "class TestGenerateBotTools:",
            "class TestGenerateBehaviorTools:",
            "class TestGenerateMCPBotServer:",
            "class TestGenerateBehaviorActionTools:"
          ],
          "wrong_test_order": [
            "class TestGenerateMCPBotServer: (out of order - increment 2 before increment 3)",
            "class TestGenerateBotTools: (should be first)",
            "class TestGenerateBehaviorTools:",
            "class TestGenerateBehaviorActionTools:"
          ]
        },
        {
          "story_map_order": [
            "1. Track Activity for Gather Context Action",
            "2. Proceed To Decide Planning"
          ],
          "correct_test_order": [
            "class TestTrackActivityForGatherContextAction:",
            "class TestProceedToDecidePlanning:"
          ],
          "wrong_test_order": [
            "class TestProceedToDecidePlanning: (should be second, not first)",
            "class TestTrackActivityForGatherContextAction: (should be first)"
          ]
        }
      ]
    }
  ],
  
  "validation": {
    "check_file_naming": "Filename format is test_<sub_epic_snake_case>.py",
    "check_class_naming": "Class name format is Test<FullStoryNamePascalCase> (no abbreviations)",
    "check_method_naming": "Method name format is test_<scenario_name_snake_case>",
    "check_ordering": "Test classes appear in same sequence as stories in story map",
    "error_messages": {
      "file_naming": "Test file must be named test_<sub_epic_name>.py matching exact sub-epic name",
      "class_naming": "Test class must use EXACT story name: Test<ExactStoryName>, no abbreviations or generic names",
      "method_naming": "Test method must match scenario name from story document",
      "ordering": "Test classes must appear in same order as stories in story map"
    }
  },
  
  "key_principles": [
    "Test file name = sub-epic name in snake_case",
    "Test class name = EXACT story name in PascalCase (no abbreviations!)",
    "Test method name = scenario name in snake_case",
    "Test class order = story map order (reads like story map)",
    "One test file per sub-epic (all stories in that sub-epic)",
    "One test class per story (exact 1-to-1 mapping)",
    "One test method per scenario (exact 1-to-1 mapping)"
  ],
  
  "common_violations": [
    "Adding increment numbers to filenames (test_increment_3_<name>.py)",
    "Abbreviating story names in class names (TestGenTools vs TestGenerateBotTools)",
    "Using generic class names (TestGuardrailsInjection vs TestInjectGuardrailsAsPartOfClarifyRequirements)",
    "Using different words than story (test_bot_tool_invocation.py vs test_invoke_bot_tool.py)",
    "Test classes out of order (not matching story map sequence)",
    "Abbreviated method names (test_creates_tool vs test_generator_creates_bot_tool_for_test_bot)"
  ]
}

