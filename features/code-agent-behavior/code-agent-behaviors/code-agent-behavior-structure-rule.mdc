**When** creating or updating any AI behavior (rule, command, code, or MCP tool),
**then** follow the defined structure and naming conventions to modularity, consistency and discoverability.

**What is an AI Behavior?**

An **AI behavior** is a reusable instruction set that defines how the AI assistant should respond to specific situations, commands, or contexts. Each behavior consists of one or more files that work together: 
a **rule** (`.mdc`) that defines the triggering condition and guidelines, 
one or more **commands** (`.md`) that describe how to execute the behavior, 

An **AI behavior** may optionally include
* a **Python implementation** (`.py`) that provides automated functionality. 
* may also include **MCP tool configurations** (`.json` files) for exposing tools via the Model Context Protocol
* may a **task configurations** (`.vscode/tasks.json`) for background processes or automation workflows. 

**Behavior Features**
Behaviors are organized within a **Behavior Features** —  a collection of tightly nit behaviors that are strongly related. Behavior Features should be named according to the overarching purpsoe of the feature aling with a brief overvierw of the main behaviors and purpose of each

**Always**
Keep behavior files belonging to the same feature together in one directory (e.g., this behavior in `features/code-agent-behavior/code-agent-behaviors/` which contains behaviors for managing code agent behavior files themselves).
**Never**
Scatter behaviors into seprated areas areas, break them up by component type.


**Rule Structure:**

**What are Rules?**
Rules define the overarching conditions and guidelines for when and how a behavior should be applied. They establish the "when" (triggering event or condition) and "then" (expected action or response) that govern the behavior across different contexts. Rules focus on both overarching logic, structural standards, and event-based behavior patterns.

* Rules must start with `**When** <event> condition,` — Describe the triggering event or condition
* Follow with `**then** <action>` — Describe what should happen
* Rules focus on both overaching logic, structural standards, and event based behavior

**Always:**
* Name files using `<feature>-<behavior-name>-<type>.<ext>` pattern (e.g., `behavior-sync-cmd.md`, `behavior-index-cmd.py`).
* **For rules with multiple commands**, add a verb suffix: `<feature>-<behavior-name>-<verb>-cmd.md` (e.g., `behavior-structure-validate-cmd.md`, `behavior-structure-fix-cmd.md`, `behavior-structure-create-cmd.md`).
* Rules remain: `<feature>-<behavior-name>-rule.mdc` (no verb suffix).
* **Python implementation files** (`<feature>-<behavior-name>-cmd.py`) serve ALL commands for a behavior and do NOT use verb suffixes - they implement multiple actions (e.g., `behavior-structure-cmd.py` implements validate, fix, and create actions for `behavior-structure-validate-cmd.md`, `behavior-structure-fix-cmd.md`, `behavior-structure-create-cmd.md`).
* **MCP tool configurations**: `<feature>-<tool-name>-mcp.json` (e.g., `tdd-mcp.json`) → Synced to `.cursor/mcp/` and merged if exists
* **Task configurations**: `<feature>-tasks.json` (e.g., `code-agent-behavior-tasks.json`) → Merged into root `.vscode/tasks.json` (tasks combined, duplicate labels avoided)
* Keep each behavior in its own feature folder eg `features/<feature>/code-agent-behaviors/`.
* Link related files by prefix (same `<feature>-<behavior-name>` prefix; commands can have additional verb suffixes, but Python implementations use base name).
* **Rules must reference the commands that can execute the rules** — Include section: `**Executing Commands:** * \command-name — [what the command is] [when to call it]`
* **Rules must reference tools used by the behavior** — If the behavior uses MCP servers or tools, include section: `**Tools:** * @mcp-server-name — [list all tools from the MCP server and how the behavior uses them]` (e.g., if using TDD MCP server, list `execute_next_step`, `get_current_step` and how they're used)


**Command Structure:**

**What are Commands?**
Commands contain a set of executable steps that implement a rule. They describe the concrete actions, procedures, and workflows that the AI agent, code functions, or user should perform to execute the behavior. Commands bridge the gap between abstract rules (the "what") and concrete implementation (the "how").

**Command Steps Structure:**
Commands must include a `**Steps:**` section that lists the sequential actions to execute the behavior. Each step should specify who/what performs it:
* Steps executed by the AI agent (e.g., "1. The AI agent analyzes the file structure...")
* Steps that prompt for user input (e.g., "2. The user is prompted to confirm the changes...")
* Steps that run code functions (e.g., "3. The function `validate_structure()` is run and outputs validation results...")
* Steps that call MCP tools (e.g., "4. The MCP tool `execute_next_step()` is called with feature_name parameter...")

* Rules they follow: `**Rule:** * \rule-name — [description]`
  * Code they call: `**Implementation:** * function_name() — [description]`
  * When to use AI: `**AI Usage:** * [when AI should handle this]`
  * When to use code: `**Code Usage:** * [when code should handle this]`
* Document relationships (rule ↔ command ↔ code) using references in markdown headers.
* Include a short description at the top of every rule and command file.
* Validate structure before committing changes.
* Fix structure issues automatically when possible.
* Version all behavior files via Git; treat each change as a traceable commit.
* Run validation (@behavior-structure validate) before merging any new or updated behaviors.

**Never:**
* Mix unrelated behaviors in the same folder.
* Use ambiguous names like `new-rule.mdc` or `temp-cmd.md`.
* Leave files undocumented or unreferenced.
* Create rules without referencing executing commands.
* Create commands without referencing rules and code.
* Manually fix structure issues that can be automated.
