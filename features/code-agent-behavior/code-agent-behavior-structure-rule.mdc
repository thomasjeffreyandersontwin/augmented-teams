---
description: Code agent behavior structure and naming conventions
globs:
  - "**/*-rule.mdc"
  - "**/*-cmd.md"
  - "**/*-cmd.py"
  - "**/code-agent-behavior/**"
  - "**/.cursor/rules/**"
  - "**/.cursor/commands/**"
---

**When** creating or updating Code Agent behavior
**then** follow the defined structure, standards, and naming conventions in order to amximize modularity, consistency and discoverability.

**Code Agent Behavior**
* is a reusable instruction set that defines how the AI assistant should respond to specific situations, commands, or contexts. 
* Each behavior consists of one or more files that work together: 
  * a **rule** (`.mdc`) that defines the triggering condition and guidelines, 
  * one or more **commands** (`.md`) that describe how to execute the behavior
* may optionally include
  * a **Python implementation** (`.py`) that provides automated functionality. 
  * may also include **MCP tool configurations** (`.json` files) for exposing tools via the Model Context Protocol
  * may a **task configurations** (`.vscode/tasks.json`) for background processes or automation workflows. 

**Code Agent Behavior Features**
Behaviors are organized within a **Behavior Features** —  a collection of tightly nit behaviors that are strongly related.

**Always**
* Named according to the overarching purpose of the feature 
* Provide a brief overview of the main behaviors  and purpose of the feature
* Keep behavior files belonging to the same feature together in one directory 
* Name rule files using `<feature-name>-<behavior-name>-rule.mcd`
* Name Python implementation files using `<feature>-<behavior-name>-cmd.py`
* Name MCP tool configurations**: `<feature>-<tool-name>-mcp.json`
* Name Task configurations `<feature>-tasks.json`
* Keep each behavior in its own feature folder eg `features/<feature>/code-agent-behaviors/`.
* Link related files by prefix (same `<feature>-<behavior-name>` prefix; commands can have additional verb suffixes, but Python implementations use base name).

**Never**
* Scatter behaviors into separated areas areas, break them up by component type.
* Mix files from different features in the same folder.
* Use inconsistent or ad hoc filename patterns.
* Add undocumented, draft, or experimental files to the deployed behaviors directory.
* Manually edit auto-generated index or sync files.
* Place tool configuration or task files outside their designated folders.

**Rule Files:**
*  define the overarching conditions and guidelines for when and how a behavior should be applied. 
*  focus on both overarching logic, structural standards, and event-based behavior patterns.

**Always:**
*start  Rules with `**When** <event> condition,` — Describe the triggering event or condition
* Follow with `**then** <action>` — Describe what should happen
* Have a structure, logic, or applicable conditions section
* Rules file must reference the commands that can execute their rules — Include section: `**Executing Commands:** * \command-name — [what the command is] [when to call it]`
* Rules must reference tools used by the behavior** — If the behavior uses MCP servers or tools, include section: `**Tools:** * @mcp-server-name — [list all tools from the MCP server and how the behavior uses them]` (e.g., if using TDD MCP server, list `execute_next_step`, `get_current_step` and how they're used)

**Never:**
* Reference commands in rules that do not exist, or vice versa.


**Command Files:**
* contain a set of executable steps that implement a rule. 
* describe the concrete actions, procedures, and workflows that the AI agent, code functions, or user should perform to execute the behavior. 
* bridge the gap between abstract rules (the "what") and concrete implementation (the "how").

**Always:**
* Comands must refer to 
  * the Rules file they follow: `**Rule:** * \rule-name — [description]`
  * the Code they call: `**Implementation:** * function_name() — [description]`
  * When to use AI: `**AI Usage:** * [when AI should handle this]`
  * When to use code: `**Code Usage:** * [when code should handle this]`
* Document relationships (rule ↔ command ↔ code) using references in markdown headers.
* Include a short description at the top of every rule and command file.
* Validate structure before committing changes.
* Fix structure issues automatically when possible.
* Version all behavior files via Git; treat each change as a traceable commit.
* Run validation (@behavior-structure validate) before merging any new or updated behaviors.

**Never:**
* Mix unrelated behaviors in the same folder.
* Use ambiguous names like `new-rule.mdc` or `temp-cmd.md`.
* Leave files undocumented or unreferenced.
* Create rules without referencing executing commands.
* Create commands without referencing rules and code.
* Manually fix structure issues that can be automated.

**Command Steps:**
Commands must include a `**Steps:**` section that lists the sequential actions to execute the behavior. Each step should specify who/what performs it:
* Steps executed by the AI agent (e.g., "1. The AI agent analyzes the file structure...")
* Steps that prompt for user input (e.g., "2. The user is prompted to confirm the changes...")
* Steps that run code functions (e.g., "3. The function `validate_structure()` is run and outputs validation results...")
* Steps that call MCP tools (e.g., "4. The MCP tool `execute_next_step()` is called with feature_name parameter...")


